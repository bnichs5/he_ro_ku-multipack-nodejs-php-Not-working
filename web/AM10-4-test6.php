<?php eval(base64_decode('CiBnb3RvIHkzanc3OyB5M2p3NzogPz4KPCFkb2N0eXBlaHRtbD48aHRtbCBsYW5nPSJlbiI+PGhlYWQgcHJvZmlsZT0iaHR0cDovL3d3dy53My5vcmcvMjAwNS8xMC9wcm9maWxlIj48bWV0YSBjaGFyc2V0PSJ1dGYtOCI+PHRpdGxlPlBsZXggRXhwb3J0PC90aXRsZT48bWV0YSBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsaW5pdGlhbC1zY2FsZT0wLjY1LG1pbmltdW0tc2NhbGU9MC42NSxtYXhpbXVtLXNjYWxlPTAuNjUibmFtZT0idmlld3BvcnQiPjxsaW5rIGhyZWY9ImFzc2V0czIvaW1hZ2VzL2Zhdmljb24uaWNvInJlbD0iaWNvbiJ0eXBlPSJpbWFnZS94LWljb24iPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+KnttYXJnaW46MDtwYWRkaW5nOjA7Ym9yZGVyOjA7bGlzdC1zdHlsZTpub25lO2ZvbnQtd2VpZ2h0OjQwMH1ib2R5e2Rpc3BsYXk6Z3JpZDtncmlkLXRlbXBsYXRlLWNvbHVtbnM6MWZyO2dyaWQtdGVtcGxhdGUtcm93czphdXRvIDFmciBhdXRvO21pbi1oZWlnaHQ6MTAwdmg7Zm9udC1mYW1pbHk6QXJpYWwsSGVsdmV0aWNhLHNhbnMtc2VyaWY7Zm9udC1zaXplOjEycHg7Y29sb3I6I2ZmZjtiYWNrZ3JvdW5kOiMyODJiMmV9Ym9keT5tYWluLmNvbnRhaW5lcntkaXNwbGF5OmdyaWQ7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjIwMHB4IDFmcjtncmlkLWdhcDoycHg7Ym94LXNoYWRvdzowIDAgMjBweCAxMHB4IHJnYmEoMCwwLDAsLjY1KX1zdHJvbmd7Zm9udC13ZWlnaHQ6NjAwfS5jbGVhcntjbGVhcjpib3RofS5oaWRle2Rpc3BsYXk6bm9uZX0uY29udGFpbmVye3dpZHRoOjEwMCU7cGFkZGluZzowO21hcmdpbjowIGF1dG87YmFja2dyb3VuZC1jb2xvcjojMjgyYjJlO2NsZWFyOmJvdGh9I2hlYWRlcntkaXNwbGF5OmdyaWQ7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOnJlcGVhdCgyLDFmcik7aGVpZ2h0Ojk1cHg7YmFja2dyb3VuZDojMjgyYjJlO3Bvc2l0aW9uOnJlbGF0aXZlfSNoZWFkZXIgaDF7d2lkdGg6Mjk5cHg7aGVpZ2h0Ojk1cHg7bWFyZ2luLWxlZnQ6MTZweDtiYWNrZ3JvdW5kOnVybChpbWFnZXMvbG9nby5wbmcpIG5vLXJlcGVhdH0jaGVhZGVyIGgxIHNwYW57ZGlzcGxheTpub25lfSNoZWFkZXIgcHt0ZXh0LWFsaWduOnJpZ2h0O2hlaWdodDo5NXB4O292ZXJmbG93OmhpZGRlbn0jaGVhZGVyIHAgc3BhbntkaXNwbGF5OmJsb2NrO3BhZGRpbmc6NHB4IDZweCAwIDA7Zm9udC1zaXplOjE2cHg7dGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlO2NvbG9yOiM2MDY2NmJ9I2hlYWRlciBwIHN0cm9uZ3tkaXNwbGF5OmJsb2NrO21hcmdpbjotNnB4IC02cHggMCAwO2ZvbnQtc2l6ZTo4MHB4O2NvbG9yOiMzZTQxNDZ9I2hlYWRlciAjc2VhcmNoe2FsaWduLWl0ZW1zOmNlbnRlcjt3aWR0aDoxMCU7bWFyZ2luOmF1dG87bWFyZ2luLXJpZ2h0OjEwcHg7bWFyZ2luLWJvdHRvbTotMTVweDtwb3NpdGlvbjphYnNvbHV0ZTtsZWZ0OjA7Ym90dG9tOi0xNTBweDtwYWRkaW5nOjE4cHggMTVweH0jaGVhZGVyIGlucHV0e3dpZHRoOjE4MHB4O3BhZGRpbmc6NHB4IDNweDtib3JkZXI6MXB4IHNvbGlkICMyNjI2MjY7Ym9yZGVyLXJhZGl1czo0cHg7Y29sb3I6Izc4Nzg3ODtiYWNrZ3JvdW5kOiNmZmZ9I3NpZGViYXJ7bWFyZ2luLXRvcDozcHh9I3RvZ2dsZV9zaWRlYmFye2Rpc3BsYXk6aW5saW5lLWZsZXg7d2lkdGg6MTAwJTtwYWRkaW5nOjhweCAwIDAgMTNweDtjb2xvcjojZmY5MjFlO3RleHQtZGVjb3JhdGlvbjpub25lO2ZvbnQtd2VpZ2h0OjcwMDtmb250LXNpemU6MS4yZW07Y3Vyc29yOnBvaW50ZXJ9I3RvZ2dsZV9zaWRlYmFyOmhvdmVye3RleHQtZGVjb3JhdGlvbjp1bmRlcmxpbmV9LnNpZGViYXItc2VjdGlvbiBoMntmb250LXNpemU6MjBweDtjb2xvcjojZmZmO3BhZGRpbmc6OHB4IDAgMCAxM3B4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkICNmZjkzMWZ9LmdlbmVyaWMtbGlzdHttYXJnaW46M3B4IDAgMTRweH0uZ2VuZXJpYy1saXN0IGxpLC5zZWN0aW9ucy1saXN0IGxpe2Rpc3BsYXk6Z3JpZDtncmlkLXRlbXBsYXRlLWNvbHVtbnM6MWZyIDMwcHg7cGFkZGluZzozcHggM3B4IDNweCAzcHh9LnNlY3Rpb25zLWxpc3QgbGl7Z3JpZC10ZW1wbGF0ZS1hcmVhczoic2VjdGlvbi1jYXB0aW9uIHNlY3Rpb24tdG90YWwiO2JhY2tncm91bmQ6bm8tcmVwZWF0IDE3cHggNTAlfS5nZW5lcmljLWxpc3QgbGl7Z3JpZC10ZW1wbGF0ZS1hcmVhczoiZ2VuZXJpYy1jYXB0aW9uIGdlbmVyaWMtdG90YWwiO3BhZGRpbmctbGVmdDoxNXB4fS5zZWN0aW9ucy1saXN0IGxpIHNwYW57Z3JpZC1hcmVhOnNlY3Rpb24tY2FwdGlvbn0uZ2VuZXJpYy1saXN0IGxpIHNwYW57Z3JpZC1hcmVhOmdlbmVyaWMtY2FwdGlvbn0uZ2VuZXJpYy1saXN0IGxpIGVtLC5zZWN0aW9ucy1saXN0IGxpIGVte2Rpc3BsYXk6YmxvY2s7bWFyZ2luLXRvcDotMnB4O3BhZGRpbmc6M3B4IDRweDtmb250LXNpemU6MTBweDtmb250LXN0eWxlOm5vcm1hbDtjb2xvcjojZmZmO3RleHQtYWxpZ246Y2VudGVyfS5zZWN0aW9ucy1saXN0IGxpIGVte2dyaWQtYXJlYTpzZWN0aW9uLXRvdGFsfS5nZW5lcmljLWxpc3QgbGkgZW17Z3JpZC1hcmVhOmdlbmVyaWMtdG90YWw7Y29sb3I6I2ZmZn0uZ2VuZXJpYy1saXN0IC5jdXJyZW50LC5zZWN0aW9ucy1saXN0IC5jdXJyZW50e2NvbG9yOiNmZjkzMWZ9LmdlbmVyaWMtbGlzdCBsaTpob3Zlciwuc2VjdGlvbnMtbGlzdCBsaTpob3Zlcntjb2xvcjojZmZmO2NvbG9yOiNmZjk0MjE7Y3Vyc29yOnBvaW50ZXJ9I21haW57Ym9yZGVyLWxlZnQ6MXB4IHNvbGlkICMyNjI2MjZ9I3NlY3Rpb24taGVhZGVye3BhZGRpbmc6MXB4IDAgMXB4IDFweDtkaXNwbGF5Om5vbmU7Ym94LXNoYWRvdzowIDNweCA0cHggMCAjMDAwfSNzZWN0aW9uLWhlYWRlciBkaXZ7cGFkZGluZzo3cHggMCAweDttYXJnaW4tYm90dG9tOi0xcHh9I3NlY3Rpb24taGVhZGVyIGgye3BhZGRpbmctYm90dG9tOjRweDtmb250LXNpemU6MjBweDtjb2xvcjojMjgyYjJlfSNzZWN0aW9uLWhlYWRlciAuc2lkZWJhci1zZWN0aW9uIC5jdXJyZW50e2JhY2tncm91bmQ6cmdiYSgwLDAsMCwuNCk7Y29sb3I6I2ZmOTMxZjtib3JkZXItcmFkaXVzOjFweH0jc2VjdGlvbi1oZWFkZXIgLnNpZGViYXItc2VjdGlvbiBsaTpob3ZlcntiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsLjUpO2NvbG9yOiNmZjkzMWZ9I3BvcHVwX3NlYXNvbnNfc2Vhc29ucywjc2VjdGlvbi1oZWFkZXIgLnNpZGViYXItc2VjdGlvbntiYWNrZ3JvdW5kOnJnYmEoMjU1LDI1NSwyNTUsLjEpO21pbi1oZWlnaHQ6MzRweDtib3gtc2hhZG93OjAgM3B4IDRweCAwICMwMDB9I3BvcHVwX3NlYXNvbnNfc2Vhc29uc3twYWRkaW5nLXRvcDo1cHh9LnN0aWNreXtwb3NpdGlvbjpmaXhlZDt0b3A6MDt3aWR0aDoxMDAlfS5zdGlja3krI3NlY3Rpb25fbnVtX2l0ZW1ze3BhZGRpbmctdG9wOjUwcHh9I3BvcHVwX3NlYXNvbnMgbGksI3NlY3Rpb24taGVhZGVyIC5zaWRlYmFyLXNlY3Rpb24gbGl7bWFyZ2luOjJweDtkaXNwbGF5OmlubGluZS1ibG9jazt3aWR0aDoyMCU7cG9zaXRpb246cmVsYXRpdmU7dGV4dC10cmFuc2Zvcm06dXBwZXJjYXNlO2hlaWdodDoyMHB4O3ZlcnRpY2FsLWFsaWduOm1pZGRsZTt0cmFuc2l0aW9uOmJhY2tncm91bmQtY29sb3IgLjJzLGNvbG9yIC4ycztwYWRkaW5nOjVweCAyMHB4O2NvbG9yOmhzbGEoMCwwJSwxMDAlLC40NSk7YmFja2dyb3VuZC1jb2xvcjp0cmFuc3BhcmVudDtmb250LXNpemU6MTVweDtmb250LXdlaWdodDo2MDA7Zm9udC1mYW1pbHk6T3BlbiBTYW5zIEJvbGQsSGVsdmV0aWNhIE5ldWUsSGVsdmV0aWNhLEFyaWFsLHNhbnMtc2VyaWZ9I3BvcHVwX3NlYXNvbnMgbGl7d2lkdGg6dW5zZXR9I3BsZXhfc2VjdGlvbl9saXN0e3RleHQtYWxpZ246Y2VudGVyfSNwbGV4X3NlY3Rpb25fbGlzdCBsaXt0ZXh0LWFsaWduOmNlbnRlcjtvcGFjaXR5OjF9I3NlY3Rpb25fbnVtX2l0ZW1ze2NvbG9yOnJnYigyNTUsMTQ3LDMxLC44KTtmb250LXdlaWdodDo3MDA7dGV4dC1hbGlnbjpjZW50ZXI7bWFyZ2luLXRvcDo1cHh9I3NlY3Rpb24taGVhZGVyIC5zaWRlYmFyLXNlY3Rpb24gZW17d2lkdGg6MjBweDtwb3NpdGlvbjphYnNvbHV0ZTtyaWdodDoxcHh9I2l0ZW0tbGlzdC1zdGF0dXN7bWFyZ2luOjIxcHggMjNweCA0OHB4IDIycHg7cGFkZGluZy10b3A6NjBweDt0ZXh0LWFsaWduOmNlbnRlcjtjb2xvcjojYzljYWNiO2ZvbnQtc2l6ZToyMHB4fSNpdGVtLWxpc3R7bWFyZ2luOjEwcHggMH0jaXRlbS1saXN0IHVse2Rpc3BsYXk6ZmxleDtmbGV4LXdyYXA6d3JhcDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtZXZlbmx5fS5pdGVte2Rpc3BsYXk6Z3JpZDtncmlkLXRlbXBsYXRlLWNvbHVtbnM6MWZyO2dyaWQtdGVtcGxhdGUtcm93czphdXRvIDFmcjtib3JkZXItcmFkaXVzOjFweDt3aWR0aDoxNDBweDttYXJnaW46MCAzcHggMTBweDtiYWNrZ3JvdW5kOiMyNjI2MjY7Y29sb3I6I2ZmZjt0ZXh0LXNoYWRvdzoxcHggMXB4IDFweCAjMDAwO2JveC1zaGFkb3c6MCAzcHggM3B4IDFweCAjMDAwfS5pdGVtIGltZ3toZWlnaHQ6MjEwcHg7d2lkdGg6MTQwcHg7Ym9yZGVyLXJhZGl1czoxcHggMXB4IDAgMH0uaXRlbSBtYWlue2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXJ9Lml0ZW0gaDR7d2lkdGg6MTAwJTtwYWRkaW5nOjVweCAxcHggMTBweDtmb250LXNpemU6MTJweDt0ZXh0LWFsaWduOmNlbnRlcjttYXgtd2lkdGg6MTljaDtmb250LXdlaWdodDo2MDA7d2hpdGUtc3BhY2U6aW5pdGlhbDtvdmVyZmxvdzp2aXNpYmxlO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXM7Y29sb3I6I2VhZWFlYX0uaXRlbTpob3Zlcntjb2xvcjojZmZmO2N1cnNvcjpwb2ludGVyfS5zdGFycmluZ3t3aGl0ZS1zcGFjZTpub3dyYXA7bWF4LXdpZHRoOjEwMGNoO292ZXJmbG93OmhpZGRlbjt0ZXh0LW92ZXJmbG93OmVsbGlwc2lzfSNwb3B1cC1vdmVybGF5e2Rpc3BsYXk6bm9uZTtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTtvcGFjaXR5Oi42fSNwb3B1cC1jb250YWluZXJ7ZGlzcGxheTpub25lO3Bvc2l0aW9uOmFic29sdXRlO3RvcDowO2xlZnQ6MDttYXgtaGVpZ2h0OjEwMDBweDtib3gtc2hhZG93OjAgMCA4cHggIzMzMzUzODt6LWluZGV4Ojk5OTk7b3BhY2l0eTouNTk7b3BhY2l0eTouODV9I3BvcHVwLWhlYWRlcntncmlkLWNvbHVtbjoxLzQ7ZGlzcGxheTpncmlkO3BhZGRpbmc6OHB4IDEzcHggOHB4IDEzcHg7YmFja2dyb3VuZDpyZ2JhKDI1NSwyNTUsMjU1LC4xKTtib3gtc2hhZG93OjAgM3B4IDRweCAwICMwMDA7b3BhY2l0eTouODV9I3BvcHVwLWhlYWRlciBoMXt0ZXh0LXNoYWRvdzoxcHggMXB4IDFweCAjMDAwfSNwb3B1cC1oZWFkZXIgaDR7Y29sb3I6I2ZmOTQyMTt0ZXh0LXNoYWRvdzoxcHggMXB4IDFweCAjMDAwfSNwb3B1cC1jb250ZW50IGEuY2xvc2V7cG9zaXRpb246YWJzb2x1dGU7cmlnaHQ6LTE2cHg7dG9wOi0xMnB4O3dpZHRoOjI1cHg7aGVpZ2h0OjIycHg7cGFkZGluZzozcHh9I3BvcHVwLWNvbnRlbnQgYS5jbG9zZTpob3Zlcntjb2xvcjojZmY5NDIxfSNwb3B1cC1jb250ZW50IGEuY2xvc2U6YWZ0ZXIsI3BvcHVwLWNvbnRlbnQgYS5jbG9zZTpiZWZvcmV7cG9zaXRpb246YWJzb2x1dGU7bGVmdDoxMnB4O2NvbnRlbnQ6JyAnO2hlaWdodDoxOHB4O3dpZHRoOjNweDtiYWNrZ3JvdW5kLWNvbG9yOiNmZjk0MjF9I3BvcHVwLWNvbnRlbnQgYS5jbG9zZTpiZWZvcmV7dHJhbnNmb3JtOnJvdGF0ZSg0NWRlZyl9I3BvcHVwLWNvbnRlbnQgYS5jbG9zZTphZnRlcnt0cmFuc2Zvcm06cm90YXRlKC00NWRlZyl9I3BvcHVwLWNvbnRlbnR7Z3JpZC1jb2x1bW46My8yO2dyaWQtcm93OjIvMzt3aWR0aDoxMDAwcHg7dGV4dC1zaGFkb3c6MXB4IDFweCAxcHggIzAwMDtvcGFjaXR5Oi45OTtvcGFjaXR5Oi42OX0jcG9wdXAtZm9vdGVye2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6c3BhY2UtYmV0d2VlbjtwYWRkaW5nOjlweCAxM3B4O2NvbG9yOiNmZmZ9I3BvcHVwLWZvb3RlciBzcGFue2Rpc3BsYXk6YmxvY2s7d2lkdGg6MTAwJTtmb250LXNpemU6MS4xZW07Zm9udC13ZWlnaHQ6NjAwfSNwb3B1cC1mb290ZXIgc3Bhbi5uZXh0LWl0ZW17dGV4dC1hbGlnbjpyaWdodH0jcG9wdXAtZm9vdGVyIHNwYW46aG92ZXJ7Y29sb3I6IzAwMDtjdXJzb3I6cG9pbnRlcn0jcG9wdXAtaW5uZXJ7ZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczpyZXBlYXQoMywxZnIpO2dyaWQtZ2FwOjE1cHg7cGFkZGluZzoyMHB4IDE0cHg7YmFja2dyb3VuZDojMjgyYjJlO2JveC1zaGFkb3c6MCAwIDRweCAjMDAwO2JvcmRlci1yYWRpdXM6M3B4fSNwb3B1cC1zaWRlYmFye2dyaWQtY29sdW1uOjE7Z3JpZC1yb3c6Mjt3aWR0aDoxNzBweH0jcG9wdXAtc2lkZWJhciBpbWd7aGVpZ2h0OjI0MHB4O2JveC1zaGFkb3c6MCAwIDRweCAjMzMzNTM4O2JvcmRlci1yYWRpdXM6MnB4O2JveC1zaGFkb3c6MCAwIDRweCAjMDAwfSNwb3B1cC1zaWRlYmFyIHVse21hcmdpbjoxNHB4IDA7Y29sb3I6IzAwMH0jcG9wdXAtc2lkZWJhciBsaXttYXJnaW4tYm90dG9tOjNweH0jcG9wdXAtY29udGVudCBoZWFkZXJ7ZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczoxZnIgMTAwcHh9I3BvcHVwLWNvbnRlbnQgLnJhdGluZ3tkaXNwbGF5OmJsb2NrO3dpZHRoOjEwMHB4O2hlaWdodDoyMHB4O2JhY2tncm91bmQ6dXJsKGltYWdlcy9zdGFycy5wbmcpIG5vLXJlcGVhdCBib3R0b20gcmlnaHR9I3BvcHVwLXN1bW1hcnl7Y29sb3I6I2ZmZn0jcG9wdXAtY29udGVudCAucmF0aW5nX3BsZXgucmF0aW5nXzUwe2JhY2tncm91bmQtcG9zaXRpb246LTk4cHggMH0jcG9wdXAtY29udGVudCAucmF0aW5nX3BsZXgucmF0aW5nXzQ1e2JhY2tncm91bmQtcG9zaXRpb246LTk4cHggLTIwcHh9I3BvcHVwLWNvbnRlbnQgLnJhdGluZ19wbGV4LnJhdGluZ180MHtiYWNrZ3JvdW5kLXBvc2l0aW9uOi05OHB4IC00MHB4fSNwb3B1cC1jb250ZW50IC5yYXRpbmdfcGxleC5yYXRpbmdfMzV7YmFja2dyb3VuZC1wb3NpdGlvbjotOThweCAtNjBweH0jcG9wdXAtY29udGVudCAucmF0aW5nX3BsZXgucmF0aW5nXzMwe2JhY2tncm91bmQtcG9zaXRpb246LTk4cHggLTgwcHh9I3BvcHVwLWNvbnRlbnQgLnJhdGluZ19wbGV4LnJhdGluZ18yNXtiYWNrZ3JvdW5kLXBvc2l0aW9uOi05OHB4IC0xMDBweH0jcG9wdXAtY29udGVudCAucmF0aW5nX3BsZXgucmF0aW5nXzIwe2JhY2tncm91bmQtcG9zaXRpb246LTk4cHggLTEyMHB4fSNwb3B1cC1jb250ZW50IC5yYXRpbmdfcGxleC5yYXRpbmdfMTV7YmFja2dyb3VuZC1wb3NpdGlvbjotOThweCAtMTQwcHh9I3BvcHVwLWNvbnRlbnQgLnJhdGluZ19wbGV4LnJhdGluZ18xMHtiYWNrZ3JvdW5kLXBvc2l0aW9uOi05OHB4IC0xNjBweH0jcG9wdXAtY29udGVudCAucmF0aW5nX3BsZXgucmF0aW5nXzV7YmFja2dyb3VuZC1wb3NpdGlvbjotOThweCAtMTgwcHh9I3BvcHVwLWNvbnRlbnQgLnJhdGluZ19wbGV4LnJhdGluZ18we2JhY2tncm91bmQtcG9zaXRpb246LTk4cHggLTIwMHB4fSNwb3B1cC1jb250ZW50IC5yYXRpbmdfdXNlci5yYXRpbmdfNTB7YmFja2dyb3VuZC1wb3NpdGlvbjowIDB9I3BvcHVwLWNvbnRlbnQgLnJhdGluZ191c2VyLnJhdGluZ180NXtiYWNrZ3JvdW5kLXBvc2l0aW9uOjAgLTIwcHh9I3BvcHVwLWNvbnRlbnQgLnJhdGluZ191c2VyLnJhdGluZ180MHtiYWNrZ3JvdW5kLXBvc2l0aW9uOjAgLTQwcHh9I3BvcHVwLWNvbnRlbnQgLnJhdGluZ191c2VyLnJhdGluZ18zNXtiYWNrZ3JvdW5kLXBvc2l0aW9uOjAgLTYwcHh9I3BvcHVwLWNvbnRlbnQgLnJhdGluZ191c2VyLnJhdGluZ18zMHtiYWNrZ3JvdW5kLXBvc2l0aW9uOjAgLTgwcHh9I3BvcHVwLWNvbnRlbnQgLnJhdGluZ191c2VyLnJhdGluZ18yNXtiYWNrZ3JvdW5kLXBvc2l0aW9uOjAgLTEwMHB4fSNwb3B1cC1jb250ZW50IC5yYXRpbmdfdXNlci5yYXRpbmdfMjB7YmFja2dyb3VuZC1wb3NpdGlvbjowIC0xMjBweH0jcG9wdXAtY29udGVudCAucmF0aW5nX3VzZXIucmF0aW5nXzE1e2JhY2tncm91bmQtcG9zaXRpb246MCAtMTQwcHh9I3BvcHVwLWNvbnRlbnQgLnJhdGluZ191c2VyLnJhdGluZ18xMHtiYWNrZ3JvdW5kLXBvc2l0aW9uOjAgLTE2MHB4fSNwb3B1cC1jb250ZW50IC5yYXRpbmdfdXNlci5yYXRpbmdfNXtiYWNrZ3JvdW5kLXBvc2l0aW9uOjAgLTE4MHB4fSNwb3B1cC1jb250ZW50IC5yYXRpbmdfdXNlci5yYXRpbmdfMHtiYWNrZ3JvdW5kLXBvc2l0aW9uOjAgLTIwMHB4fSNwb3B1cC1jb250ZW50IGgze2ZvbnQtc2l6ZToyMHB4O2NvbG9yOiNmZjk0MjF9I3BvcHVwLWNvbnRlbnQgaDR7Zm9udC1zaXplOjE2cHg7Zm9udC13ZWlnaHQ6MjAwO2NvbG9yOiNmZmY7bWFyZ2luLXRvcDozcHh9I3BvcHVwLWNvbnRlbnQgcHtwYWRkaW5nLXRvcDozO2xpbmUtaGVpZ2h0OjE3cHh9I3BvcHVwLWNvbnRlbnQtbWV0YXttYXJnaW4tdG9wOjEwcHg7Zm9udC1zaXplOjExcHg7Y29sb3I6I2ZmZn0jcG9wdXAtY29udGVudC1tZXRhIGxpe3BhZGRpbmc6MXB4IDA7bGluZS1oZWlnaHQ6MTRweH0jcG9wdXAtY29udGVudC1tZXRhIHN0cm9uZ3tmb250LXdlaWdodDo3MDA7Y29sb3I6I2ZmOTQyMX0jcG9wdXBfc2Vhc29uc3tncmlkLWNvbHVtbjoxLzQ7d2lkdGg6MTAwJTtmb250LXNpemU6MTFweH0jcG9wdXBfc2Vhc29ucyBhcnRpY2xle2Rpc3BsYXk6Z3JpZDtncmlkLXRlbXBsYXRlLWNvbHVtbnM6MTAwcHggMjUwcHggMWZyO2dyaWQtdGVtcGxhdGUtYXJlYXM6InBvcHVwLXNlYXNvbnMgcG9wdXAtZXBpc29kZXMgcG9wdXAtZXBpc29kZSI7bWFyZ2luLXRvcDo2cHg7d2lkdGg6MTAwJX0jcG9wdXBfc2Vhc29ucyBsaXtwYWRkaW5nOjRweH0jcG9wdXBfc2Vhc29uc19zZWFzb25zIGxpe2Rpc3BsYXk6aW5saW5lLWZsZXg7Zm9udC1zaXplOjE1cHg7Zm9udC13ZWlnaHQ6NjAwO2N1cnNvcjpwb2ludGVyfSNwb3B1cF9zZWFzb25zX2VwaXNvZGVze2dyaWQtdGVtcGxhdGUtY29sdW1uczpyZXBlYXQoMywxZnIpfSNwb3B1cF9zZWFzb25zX2VwaXNvZGVzIGxpe2ZvbnQtc2l6ZToxNHB4O3RleHQtdHJhbnNmb3JtOm5vbmU7d2lkdGg6NDYlO2hlaWdodDphdXRvO3ZlcnRpY2FsLWFsaWduOnRvcDtjdXJzb3I6cG9pbnRlcn0jcG9wdXBfc2Vhc29ucyBsaS5jdXJyZW50LCNwb3B1cF9zZWFzb25zIGxpOmhvdmVye2NvbG9yOiNmZjkzMWZ9I3BvcHVwX3NlYXNvbnNfZXBpc29kZXtncmlkLWFyZWE6cG9wdXAtZXBpc29kZTtiYWNrZ3JvdW5kOnJnYmEoMjU1LDI1NSwyNTUsLjEpO2JvcmRlci1yYWRpdXM6MXB4fSNlcGlzb2RlX2NvbnRlbnR7cGFkZGluZzo4cHg7Ym94LXNoYWRvdzowIDNweCA0cHggMCAjMDAwfSNwb3B1cF9zZWFzb25zX2VwaXNvZGUgaDV7Zm9udC1zaXplOjE0cHg7Y29sb3I6I2ZmOTQyMX0jcG9wdXBfc2Vhc29uc19lcGlzb2RlIC5tZXRhe3BhZGRpbmctdG9wOjA7Y29sb3I6I2VlZX0jcG9wdXBfc2Vhc29uc19zZWFzb25zIHVse3RleHQtYWxpZ246Y2VudGVyfSNmb290ZXJ7Y2xlYXI6Ym90aDtwYWRkaW5nOjE0cHg7YmFja2dyb3VuZDojMjgyYjJlO2JvcmRlci10b3A6MXB4IHNvbGlkICNmZjk0MjE7Y29sb3I6I2U3ZWJlZDt0ZXh0LWFsaWduOmNlbnRlcn0jZm9vdGVyIGE6bGluaywjZm9vdGVyIGE6dmlzaXRlZHtjb2xvcjojZTdlYmVkO3RleHQtZGVjb3JhdGlvbjpub25lfSNmb290ZXIgYTphY3RpdmUsI2Zvb3RlciBhOmhvdmVye2NvbG9yOiNmZjk0MjF9LmdlbmRlcntmb250LXNpemU6MTBweDtjb2xvcjojZmY5NDIxfUBtZWRpYSBvbmx5IHNjcmVlbiBhbmQgKG1heC13aWR0aDoxMDI0cHgpe2JvZHk+bWFpbi5jb250YWluZXJ7ZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczoyMCUgMWZyO2dyaWQtZ2FwOjJweH19QG1lZGlhIG9ubHkgc2NyZWVuIGFuZCAobWF4LXdpZHRoOjc0MHB4KXsjaGVhZGVye2Rpc3BsYXk6Z3JpZDtncmlkLXRlbXBsYXRlLWNvbHVtbnM6cmVwZWF0KDIsMWZyKTtoZWlnaHQ6NTBweDtiYWNrZ3JvdW5kOiMyODJiMmU7cG9zaXRpb246cmVsYXRpdmV9I2hlYWRlciBoMXt3aWR0aDoxNTBweDtoZWlnaHQ6NTBweDttYXJnaW4tbGVmdDoxNnB4O2JhY2tncm91bmQ6dXJsKGltYWdlcy9sb2dvLnBuZykgbm8tcmVwZWF0O2JhY2tncm91bmQtc2l6ZToxNTBweCA1MHB4fWJvZHk+bWFpbi5jb250YWluZXJ7ZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczoxNTBweCAxZnI7Z3JpZC1nYXA6MnB4O2JveC1zaGFkb3c6MCAwIDIwcHggMTBweCByZ2JhKDAsMCwwLC42NSl9Lml0ZW17d2lkdGg6MTEwcHg7bWFyZ2luOjNweCAzcHggM3B4O2JveC1zaGFkb3c6MCAzcHggM3B4IDFweCAjMDAwfS5pdGVtIGltZ3toZWlnaHQ6MTY1cHg7Ym9yZGVyLXJhZGl1czoxcHggMXB4IDAgMH0jcG9wdXAtY29udGFpbmVye3dpZHRoOjkzJTt0b3A6NSV9I3BvcHVwLWNvbnRlbnR7d2lkdGg6NDUwcHh9LnN0YXJyaW5ne3doaXRlLXNwYWNlOm5vd3JhcDttYXgtd2lkdGg6ODVjaDtvdmVyZmxvdzpoaWRkZW47dGV4dC1vdmVyZmxvdzplbGxpcHNpc30jZm9vdGVye2ZvbnQtc2l6ZToxMHB4O3RleHQtYWxpZ246Y2VudGVyfX1AbWVkaWEgb25seSBzY3JlZW4gYW5kIChtYXgtd2lkdGg6NDgwcHgpeyNoZWFkZXIgI3NlYXJjaHtkaXNwbGF5Om5vbmV9Lml0ZW17d2lkdGg6MTEzcHg7bWFyZ2luOjNweCAxcHggM3B4O2hlaWdodDoxOTlweDtib3gtc2hhZG93OjAgM3B4IDNweCAxcHggIzAwMH0uaXRlbSBpbWd7aGVpZ2h0OjE3MHB4O2JvcmRlci1yYWRpdXM6MXB4fSNwb3B1cC1jb250ZW50e3dpZHRoOjEwMHZ3fSNwb3B1cC1pbm5lcntncmlkLWdhcDo1cHg7cGFkZGluZzoyMHB4IDVweH0jeHBvcHVwLXN1bW1hcnl7bWF4LXdpZHRoOjEwMHZ3O3doaXRlLXNwYWNlOm5vd3JhcDtvdmVyZmxvdzpoaWRkZW47dGV4dC1vdmVyZmxvdzplbGxpcHNpc30jcG9wdXAtc2lkZWJhcnt3aWR0aDoxNTBweH0jcG9wdXAtY29udGVudCBoZWFkZXJ7ZGlzcGxheTpub25lfSNwb3B1cC1jb250ZW50IGg0e2Rpc3BsYXk6bm9uZX0jaGVhZGVye2dyaWQtdGVtcGxhdGUtY29sdW1uczoxZnI7cG9zaXRpb246cmVsYXRpdmU7ei1pbmRleDo5OTl9I2hlYWRlciBwe3BhZGRpbmc6NXB4IDVweCA1cHggMTBweDtoZWlnaHQ6MTJweDt0ZXh0LWFsaWduOnJpZ2h0O2JhY2tncm91bmQ6I2ZmOTQyMX0jaGVhZGVyIHAgc3BhbiwjaGVhZGVyIHAgc3Ryb25ne2Rpc3BsYXk6aW5saW5lO3BhZGRpbmc6MDttYXJnaW46MDtmb250LXNpemU6MTRweDtjb2xvcjojZmZkYWIyfSNoZWFkZXIgcCBzdHJvbmd7Y29sb3I6I2ZmZjtmb250LXdlaWdodDo3MDB9Ym9keT5tYWluLmNvbnRhaW5lcntncmlkLXRlbXBsYXRlLWNvbHVtbnM6MWZyfSN0b2dnbGVfc2lkZWJhcntkaXNwbGF5OmJsb2NrO3BhZGRpbmc6MTBweDtmb250LXNpemU6MS4zZW07Zm9udC13ZWlnaHQ6NjAwO3RleHQtYWxpZ246Y2VudGVyO2JhY2tncm91bmQ6I2ZmZGFiMn0jdG9nZ2xlX3NpZGViYXI6bGluaywjdG9nZ2xlX3NpZGViYXI6dmlzaXRlZHtjb2xvcjojZmY5NDIxO3RleHQtZGVjb3JhdGlvbjpub25lfSN0b2dnbGVfc2lkZWJhcjphY3RpdmUsI3RvZ2dsZV9zaWRlYmFyOmhvdmVye2NvbG9yOiM5YTlhOWF9I3NpZGViYXItbWVudXtkaXNwbGF5Om5vbmU7cG9zaXRpb246Zml4ZWQ7dG9wOjE2MHB4O2xlZnQ6MDt3aWR0aDoxMDB2dztoZWlnaHQ6Y2FsYygxMDB2aCAtIDE2MHB4KTtvdmVyZmxvdzpzY3JvbGw7YmFja2dyb3VuZC1jb2xvcjojZTdlYmVkfSNzZWN0aW9uLWhlYWRlciBkaXZ7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjFmcn0jc2VjdGlvbi1oZWFkZXIgZGl2IHNlY3Rpb257dGV4dC1hbGlnbjpjZW50ZXJ9I3BvcHVwLWNvbnRhaW5lcnt3aWR0aDoxOTAwcHh9I3BvcHVwLXNpZGViYXIgdWx7dGV4dC1hbGlnbjpjZW50ZXJ9I3BvcHVwLXNpZGViYXIgaW1ne3dpZHRoOjE1MHB4fSNwb3B1cC1zaWRlYmFyIGxpe2Rpc3BsYXk6aW5saW5lLWJsb2NrO21hcmdpbjowIDNweH0jcG9wdXAtY29udGVudCBoZWFkZXJ7Z3JpZC10ZW1wbGF0ZS1jb2x1bW5zOjFmcn0jcG9wdXAtY29udGVudCBoM3t0ZXh0LWFsaWduOmNlbnRlcn0jcG9wdXBfc2Vhc29ucyBhcnRpY2xle2dyaWQtdGVtcGxhdGUtY29sdW1uczoxZnIgMmZyO2dyaWQtdGVtcGxhdGUtYXJlYXM6InBvcHVwLXNlYXNvbnMgcG9wdXAtc2Vhc29ucyIgInBvcHVwLWVwaXNvZGVzIHBvcHVwLWVwaXNvZGUifSNwb3B1cF9zZWFzb25zX3NlYXNvbnMgbGl7ZGlzcGxheTppbmxpbmUtZmxleDttYXJnaW46MCAzcHh9I3BvcHVwLWNvbnRlbnQgYS5jbG9zZXtyaWdodDo1cHg7dG9wOjVweH0jcG9wdXAtY29udGVudCBwe292ZXJmbG93OmhpZGRlbjtkaXNwbGF5Oi13ZWJraXQtYm94Oy13ZWJraXQtbGluZS1jbGFtcDo5Oy13ZWJraXQtYm94LW9yaWVudDp2ZXJ0aWNhbH19Lm1ldGVye2JveC1zaXppbmc6Y29udGVudC1ib3g7aGVpZ2h0OjIwcHg7cG9zaXRpb246cmVsYXRpdmU7bWFyZ2luOjYwcHggMCAyMHB4IDA7YmFja2dyb3VuZDojNTU1O2JvcmRlci1yYWRpdXM6MjVweDtwYWRkaW5nOjEwcHg7Ym94LXNoYWRvdzppbnNldCAwIC0xcHggMXB4IHJnYmEoMjU1LDI1NSwyNTUsLjMpfS5tZXRlcj5zcGFue2Rpc3BsYXk6YmxvY2s7aGVpZ2h0OjEwMCU7Ym9yZGVyLXRvcC1yaWdodC1yYWRpdXM6OHB4O2JvcmRlci1ib3R0b20tcmlnaHQtcmFkaXVzOjhweDtib3JkZXItdG9wLWxlZnQtcmFkaXVzOjIwcHg7Ym9yZGVyLWJvdHRvbS1sZWZ0LXJhZGl1czoyMHB4O2JhY2tncm91bmQtY29sb3I6IzJiYzI1MztiYWNrZ3JvdW5kLWltYWdlOmxpbmVhci1ncmFkaWVudChjZW50ZXIgYm90dG9tLCMyYmMyNTMgMzclLCM1NGYwNTQgNjklKTtib3gtc2hhZG93Omluc2V0IDAgMnB4IDlweCByZ2JhKDI1NSwyNTUsMjU1LC4zKSxpbnNldCAwIC0ycHggNnB4IHJnYmEoMCwwLDAsLjQpO3Bvc2l0aW9uOnJlbGF0aXZlO292ZXJmbG93OmhpZGRlbn0uYW5pbWF0ZT5zcGFuPnNwYW4sLm1ldGVyPnNwYW46YWZ0ZXJ7Y29udGVudDoiIjtwb3NpdGlvbjphYnNvbHV0ZTt0b3A6MDtsZWZ0OjA7Ym90dG9tOjA7cmlnaHQ6MDtiYWNrZ3JvdW5kLWltYWdlOmxpbmVhci1ncmFkaWVudCgtNDVkZWcscmdiYSgyNTUsMjU1LDI1NSwuMikgMjUlLHRyYW5zcGFyZW50IDI1JSx0cmFuc3BhcmVudCA1MCUscmdiYSgyNTUsMjU1LDI1NSwuMikgNTAlLHJnYmEoMjU1LDI1NSwyNTUsLjIpIDc1JSx0cmFuc3BhcmVudCA3NSUsdHJhbnNwYXJlbnQpO3otaW5kZXg6MTtiYWNrZ3JvdW5kLXNpemU6NTBweCA1MHB4O2FuaW1hdGlvbjptb3ZlIDJzIGxpbmVhciBpbmZpbml0ZTtib3JkZXItdG9wLXJpZ2h0LXJhZGl1czo4cHg7Ym9yZGVyLWJvdHRvbS1yaWdodC1yYWRpdXM6OHB4O2JvcmRlci10b3AtbGVmdC1yYWRpdXM6MjBweDtib3JkZXItYm90dG9tLWxlZnQtcmFkaXVzOjIwcHg7b3ZlcmZsb3c6aGlkZGVufS5hbmltYXRlPnNwYW46YWZ0ZXJ7ZGlzcGxheTpub25lfUBrZXlmcmFtZXMgbW92ZXswJXtiYWNrZ3JvdW5kLXBvc2l0aW9uOjAgMH0xMDAle2JhY2tncm91bmQtcG9zaXRpb246NTBweCA1MHB4fX0ubm9zdHJpcGVzPnNwYW46OmFmdGVyLC5ub3N0cmlwZXM+c3Bhbj5zcGFue2JhY2tncm91bmQtaW1hZ2U6bm9uZX08L3N0eWxlPjxzY3JpcHQgc3JjPSJodHRwOi8vY29kZS5qcXVlcnkuY29tL2pxdWVyeS0xLjkuMS5taW4uanMidHlwZT0idGV4dC9qYXZhc2NyaXB0Ij48L3NjcmlwdD48c2NyaXB0PmNvbnN0IHJlYWR5ID0gY2FsbGJhY2sgPT4gewogIGlmIChkb2N1bWVudC5yZWFkeVN0YXRlICE9PSAnbG9hZGluZycpIGNhbGxiYWNrKCk7CiAgZWxzZSBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCdET01Db250ZW50TG9hZGVkJywgY2FsbGJhY2spOwp9OwoKCgoKCmZ1bmN0aW9uIHJlc2l6ZUlmcmFtZShvYmopIHsKICAvL29iai5zdHlsZS5oZWlnaHQgPSBvYmouY29udGVudFdpbmRvdy5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0ICsgJ3B4JzsKICAgIC8vb2JqLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbEhlaWdodAogIC8vc2V0VGltZW91dChmdW5jdGlvbigpeyBvYmouc3R5bGUuaGVpZ2h0ID0gb2JqLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbEhlaWdodCArICdweCc7IH0sIDEwMDAwKTsKICAvL3NldFRpbWVvdXQoZnVuY3Rpb24oKXsgIGFsZXJ0KG9iai5jb250ZW50V2luZG93LmRvY3VtZW50LmJvZHkuaW5uZXJIVE1MKTsgfSwgMTAwMDApOwogIC8vc2V0VGltZW91dChmdW5jdGlvbigpeyAgYWxlcnQob2JqLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQuYm9keS5zY3JvbGxIZWlnaHQpOyB9LCA1MDAwKTsKICAgIAogICAgCiAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgdmFyIHRoZUZyYW1lID0gb2JqLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQuYm9keS5pbm5lckhUTUw7CiAgICAgIHZhciB0aGVDb3VudCA9ICh0aGVGcmFtZS5tYXRjaCgvUmVzb2x1dGlvbi9nKSB8fCBbXSkubGVuZ3RoOwogICAgICBvYmouc3R5bGUuaGVpZ2h0ID0gKHRoZUNvdW50ICogNjUpICsgJ3B4JzsgICB9LCAxMDAwKTsKICAgIAogICAgCiAgc2V0VGltZW91dChmdW5jdGlvbigpeyB2YXIgdGhlRnJhbWUgPSBvYmouY29udGVudFdpbmRvdy5kb2N1bWVudC5ib2R5LmlubmVySFRNTDsgIAogIHZhciB0aGVDb3VudCA9ICh0aGVGcmFtZS5tYXRjaCgvUmVzb2x1dGlvbi9nKSB8fCBbXSkubGVuZ3RoOwogIG9iai5zdHlsZS5oZWlnaHQgPSAodGhlQ291bnQgKiA2NSkgKyAncHgnOyAgIH0sIDUwMDApOwogICAgCiAgc2V0VGltZW91dChmdW5jdGlvbigpeyB2YXIgdGhlRnJhbWUgPSBvYmouY29udGVudFdpbmRvdy5kb2N1bWVudC5ib2R5LmlubmVySFRNTDsgIAogIHZhciB0aGVDb3VudCA9ICh0aGVGcmFtZS5tYXRjaCgvUmVzb2x1dGlvbi9nKSB8fCBbXSkubGVuZ3RoOwogIG9iai5zdHlsZS5oZWlnaHQgPSAodGhlQ291bnQgKiA2NSkgKyAncHgnOyAgIH0sIDEwMDAwKTsKICAgIAogIHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgdmFyIHRoZUZyYW1lID0gb2JqLmNvbnRlbnRXaW5kb3cuZG9jdW1lbnQuYm9keS5pbm5lckhUTUw7ICAKICB2YXIgdGhlQ291bnQgPSAodGhlRnJhbWUubWF0Y2goL1Jlc29sdXRpb24vZykgfHwgW10pLmxlbmd0aDsKICBvYmouc3R5bGUuaGVpZ2h0ID0gKHRoZUNvdW50ICogNjUpICsgJ3B4JzsgICB9LCAxNTAwMCk7CiAgICAgCiAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IHZhciB0aGVGcmFtZSA9IG9iai5jb250ZW50V2luZG93LmRvY3VtZW50LmJvZHkuaW5uZXJIVE1MOyAgCiAgdmFyIHRoZUNvdW50ID0gKHRoZUZyYW1lLm1hdGNoKC9SZXNvbHV0aW9uL2cpIHx8IFtdKS5sZW5ndGg7CiAgb2JqLnN0eWxlLmhlaWdodCA9ICh0aGVDb3VudCAqIDY1KSArICdweCc7ICAgfSwgMjAwMDApOwogIAogICAgc2V0VGltZW91dChmdW5jdGlvbigpeyB2YXIgdGhlRnJhbWUgPSBvYmouY29udGVudFdpbmRvdy5kb2N1bWVudC5ib2R5LmlubmVySFRNTDsgIAogIHZhciB0aGVDb3VudCA9ICh0aGVGcmFtZS5tYXRjaCgvUmVzb2x1dGlvbi9nKSB8fCBbXSkubGVuZ3RoOwogIG9iai5zdHlsZS5oZWlnaHQgPSAodGhlQ291bnQgKiA2NSkgKyAncHgnOyAgIH0sIDI1MDAwKTsKICAKICAgIAogICAgc2V0VGltZW91dChmdW5jdGlvbigpeyB2YXIgdGhlRnJhbWUgPSBvYmouY29udGVudFdpbmRvdy5kb2N1bWVudC5ib2R5LmlubmVySFRNTDsgIAogIHZhciB0aGVDb3VudCA9ICh0aGVGcmFtZS5tYXRjaCgvUmVzb2x1dGlvbi9nKSB8fCBbXSkubGVuZ3RoOwogIG9iai5zdHlsZS5oZWlnaHQgPSAodGhlQ291bnQgKiA2NSkgKyAncHgnOyAgIH0sIDMwMDAwKTsKICAKfQoKZnVuY3Rpb24gcmVzaXplSWZyYW1lV2lkdGgoZSl7CiAgICAvLyBTZXQgd2lkdGggb2YgaWZyYW1lIGFjY29yZGluZyB0byBpdHMgY29udGVudAogICAgaWYgKGUuRG9jdW1lbnQgJiYgZS5Eb2N1bWVudC5ib2R5LnNjcm9sbFdpZHRoKSAvL2llNSsgc3ludGF4CiAgICAgICAgZS53aWR0aCA9IGUuY29udGVudFdpbmRvdy5kb2N1bWVudC5ib2R5LnNjcm9sbFdpZHRoOwogICAgZWxzZSBpZiAoZS5jb250ZW50RG9jdW1lbnQgJiYgZS5jb250ZW50RG9jdW1lbnQuYm9keS5zY3JvbGxXaWR0aCkgLy9uczYrICYgb3BlcmEgc3ludGF4CiAgICAgICAgZS53aWR0aCA9IGUuY29udGVudERvY3VtZW50LmJvZHkuc2Nyb2xsV2lkdGggKyAzNTsKICAgIGVsc2UgKGUuY29udGVudERvY3VtZW50ICYmIGUuY29udGVudERvY3VtZW50LmJvZHkub2Zmc2V0V2lkdGgpIC8vc3RhbmRhcmRzIGNvbXBsaWFudCBzeW50YXgg4oCTIGllOAogICAgICAgIGUud2lkdGggPSBlLmNvbnRlbnREb2N1bWVudC5ib2R5Lm9mZnNldFdpZHRoICsgMzU7Cn0KCmZ1bmN0aW9uIGF1dG9SZXNpemUoaWZyYW1lKSB7CiAgICAkKGlmcmFtZSkuaGVpZ2h0KCQoaWZyYW1lKS5jb250ZW50cygpLmZpbmQoJ2h0bWwnKS5oZWlnaHQoKSk7Cn0KCgpmdW5jdGlvbiBhdXRvUmVzaXplMigpIHsKICAgIHNldFRpbWVvdXQoImF1dG9SZXNpemUodGhpcykiLCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA2KSArIDMwMDApOwp9CgoKCmZ1bmN0aW9uIHJlc2l6ZVBpYyhvYmopIHsKICAgIAogICAgCS8vZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIiIpCiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbigpIHsgb2JqLnN0eWxlLmhlaWdodCA9IDMwMCArICdweCc7IH0sIDMwMDAgKTsKICAgIAkgICAKfQoKCgovL3NldEludGVydmFsKGZ1bmN0aW9uKCl7Ci8vICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbWFnZSIpLnN0eWxlLnZpc2liaWxpdHk9IGhpZGRlbiA/ICJ2aXNpYmxlIiA6ICJoaWRkZW4iOwogIC8vICBoaWRkZW4gPSAhaGlkZGVuOwovL30sMjAwMCk7CgoKCgoKZnVuY3Rpb24gc2hvd01vdklEKCkgeyAKICAgIHZhciBjdXJVUkwyID0gd2luZG93LmxvY2F0aW9uLmhyZWY7ICAgCiAJdmFyIHNlYXJjaHF1ZXJ5MiA9IChjdXJVUkwyLnN1YnN0cmluZyhjdXJVUkwyLmxhc3RJbmRleE9mKCIvIikgKyAxKSk7IAogICAgc2VhcmNocXVlcnkyID0gZGVjb2RlVVJJKHNlYXJjaHF1ZXJ5Mik7ICAKICAgIHNlYXJjaHF1ZXJ5MiA9IHNlYXJjaHF1ZXJ5Mi5yZXBsYWNlKC8sL2csICcnKTsgIAogICAgc2VhcmNocXVlcnkyID0gc2VhcmNocXVlcnkyLnJlcGxhY2UoLycvZywgJycpOyAKICAgIC8vYWxlcnQoc2VhcmNocXVlcnkyKTsKICAgIHZhciBjc3ZGaWxlID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICBjc3ZGaWxlLm9wZW4oIkdFVCIsICIuL3BsZXhTZXJ2ZXJzLnR4dCIsIHRydWUpOwogICAgY3N2RmlsZS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKGNzdkZpbGUucmVhZHlTdGF0ZSA9PT0gNCkgeyAgLy8gTWFrZXMgc3VyZSB0aGUgZG9jdW1lbnQgaXMgcmVhZHkgdG8gcGFyc2UuCiAgICAgICAgaWYgKGNzdkZpbGUuc3RhdHVzID09PSAyMDApIHsgIC8vIE1ha2VzIHN1cmUgaXQncyBmb3VuZCB0aGUgZmlsZS4KICAgICAgICAgIGFsbFRleHQgPSBjc3ZGaWxlLnJlc3BvbnNlVGV4dDsKICAgICAgICAgIGxpbmVzID0gY3N2RmlsZS5yZXNwb25zZVRleHQuc3BsaXQoIlxuIik7IC8vIFdpbGwgc2VwYXJhdGUgZWFjaCBsaW5lIGludG8gYW4gYXJyYXkKICAgICAgICAgIGFsZXJ0KGFsbFRleHQpOwogICAgICAgIH0KICAgICAgfQogICAgfSAKICAgIHZhciB0YWdzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoImEiKTsKICAgICAgICBmb3IodmFyIGk9MDtpPHRhZ3MubGVuZ3RoO2krKykgewogICAgICAgICAgIHZhciB0YWdzMiA9ICh0YWdzW2ldLmdldEF0dHJpYnV0ZSgiaHJlZiIpKTsKICAgICAgICAgICBpZiAodGFnczIuaW5jbHVkZXMoImh0dHAiKSkgewogICAgICAgICAgICAgICAvL2RvY3VtZW50LndyaXRlKCI8aWZyYW1lIHNyYz0ndGFnczInPjwvaWZyYW1lPiIpOyAKICAgICAgICAgICAgICAgYWxlcnQodGFnczIpOwogICAgICAgICAgIH0KICAgICAgICB9Cn0gICAgCgpmdW5jdGlvbiBzaG93TW92SUQyKCkgewogICAgc2V0VGltZW91dCgic2hvd01vdklEKCkiLCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA2KSArIDEpOwp9CgoKZnVuY3Rpb24gc2hvd0J1eU5vdygpIHsgCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIkJ1eU5vdyIpLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsgCn0gICAgCgpmdW5jdGlvbiBzaG93QnV5Tm93MigpIHsKICAgIHNldFRpbWVvdXQoInNob3dCdXlOb3coKSIsIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDYpICsgMzAwMCk7Cn0KCmZ1bmN0aW9uIHNob3dGaWxlTmFtZSgpIHsgCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIkZpbGVOYW1lIikuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOyAKfSAgICAKCmZ1bmN0aW9uIHNob3dGaWxlTmFtZTIoKSB7CiAgICBzZXRUaW1lb3V0KCJzaG93RmlsZU5hbWUoKSIsIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDYpICsgMzAwMCk7Cn0KCmZ1bmN0aW9uIHNob3dGaWxlU2l6ZSgpIHsgCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIkZpbGVTaXplIikuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOyAKfSAgICAKCmZ1bmN0aW9uIHNob3dGaWxlU2l6ZTIoKSB7CiAgICBzZXRUaW1lb3V0KCJzaG93RmlsZVNpemUoKSIsIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDYpICsgMzAwMCk7Cn0KCmZ1bmN0aW9uIHNob3dCaXRSYXRlKCkgeyAKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiQml0UmF0ZSIpLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsgCn0gICAgCgpmdW5jdGlvbiBzaG93Qml0UmF0ZTIoKSB7CiAgICBzZXRUaW1lb3V0KCJzaG93Qml0UmF0ZSgpIiwgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNikgKyAzMDAwKTsKfQoKZnVuY3Rpb24gc2hvd1ZpZGVvUmVzKCkgeyAKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiVmlkZW9SZXMiKS5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7IAp9ICAgIAoKZnVuY3Rpb24gc2hvd1ZpZGVvUmVzMigpIHsKICAgIHNldFRpbWVvdXQoInNob3dWaWRlb1JlcygpIiwgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNikgKyAzMDAwKTsKfQoKZnVuY3Rpb24gc2hvd1ZpZGVvQ29kZWMoKSB7IAogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJWaWRlb0NvZGVjIikuc3R5bGUuZGlzcGxheSA9ICJpbmxpbmUiOyAKfSAgICAKCmZ1bmN0aW9uIHNob3dWaWRlb0NvZGVjMigpIHsKICAgIHNldFRpbWVvdXQoInNob3dWaWRlb0NvZGVjKCkiLCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA2KSArIDMwMDApOwp9CgpmdW5jdGlvbiBzaG93QXVkaW9Db2RlYygpIHsgCiAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIkF1ZGlvQ29kZWMiKS5zdHlsZS5kaXNwbGF5ID0gImlubGluZSI7IAp9ICAgIAoKZnVuY3Rpb24gc2hvd0F1ZGlvQ29kZWMyKCkgewogICAgc2V0VGltZW91dCgic2hvd0F1ZGlvQ29kZWMoKSIsIE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIDYpICsgMzAwMCk7Cn0KCmZ1bmN0aW9uIHNob3dBdWRpb0NoYW5uZWxzKCkgeyAKICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiQXVkaW9DaGFubmVscyIpLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsgCn0gICAgCgpmdW5jdGlvbiBzaG93QXVkaW9DaGFubmVsczIoKSB7CiAgICBzZXRUaW1lb3V0KCJzaG93QXVkaW9DaGFubmVscygpIiwgTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogNikgKyAzMDAwKTsKfQpmdW5jdGlvbiBzaG93QXNwZWN0UmF0aW8oKSB7IAogIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJBc3BlY3RSYXRpbyIpLnN0eWxlLmRpc3BsYXkgPSAiaW5saW5lIjsgCn0gICAgCgpmdW5jdGlvbiBzaG93QXNwZWN0UmF0aW8yKCkgewogICAgc2V0VGltZW91dCgic2hvd0FzcGVjdFJhdGlvKCkiLCBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA2KSArIDMwMDApOwp9CgoKCmZ1bmN0aW9uIGVwaXNvZGVfdGFnKHNlYXNvbiwgZXBpc29kZSkgewogIGNvbnN0IHMgPSBzZWFzb24uaW5kZXg7CiAgY29uc3QgZSA9IGVwaXNvZGUuaW5kZXg7CiAgbGV0IHIgPSBzIDwgMTAgPyBgUzAke3N9YCA6IGBTJHtzfWA7CiAgciArPSBlIDwgMTAgPyBgRTAke2V9YCA6IGBFJHtlfWA7CiAgcmV0dXJuIHI7Cn0gLy8gZW5kIGZ1bmM6IGVwaXNvZGVfdGFnCgpmdW5jdGlvbiBudW1iZXJfZm9ybWF0KG51bUluKSB7CiAgbGV0IG51bSA9IHBhcnNlSW50KG51bUluKTsKICBpZiAobnVtIDwgMTAwMCkgcmV0dXJuIG51bTsKICBudW0gPSBudW0udG9TdHJpbmcoKTsKICBjb25zdCByZ3ggPSAvKFxkKykoXGR7M30pLzsKICB3aGlsZSAocmd4LnRlc3QobnVtKSkgewogICAgbnVtID0gbnVtLnJlcGxhY2Uocmd4LCAnJDEnICsgJywnICsgJyQyJyk7CiAgfQogIHJldHVybiBudW07Cn0gLy8gZW5kIGZ1bmM6IG51bWJlcl9mb3JtYXQKCmZ1bmN0aW9uIGluZmxlY3QobnVtLCBzaW5nbGUsIHBsdXJhbCkgewogIGlmIChudW0gPT09IDEpIHJldHVybiBzaW5nbGU7CiAgaWYgKHBsdXJhbCkgcmV0dXJuIHBsdXJhbDsKICByZXR1cm4gYCR7c2luZ2xlfXNgOwp9IC8vIGVuZCBmdW5jOiBpbmZsZWN0CgpmdW5jdGlvbiBobF9ieXRlc190b19odW1hbihieXRlcykgewogIGNvbnN0IGIgPSBwYXJzZUludChieXRlcyk7CiAgaWYgKGIgPCAxMDI0KSByZXR1cm4gYCR7Yn0gYmA7CiAgbGV0IGtiID0gYiAvIDEwMjQ7CiAgaWYgKGtiIDwgMTAyNCkgcmV0dXJuIGAke01hdGgucm91bmQoa2IgKiAxMDApIC8gMTAwfSBLYmA7CiAgY29uc3QgbWIgPSBrYiAvIDEwMjQ7CiAgaWYgKG1iIDwgMTAyNCkgcmV0dXJuIGAke01hdGgucm91bmQobWIgKiAxMDApIC8gMTAwfSBNYmA7CiAgY29uc3QgZ2IgPSBtYiAvIDEwMjQ7CiAgaWYgKGdiIDwgMTAyNCkgcmV0dXJuIGAke01hdGgucm91bmQoZ2IgKiAxMDApIC8gMTAwfSBHYmA7CiAgY29uc3QgcGIgPSBnYiAvIDEwMjQ7CiAgcmV0dXJuIGAke01hdGgucm91bmQocGIgKiAxMDApIC8gMTAwfSBQYmA7CiAgaWYgKGJ5dGVzIDwgMTA3Mzc0MTgyNCkKICAgIHJldHVybiBgJHtNYXRoLnJvdW5kKChieXRlcyAvIDEwNDg1NzYpICogMTAwKSAvIDEwMH0gTWJgOwogIGtiID0gYiAvIDEwMjQ7CiAgaWYgKGJ5dGVzIDwgMTA5OTUxMTYyNzc3NikKICAgIHJldHVybiBgJHtNYXRoLnJvdW5kKChieXRlcyAvIDEwNzM3NDE4MjQpICogMTAwKSAvIDEwMH0gR2JgOwogIHJldHVybiBgJHtieXRlc30gWGJgOwp9IC8vIGVuZCBmdW5jOiBobF9ieXRlc190b19odW1hbgoKLy8gRlggRnVuY3Rpb24gfiBodHRwczovL2NvZGVwZW4uaW8vZ2FicmllbGVyb21hbmF0by9wZW4vZnJJd2wKKGZ1bmN0aW9uKCkgewogIGNvbnN0IEZYID0gewogICAgZWFzaW5nOiB7CiAgICAgIGxpbmVhcihwcm9ncmVzcykgewogICAgICAgIHJldHVybiBwcm9ncmVzczsKICAgICAgfSwKICAgICAgcXVhZHJhdGljKHByb2dyZXNzKSB7CiAgICAgICAgcmV0dXJuIE1hdGgucG93KHByb2dyZXNzLCAyKTsKICAgICAgfSwKICAgICAgc3dpbmcocHJvZ3Jlc3MpIHsKICAgICAgICByZXR1cm4gMC41IC0gTWF0aC5jb3MocHJvZ3Jlc3MgKiBNYXRoLlBJKSAvIDI7CiAgICAgIH0sCiAgICAgIGNpcmMocHJvZ3Jlc3MpIHsKICAgICAgICByZXR1cm4gMSAtIE1hdGguc2luKE1hdGguYWNvcyhwcm9ncmVzcykpOwogICAgICB9LAogICAgICBiYWNrKHByb2dyZXNzLCB4KSB7CiAgICAgICAgcmV0dXJuIE1hdGgucG93KHByb2dyZXNzLCAyKSAqICgoeCArIDEpICogcHJvZ3Jlc3MgLSB4KTsKICAgICAgfSwKICAgICAgYm91bmNlKHByb2dyZXNzKSB7CiAgICAgICAgZm9yICh2YXIgYSA9IDAsIGIgPSAxLCByZXN1bHQ7IDE7IGEgKz0gYiwgYiAvPSAyKSB7CiAgICAgICAgICBpZiAocHJvZ3Jlc3MgPj0gKDcgLSA0ICogYSkgLyAxMSkgewogICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgIC1NYXRoLnBvdygoMTEgLSA2ICogYSAtIDExICogcHJvZ3Jlc3MpIC8gNCwgMikgKyBNYXRoLnBvdyhiLCAyKQogICAgICAgICAgICApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSwKICAgICAgZWxhc3RpYyhwcm9ncmVzcywgeCkgewogICAgICAgIHJldHVybiAoCiAgICAgICAgICBNYXRoLnBvdygyLCAxMCAqIChwcm9ncmVzcyAtIDEpKSAqCiAgICAgICAgICBNYXRoLmNvcygoKDIwICogTWF0aC5QSSAqIHgpIC8gMykgKiBwcm9ncmVzcykKICAgICAgICApOwogICAgICB9LAogICAgfSwKICAgIGFuaW1hdGUob3B0aW9ucykgewogICAgICBjb25zdCBzdGFydCA9IG5ldyBEYXRlKCk7CiAgICAgIGNvbnN0IGlkID0gc2V0SW50ZXJ2YWwoZnVuY3Rpb24oKSB7CiAgICAgICAgY29uc3QgdGltZVBhc3NlZCA9IG5ldyBEYXRlKCkgLSBzdGFydDsKICAgICAgICBsZXQgcHJvZ3Jlc3MgPSB0aW1lUGFzc2VkIC8gb3B0aW9ucy5kdXJhdGlvbjsKICAgICAgICBpZiAocHJvZ3Jlc3MgPiBvcHRpb25zLnNldFRvKSB7CiAgICAgICAgICBwcm9ncmVzcyA9IG9wdGlvbnMuc2V0VG87CiAgICAgICAgfQogICAgICAgIG9wdGlvbnMucHJvZ3Jlc3MgPSBwcm9ncmVzczsKICAgICAgICBjb25zdCBkZWx0YSA9IG9wdGlvbnMuZGVsdGEocHJvZ3Jlc3MpOwogICAgICAgIG9wdGlvbnMuc3RlcChkZWx0YSk7CiAgICAgICAgaWYgKHByb2dyZXNzID09PSBvcHRpb25zLnNldFRvKSB7CiAgICAgICAgICBjbGVhckludGVydmFsKGlkKTsKICAgICAgICAgIC8vIFJlc2V0IHN0eWxlcwogICAgICAgICAgb3B0aW9ucy5lbGVtZW50LnN0eWxlLmRpc3BsYXkgPQogICAgICAgICAgICBvcHRpb25zLnR5cGUgPT09ICdpbicgPyAnYmxvY2snIDogJ25vbmUnOwogICAgICAgICAgb3B0aW9ucy5lbGVtZW50LnN0eWxlLm9wYWNpdHkgPSBudWxsOwogICAgICAgICAgaWYgKG9wdGlvbnMuY29tcGxldGUpIG9wdGlvbnMuY29tcGxldGUoKTsKICAgICAgICB9CiAgICAgIH0sIG9wdGlvbnMuZGVsYXkgfHwgMTApOwogICAgfSwKICAgIGZhZGVPdXQoZWxlbWVudCwgb3B0aW9ucyA9IHsgZHVyYXRpb246IDQwMCwgc2V0VG86IDEsIGNvbXBsZXRlOiBudWxsIH0pIHsKICAgICAgY29uc3QgdG8gPSAxOwogICAgICB0aGlzLmFuaW1hdGUoewogICAgICAgIHR5cGU6ICdvdXQnLAogICAgICAgIGVsZW1lbnQsCiAgICAgICAgZHVyYXRpb246IG9wdGlvbnMuZHVyYXRpb24sCiAgICAgICAgc2V0VG86IG9wdGlvbnMuc2V0VG8sCiAgICAgICAgZGVsdGEocHJvZ3Jlc3MpIHsKICAgICAgICAgIHByb2dyZXNzID0gdGhpcy5wcm9ncmVzczsKICAgICAgICAgIHJldHVybiBGWC5lYXNpbmcuc3dpbmcocHJvZ3Jlc3MpOwogICAgICAgIH0sCiAgICAgICAgY29tcGxldGU6IG9wdGlvbnMuY29tcGxldGUsCiAgICAgICAgc3RlcChkZWx0YSkgewogICAgICAgICAgZWxlbWVudC5zdHlsZS5vcGFjaXR5ID0gdG8gLSBkZWx0YTsKICAgICAgICB9LAogICAgICB9KTsKICAgIH0sCiAgICBmYWRlSW4oZWxlbWVudCwgb3B0aW9ucyA9IHsgZHVyYXRpb246IDQwMCwgc2V0VG86IDEsIGNvbXBsZXRlOiBudWxsIH0pIHsKICAgICAgY29uc3QgdG8gPSAwOwogICAgICB0aGlzLmFuaW1hdGUoewogICAgICAgIHR5cGU6ICdpbicsCiAgICAgICAgZWxlbWVudCwKICAgICAgICBkdXJhdGlvbjogb3B0aW9ucy5kdXJhdGlvbiwKICAgICAgICBzZXRUbzogb3B0aW9ucy5zZXRUbywKICAgICAgICBkZWx0YShwcm9ncmVzcykgewogICAgICAgICAgcHJvZ3Jlc3MgPSB0aGlzLnByb2dyZXNzOwogICAgICAgICAgcmV0dXJuIEZYLmVhc2luZy5zd2luZyhwcm9ncmVzcyk7CiAgICAgICAgfSwKICAgICAgICBjb21wbGV0ZTogb3B0aW9ucy5jb21wbGV0ZSwKICAgICAgICBzdGVwKGRlbHRhKSB7CiAgICAgICAgICBlbGVtZW50LnN0eWxlLm9wYWNpdHkgPSB0byArIGRlbHRhOwogICAgICAgIH0sCiAgICAgIH0pOwogICAgfSwKICB9OwogIHdpbmRvdy5GWCA9IEZYOwp9KSgpOzwvc2NyaXB0PjxzY3JpcHQ+JCgiLm1ldGVyID4gc3BhbiIpLmVhY2goZnVuY3Rpb24oKXskKHRoaXMpLmRhdGEoIm9yaWdXaWR0aCIsJCh0aGlzKS53aWR0aCgpKS53aWR0aCgyMCkuYW5pbWF0ZSh7d2lkdGg6JCh0aGlzKS5kYXRhKCJvcmlnV2lkdGgiKX0sMzZlMyl9KTwvc2NyaXB0PjxzY3JpcHQgc3JjPSJsYXp5c2l6ZXMubWluLmpzImFzeW5jPjwvc2NyaXB0PjxzY3JpcHQ+Y29uc3QgUExFWCA9IHsKICBzZWN0aW9uczoge30sCiAgdG90YWxfaXRlbXM6IDAsCiAgY3VycmVudF9zZWN0aW9uOiBmYWxzZSwKICBjdXJyZW50X2l0ZW06IGZhbHNlLAogIHByZXZpb3VzX2l0ZW1faWQ6IDAsCiAgbmV4dF9pdGVtX2lkOiAwLAogIGN1cnJlbnRfc29ydF9rZXk6ICd0aXRsZScsCiAgY3VycmVudF9zb3J0X29yZGVyOiAnZGVzYycsCiAgY3VycmVudF9nZW5yZTogJ2FsbCcsCiAgY3VycmVudF9kaXJlY3RvcjogJ2FsbCcsCiAgc2hvd19hbGxfZ2VucmVzOiBmYWxzZSwKICBzaG93X2FsbF9kaXJlY3RvcnM6IGZhbHNlLAogIGRhdGFfbG9hZGVkOiBmYWxzZSwKICBmaWx0ZXJfdGltZW91dDogZmFsc2UsCiAgZmlsdGVyX2RlbGF5OiAzNTAsCiAgcG9wdXBfdmlzaWJsZTogZmFsc2UsCiAgbGFzdF91cGRhdGVkOiAnbm9uZScsCiAgCgogIC8qIQogICAqIExvYWQgdGhlIGRhdGEgZnJvbSB0aGUgcGxleC1kYXRhL2RhdGEuanMgZmlsZQogICAqLwogIGxvYWRfZGF0YShhRGF0YSkgewogICAgLy8gQ2hlY2sgaWYgYURhdGEgaXMgc2V0CiAgICBpZiAoCiAgICAgICFhRGF0YSB8fAogICAgICAhYURhdGEuc3RhdHVzIHx8CiAgICAgIGFEYXRhLnN0YXR1cyAhPT0gJ3N1Y2Nlc3MnIHx8CiAgICAgIGFEYXRhLm51bV9zZWN0aW9ucyA9PT0gMAogICAgKQogICAgICByZXR1cm4gZmFsc2U7CiAgICAvLyBMb29wIHRocm91Z2ggdGhlIHNlY3Rpb25zIGZyb20gdGhlIG9idGFpbmVkIGRhdGEKICAgIE9iamVjdC5rZXlzKGFEYXRhLnNlY3Rpb25zKS5mb3JFYWNoKHNlY3Rpb25LZXkgPT4gewogICAgICBQTEVYLnNlY3Rpb25zW3NlY3Rpb25LZXldID0gYURhdGEuc2VjdGlvbnNbc2VjdGlvbktleV07IC8vIFNldCBlYWNoIHNlY3Rpb24KICAgIH0pOwogICAgUExFWC50b3RhbF9pdGVtcyA9IGFEYXRhLnRvdGFsX2l0ZW1zOyAvLyBTZXQgdGhlIHRvdGFsIGl0ZW1zCiAgICBQTEVYLnNlY3Rpb25fZGlzcGxheV9vcmRlciA9IGFEYXRhLnNlY3Rpb25fZGlzcGxheV9vcmRlcjsgLy8gU2V0IHRoZSBzZWN0aW9uIGRpc3BsYXkgb3JkZXIKICAgIFBMRVgubGFzdF91cGRhdGVkID0gYURhdGEubGFzdF91cGRhdGVkOyAvLyBTZXQgdGhlIGxhc3QgdXBkYXRlIGR0bQogICAgUExFWC5kYXRhX2xvYWRlZCA9IHRydWU7IC8vIFNldCB0aGUgZGF0YSBsb2FkZWQgYm9vbAogICAgUExFWC5sYXN0X2dlbmVyYXRlZCA9IGFEYXRhLmxhc3RfZ2VuZXJhdGVkOwogIH0sIC8vIGVuZCBmdW5jOiBsb2FkX2RhdGEKCiAgLyohCiAgICogRGlzcGxheSB0aGUgc2VjdGlvbnMgbGlzdCBpbiB0aGUgc2lkZWJhcgogICAqLwogIGRpc3BsYXlfc2VjdGlvbnNfbGlzdCgpIHsKICAgIC8vIEluaXQgdGhlIHNlY3Rpb24gbGlzdCBodG1sCiAgICBsZXQgc2VjdGlvbkxpc3RIVE1MID0gJyc7CiAgICAvLyBMb29wIHRocm91Z2ggdGhlIHNlY3Rpb24gZGlzcGxheSBvcmRlcgogICAgLy8KICAgIFBMRVguc2VjdGlvbl9kaXNwbGF5X29yZGVyLmZvckVhY2goa2V5ID0+IHsKICAgICAgY29uc3Qgc2VjdGlvbiA9IFBMRVguc2VjdGlvbnNba2V5XTsgLy8gR2V0IHRoZSBzZWN0aW9uIGRhdGEKICAgICAgLy8gQWRkIHRvIHRoZSBzZWN0aW9uIGxpc3QgaHRtbAogICAgICBzZWN0aW9uTGlzdEhUTUwgPSAnPGEgaHJlZj0iLi8jMSI+PGxpPjxzcGFuPlBvcHVsYXIgTW92aWVzPC9zcGFuPjwvbGk+PC9hPjxhIGhyZWY9Ii4vQU0ucGhwIzEiPjxsaSBkYXRhLXNlY3Rpb249IjEiPjxzcGFuPkFsbCBNb3ZpZXM8L3NwYW4+PC9saT48L2E+PGEgaHJlZj0iLi9BVFYucGhwIzEiPjxsaT48c3Bhbj5BbGwgVFYgU2hvd3M8L3NwYW4+PC9saT48L2E+PGEgaHJlZj0iLi9SQUUucGhwIzEiPjxsaT48c3Bhbj5SZWNlbnRseSBBZGRlZCBFcGlzb2Rlczwvc3Bhbj48L2xpPjwvYT4nOwogICAgICAgIAogICAgICAgIAogICAgICAgIC8vc2VjdGlvbkxpc3RIVE1MID0gYDxsaSBkYXRhLXNlY3Rpb249IjEyIj48c3Bhbj5SZWNlbnRseSBBZGRlZCBNb3ZpZXM8L3NwYW4+PC9saT48YSBocmVmPSJodHRwczovL2J1bGt1cC5vcmcvcmVzcG9uc2l2ZS1wbGV4L3R2My9BTS5waHAiPjxsaSBkYXRhLXNlY3Rpb249IjYiIGNsYXNzPSJjdXJyZW50IG1vdmllIj48c3Bhbj5BbGwgTW92aWVzPC9zcGFuPjwvbGk+PC9hPjxhIGhyZWY9Imh0dHBzOi8vYnVsa3VwLm9yZy9yZXNwb25zaXZlLXBsZXgvdHYzL0FUVi5waHAiPjxsaSBkYXRhLXNlY3Rpb249IjciPjxzcGFuPkFsbCBUViBTaG93czwvc3Bhbj48L2xpPjwvYT48YSBocmVmPSJodHRwczovL2J1bGt1cC5vcmcvcmVzcG9uc2l2ZS1wbGV4L3R2My9SQUUucGhwIzEiPjxsaSBkYXRhLXNlY3Rpb249IjEiPjxzcGFuPlJlY2VudGx5IEFkZGVkIEVwaXNvZGVzPC9zcGFuPjwvbGk+PC9hPmA7CiAgICAgIAogICAgICAgLy88bGkgZGF0YS1zZWN0aW9uPSIxMiIgY2xhc3M9Im1vdmllIGN1cnJlbnQiPjxzcGFuPlJlY2VudGx5IEFERERlZCBNb3ZpZXM8L3NwYW4+PC9saT48bGkgZGF0YS1zZWN0aW9uPSI2IiBjbGFzcz0ibW92aWUiPjxzcGFuPkFsbCBNb3ZpZXM8L3NwYW4+PC9saT48bGkgZGF0YS1zZWN0aW9uPSI3IiBjbGFzcz0ic2hvdyI+PHNwYW4+QWxsIFRWIFNob3dzPC9zcGFuPjwvbGk+PGxpIGRhdGEtc2VjdGlvbj0iMTEiIGNsYXNzPSJtb3ZpZSI+PHNwYW4+UmVjZW50bHkgQWRkZWQgRXBpc29kZXM8L3NwYW4+PC9saT4KICAgICAgLy88bGkgZGF0YS1zZWN0aW9uPSIke3NlY3Rpb24ua2V5fSIgY2xhc3M9IiR7c2VjdGlvbi50eXBlfSI+PHNwYW4+JHtzZWN0aW9uLnRpdGxlfTwvc3Bhbj48L2xpPgogICAgICAgIAogICAgfSk7CiAgIAogICAgLy8gVXBkYXRlIHRoZSBzZWN0aW9ucyBsaXN0IGlubmVyIEhUTUwKICAgIFBMRVguX3NlY3Rpb25zX2xpc3QuaW5uZXJIVE1MID0gc2VjdGlvbkxpc3RIVE1MOwogIH0sIC8vIGVuZCBmdW5jOiBkaXNwbGF5X3NlY3Rpb25zX2xpc3QKCiAgLyohCiAgICogRGlzcGxheSBhIHNlY3Rpb24gaW4gdGhlIG1haW4gYXJlYQogICAqLwogIGRpc3BsYXlfc2VjdGlvbihzZWN0aW9uSURJbikgewogICAgY29uc3Qgc2VjdGlvbklEID0gcGFyc2VJbnQoc2VjdGlvbklESW4pOwoKICAgIGlmIChzZWN0aW9uSUQgIT09IFBMRVguY3VycmVudF9zZWN0aW9uLmtleSkgewogICAgICAvLyBSZXNldCB0aGUgc2VjdGlvbiBkYXRhCiAgICAgIFBMRVguY3VycmVudF9zb3J0X2tleSA9ICd0aXRsZSc7CiAgICAgIFBMRVguY3VycmVudF9zb3J0X29yZGVyID0gJ2Rlc2MnOwogICAgICBQTEVYLmN1cnJlbnRfZ2VucmUgPSAnYWxsJzsKICAgICAgUExFWC5jdXJyZW50X2RpcmVjdG9yID0gJ2FsbCc7CiAgICAgIFBMRVguY3VycmVudF9zZWVuID0gJ2FsbCc7CiAgICAgIFBMRVguc2hvd19hbGxfZGlyZWN0b3JzID0gZmFsc2U7CiAgICAgIAogICAgICAvLyBSZW1vdmUgYW55IHNldCBzb3J0IGxpc3QgY3VycmVudCBjbGFzcwogICAgICBQTEVYLl9zb3J0c19saXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpLmN1cnJlbnQnKS5mb3JFYWNoKHNvcnRzTGlzdExpID0+IHsKICAgICAgICBzb3J0c0xpc3RMaS5jbGFzc0xpc3QucmVtb3ZlKCdjdXJyZW50Jyk7CiAgICAgIH0pOwogICAgICAvLyBSZW1vdmUgZW0gdGFncyBmcm9tIHRoZSBzb3J0cyBsaXN0CiAgICAgIFBMRVguX3NvcnRzX2xpc3QucXVlcnlTZWxlY3RvckFsbCgnbGkgZW0nKS5mb3JFYWNoKHNvcnRzTGlzdExpRW0gPT4gewogICAgICAgIAogICAgICAgIHNvcnRzTGlzdExpRW0ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChzb3J0c0xpc3RMaUVtKTsKICAgICAgfSk7CiAgICAgLy8gQWRkIHRoZSBjdXJyZW50IGNsYXNzIHRvIHRoZSBzZXQgc29ydCBlbGVtZW50CiAgICAgUExFWC5fc29ydHNfbGlzdAogICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKGBsaVtkYXRhLXNvcnQ9IiR7UExFWC5jdXJyZW50X3NvcnRfa2V5fSJdYCkKICAgICAgICAuZm9yRWFjaChkYXRhU29ydEl0ZW0gPT4gewogICAgICAgICAgaWYgKCFkYXRhU29ydEl0ZW0uY2xhc3NMaXN0LmNvbnRhaW5zKCdjdXJyZW50JykpCiAgICAgICAgICAgIGRhdGFTb3J0SXRlbS5jbGFzc0xpc3QuYWRkKCdjdXJyZW50Jyk7CiAgICAgICAgICBkYXRhU29ydEl0ZW0uaW5zZXJ0QWRqYWNlbnRIVE1MKAogICAgICAgICAgICAnYmVmb3JlZW5kJywKICAgICAgICAgICAgYDxlbT4ke1BMRVguY3VycmVudF9zb3J0X29yZGVyfTwvZW0+YAogICAgICAgICAgKTsKICAgICAgICB9KTsKICAgIH0KCiAgICBQTEVYLmN1cnJlbnRfc2VjdGlvbiA9IFBMRVguc2VjdGlvbnNbc2VjdGlvbklEXTsKICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gUExFWC5jdXJyZW50X3NlY3Rpb24ua2V5OwogICBQTEVYLl9zZWN0aW9uc19saXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpJykuZm9yRWFjaChzZWN0aW9uc0xpc3RMaSA9PiB7CiAgICAgIGlmIChzZWN0aW9uc0xpc3RMaS5jbGFzc0xpc3QuY29udGFpbnMoJ2N1cnJlbnQnKSkKICAgICAgICBzZWN0aW9uc0xpc3RMaS5jbGFzc0xpc3QucmVtb3ZlKCdjdXJyZW50Jyk7CiAgICB9KTsKICAgIGRvY3VtZW50CiAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKGBsaVtkYXRhLXNlY3Rpb249IiR7c2VjdGlvbklEfSJdYCkKICAgICAgLmZvckVhY2goZGF0YVNlY3Rpb25JdGVtID0+IHsKICAgICAgICBpZiAoIWRhdGFTZWN0aW9uSXRlbS5jbGFzc0xpc3QuY29udGFpbnMoJ2N1cnJlbnQnKSkKICAgICAgICAgIGRhdGFTZWN0aW9uSXRlbS5jbGFzc0xpc3QuYWRkKCdjdXJyZW50Jyk7CiAgICAgIH0pOwogICAgLy9QTEVYLl9zZWN0aW9uX3RpdGxlLmlubmVyVGV4dCA9IFBMRVguY3VycmVudF9zZWN0aW9uLnRpdGxlOwogICAgLy8gT3V0cHV0IHRoZSBpdGVtcwogICAgUExFWC5kaXNwbGF5X2l0ZW1zKCk7CgogICAgLy8gTGlzdGVuIGZvciBjbGljayBvbiBpdGVtCiAgICBQTEVYLl9pdGVtX2xpc3QucXVlcnlTZWxlY3RvckFsbCgnbGknKS5mb3JFYWNoKGl0ZW1MaXN0SXRlbSA9PgogICAgICBpdGVtTGlzdEl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgLy8gRGlzcGxheSB0aGUgc2VsZWN0ZWQgaXRlbQogICAgICAgIFBMRVguZGlzcGxheV9pdGVtKGl0ZW1MaXN0SXRlbS5kYXRhc2V0Lml0ZW0pOwogICAgICB9KQogICAgKTsKCiAgICAvLyBPdXRwdXQgdGhlIGdlbnJlIGxpc3QKICAgIFBMRVguZGlzcGxheV9nZW5yZV9saXN0KFBMRVguY3VycmVudF9zZWN0aW9uLmdlbnJlcyk7CgogICAgLy8gTGlzdGVuIGZvciBjbGljayBvbiBnZW5yZSBsaXN0IGl0ZW1zCiAgICBQTEVYLl9nZW5yZV9saXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpJykuZm9yRWFjaChnZW5yZUxpc3RJdGVtID0+CiAgICAgIGdlbnJlTGlzdEl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgLy8gQ2hhbmdlIHRoZSBzZWxlY3RlZCBnZW5yZQogICAgICAgIFBMRVguY2hhbmdlX2dlbnJlKGdlbnJlTGlzdEl0ZW0uZGF0YXNldC5nZW5yZSk7CiAgICAgIH0pCiAgICApOwoKICAgIC8vIExpc3RlbiBmb3IgY2xpY2sgb24gc2hvdyBhbGwgZ2VucmVzCiAgICBQTEVYLl9nZW5yZV9saXN0CiAgICAgIC5xdWVyeVNlbGVjdG9yKCcjZ2VucmVfc2hvd19hbGwnKQogICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgLy8gU2V0IHNob3cgYWxsIGdlbnJlcyBhcyB0cnVlCiAgICAgICAgUExFWC5zaG93X2FsbF9nZW5yZXMgPSB0cnVlOwoKICAgICAgICAvLyBTaG93IHRoZSBoaWRkZW4gZ2VucmVzCiAgICAgICAgUExFWC5fZ2VucmVfbGlzdAogICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoJy5nZW5yZV9oaWRkZW4nKQogICAgICAgICAgLmZvckVhY2goZ2VucmVIaWRkZW5FbG0gPT4gewogICAgICAgICAgICBnZW5yZUhpZGRlbkVsbS5zdHlsZS5kaXNwbGF5ID0gJ2dyaWQnOwogICAgICAgICAgfSk7CgogICAgICAgIC8vIEhpZGUgdGhlIGdlbnJlcyAiaGlkZSBhbGwiIGJ1dHRvbgogICAgICAgIFBMRVguX2dlbnJlX2xpc3QucXVlcnlTZWxlY3RvcignI2dlbnJlX3Nob3dfYWxsJykuc3R5bGUuZGlzcGxheSA9CiAgICAgICAgICAnbm9uZSc7CgogICAgICAgIC8vIFNob3cgdGhlIGdlbnJlcyAic2hvdyBhbGwiIGJ1dHRvbgogICAgICAgIFBMRVguX2dlbnJlX2xpc3QucXVlcnlTZWxlY3RvcignI2dlbnJlX2hpZGVfYWxsJykuc3R5bGUuZGlzcGxheSA9CiAgICAgICAgICAnZ3JpZCc7CiAgICAgIH0pOwoKICAgIC8vIExpc3RlbiBmb3IgY2xpY2sgb24gaGlkZSBhbGwgZ2VucmVzCiAgICBQTEVYLl9nZW5yZV9saXN0CiAgICAgIC5xdWVyeVNlbGVjdG9yKCcjZ2VucmVfaGlkZV9hbGwnKQogICAgICAuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgLy8gU2V0IHNob3cgYWxsIGdlbnJlcyBhcyBmYWxzZQogICAgICAgIFBMRVguc2hvd19hbGxfZ2VucmVzID0gZmFsc2U7CgogICAgICAgIC8vIEhpZGUgdGhlIGhpZGRlbiBnZW5yZXMKICAgICAgICBQTEVYLl9nZW5yZV9saXN0CiAgICAgICAgICAucXVlcnlTZWxlY3RvckFsbCgnLmdlbnJlX2hpZGRlbicpCiAgICAgICAgICAuZm9yRWFjaChnZW5yZUhpZGRlbkVsbSA9PiB7CiAgICAgICAgICAgIGdlbnJlSGlkZGVuRWxtLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICB9KTsKCiAgICAgICAgLy8gU2hvdyB0aGUgZ2VucmVzICJoaWRlIGFsbCIgYnV0dG9uCiAgICAgICAgUExFWC5fZ2VucmVfbGlzdC5xdWVyeVNlbGVjdG9yKCcjZ2VucmVfc2hvd19hbGwnKS5zdHlsZS5kaXNwbGF5ID0KICAgICAgICAgICdncmlkJzsKCiAgICAgICAgLy8gSGlkZSB0aGUgZ2VucmVzICJzaG93IGFsbCIgYnV0dG9uCiAgICAgICAgUExFWC5fZ2VucmVfbGlzdC5xdWVyeVNlbGVjdG9yKCcjZ2VucmVfaGlkZV9hbGwnKS5zdHlsZS5kaXNwbGF5ID0KICAgICAgICAgICdub25lJzsKICAgICAgfSk7CgogICAgCiAgICAgICAgIAogIAogIAogICBjb25zdCBpdGVtc1RvU2hvd0RpcmVjdG9yc0ZvciA9IFBMRVguZmlsdGVyX2l0ZW1zX2J5X2dlbnJlKAogICAgICBQTEVYLmN1cnJlbnRfc2VjdGlvbi5pdGVtcywKICAgICAgUExFWC5jdXJyZW50X2dlbnJlCiAgICApOwogICAgY29uc3QgZGlyZWN0b3JzID0gW107CiAgICBsZXQgaXRlbUNvdW50ID0gMDsKCiAgICAvLyBTb3J0IHRocm91Z2ggbGlzdCBvZiBkaXJlY3RvcnMKICAgIE9iamVjdC5rZXlzKGl0ZW1zVG9TaG93RGlyZWN0b3JzRm9yKS5mb3JFYWNoKGtleSA9PiB7CiAgICAgIC8vIFNldCBpdGVtCiAgICAgIGNvbnN0IGl0ZW0gPSBpdGVtc1RvU2hvd0RpcmVjdG9yc0ZvcltrZXldOwoKICAgICAgLy8gQ2hlY2sgaWYgZGlyZWN0b3IgaXMgc2V0CiAgICAgIGlmICghaXRlbS5kaXJlY3RvcikgcmV0dXJuOwoKICAgICAgLy8gSW5jcmVtZW50IGl0ZW0gY291bnQKICAgICAgaXRlbUNvdW50ICs9IDE7CgogICAgICAvLyBBZGQgZGlyZWN0b3IgdG8gdGhlIGFycmF5CiAgICAgIGl0ZW0uZGlyZWN0b3IuZm9yRWFjaChuYW1lID0+IHsKICAgICAgICBpZiAobmFtZSkgewogICAgICAgICAgbGV0IGRpcmVjdG9yID0gZGlyZWN0b3JzW25hbWVdOwogICAgICAgICAgaWYgKCFkaXJlY3RvcikgewogICAgICAgICAgICBkaXJlY3RvciA9IHsgZGlyZWN0b3I6IG5hbWUsIGNvdW50OiAwIH07CiAgICAgICAgICAgIGRpcmVjdG9ycy5wdXNoKGRpcmVjdG9yKTsKICAgICAgICAgICAgZGlyZWN0b3JzW25hbWVdID0gZGlyZWN0b3I7CiAgICAgICAgICB9CiAgICAgICAgICBkaXJlY3Rvci5jb3VudCArPSAxOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9KTsKCiAgICAvLyBTb3J0IHRoZSBkaXJlY3RvcnMKICAgIGRpcmVjdG9ycy5zb3J0KGZ1bmN0aW9uKGEsIGIpIHsKICAgICAgaWYgKGEuY291bnQgPiBiLmNvdW50KSByZXR1cm4gLTE7CgogICAgICBpZiAoYS5jb3VudCA8IGIuY291bnQpIHJldHVybiAxOwoKICAgICAgaWYgKGEuZGlyZWN0b3IgPiBiLmRpcmVjdG9yKSByZXR1cm4gLTE7CgogICAgICBpZiAoYS5kaXJlY3RvciA8IGIuZGlyZWN0b3IpIHJldHVybiAxOwoKICAgICAgcmV0dXJuIDA7CiAgICB9KTsKCiAgICAvLyBPdXRwdXQgdGhlIGxpc3Qgb2YgZGlyZWN0b3JzCiAgICBQTEVYLmRpc3BsYXlfZGlyZWN0b3JfbGlzdChpdGVtQ291bnQsIGRpcmVjdG9ycyk7CgogICAgLy8gTGlzdGVuIGZvciBjbGljayBvbiBkaXJlY3RvciBsaXN0IGl0ZW1zCiAgICBQTEVYLl9kaXJlY3Rvcl9saXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpJykuZm9yRWFjaChkaXJlY3Rvckxpc3RJdGVtID0+CiAgICAgIGRpcmVjdG9yTGlzdEl0ZW0uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgLy8gQ2hhbmdlIHRoZSBzZWxlY3RlZCBkaXJlY3RvcgogICAgICAgIFBMRVguY2hhbmdlX2RpcmVjdG9yKGRpcmVjdG9yTGlzdEl0ZW0uZGF0YXNldC5kaXJlY3Rvcik7CiAgICAgIH0pCiAgICApOwoKICAgIC8vIExpc3RlbiBmb3IgY2xpY2sgb24gc2hvdyBhbGwgZGlyZWN0b3JzCiAgICBjb25zdCBkaXJlY3RvclNob3dBbGxCdG4gPSBQTEVYLl9kaXJlY3Rvcl9saXN0LnF1ZXJ5U2VsZWN0b3IoCiAgICAgICcjZGlyZWN0b3Jfc2hvd19hbGwnCiAgICApOwogICAgaWYgKGRpcmVjdG9yU2hvd0FsbEJ0bikgewogICAgICBkaXJlY3RvclNob3dBbGxCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgLy8gU2V0IHNob3cgYWxsIGRpcmVjdG9ycyBhcyB0cnVlCiAgICAgICAgUExFWC5zaG93X2FsbF9kaXJlY3RvcnMgPSB0cnVlOwoKICAgICAgICAvLyBTaG93IHRoZSBoaWRkZW4gZGlyZWN0b3JzCiAgICAgICAgUExFWC5fZGlyZWN0b3JfbGlzdAogICAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoJy5kaXJlY3Rvcl9oaWRkZW4nKQogICAgICAgICAgLmZvckVhY2goZGlyZWN0b3JIaWRkZW5FbG0gPT4gewogICAgICAgICAgICBkaXJlY3RvckhpZGRlbkVsbS5zdHlsZS5kaXNwbGF5ID0gJ2dyaWQnOwogICAgICAgICAgfSk7CgogICAgICAgIC8vIEhpZGUgdGhlIGRpcmVjdG9ycyAiaGlkZSBhbGwiIGJ1dHRvbgogICAgICAgIFBMRVguX2RpcmVjdG9yX2xpc3QucXVlcnlTZWxlY3RvcignI2RpcmVjdG9yX3Nob3dfYWxsJykuc3R5bGUuZGlzcGxheSA9CiAgICAgICAgICAnbm9uZSc7CgogICAgICAgIC8vIFNob3cgdGhlIGRpcmVjdG9ycyAic2hvdyBhbGwiIGJ1dHRvbgogICAgICAgIFBMRVguX2RpcmVjdG9yX2xpc3QucXVlcnlTZWxlY3RvcignI2RpcmVjdG9yX2hpZGVfYWxsJykuc3R5bGUuZGlzcGxheSA9CiAgICAgICAgICAnZ3JpZCc7CiAgICAgIH0pOwogICAgfQoKICAgIC8vIExpc3RlbiBmb3IgY2xpY2sgb24gaGlkZSBhbGwgZGlyZWN0b3JzCiAgICBjb25zdCBkaXJlY3RvckhpZGVBbGxCdG4gPSBQTEVYLl9kaXJlY3Rvcl9saXN0LnF1ZXJ5U2VsZWN0b3IoCiAgICAgICcjZGlyZWN0b3JfaGlkZV9hbGwnCiAgICApOwogICAgaWYgKGRpcmVjdG9ySGlkZUFsbEJ0bikgewogICAgICBkaXJlY3RvckhpZGVBbGxCdG4uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgICAgLy8gU2V0IHNob3cgYWxsIGRpcmVjdG9ycyBhcyBmYWxzZQogICAgICAgIFBMRVguc2hvd19hbGxfZ2VucmVzID0gZmFsc2U7CgogICAgICAgIC8vIEhpZGUgdGhlIGhpZGRlbiBkaXJlY3RvcnMKICAgICAgICBQTEVYLl9kaXJlY3Rvcl9saXN0CiAgICAgICAgICAucXVlcnlTZWxlY3RvckFsbCgnLmRpcmVjdG9yX2hpZGRlbicpCiAgICAgICAgICAuZm9yRWFjaChkaXJlY3RvckhpZGRlbkVsbSA9PiB7CiAgICAgICAgICAgIGRpcmVjdG9ySGlkZGVuRWxtLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgICB9KTsKCiAgICAgICAgLy8gU2hvdyB0aGUgZGlyZWN0b3JzICJoaWRlIGFsbCIgYnV0dG9uCiAgICAgICAgUExFWC5fZGlyZWN0b3JfbGlzdC5xdWVyeVNlbGVjdG9yKCcjZGlyZWN0b3Jfc2hvd19hbGwnKS5zdHlsZS5kaXNwbGF5ID0KICAgICAgICAgICdncmlkJzsKCiAgICAgICAgLy8gSGlkZSB0aGUgZGlyZWN0b3JzICJzaG93IGFsbCIgYnV0dG9uCiAgICAgICAgUExFWC5fZGlyZWN0b3JfbGlzdC5xdWVyeVNlbGVjdG9yKCcjZGlyZWN0b3JfaGlkZV9hbGwnKS5zdHlsZS5kaXNwbGF5ID0KICAgICAgICAgICdub25lJzsKICAgICAgfSk7CiAgICB9CgogICAgLy8gT3V0cHV0IHRoZSBsaXN0IG9mIHNlZW4gaXRlbXMKICAgIC8vUExFWC5kaXNwbGF5X3NlZW5fbGlzdCgnYWxsJyk7CgogICAgLy8gTGlzdGVuIGZvciBjbGljayBvbiBzZWVuIGxpc3QgaXRlbXMKICAgLyogUExFWC5fc2Vlbl9saXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpJykuZm9yRWFjaChzZWVuTGlzdEl0ZW0gPT4KICAgICAgc2Vlbkxpc3RJdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIC8vIENoYW5nZSB0aGUgc2VsZWN0ZWQgc2VlbiBzdGF0dXMKICAgICAgICBQTEVYLmNoYW5nZV9zZWVuKHNlZW5MaXN0SXRlbS5kYXRhc2V0LnNlZW4pOwogICAgICB9KQogICAgKTsqLwogIH0sIC8vIGVuZCBmdW5jOiBkaXNwbGF5X3NlY3Rpb24KCiAgLyohCiAgICogRGlzcGxheSB0aGUgZ2VucmUgbGlzdCBpbiB0aGUgc2lkZWJhcgogICAqLwogIGRpc3BsYXlfZ2VucmVfbGlzdChnZW5yZXMpIHsKICAgIC8vIENoZWNrIGlmIHRoZXJlIGFyZSBhbnkgZ2VucmVzIHNldAogICAgaWYgKGdlbnJlcy5sZW5ndGggPT09IDApIHsKICAgICAgLy8gVGhlcmUgYXJlIG5vIGdlbnJlcy4gSGlkZSB0aGUgZ2VucmVzIGxpc3Qgc2VjdGlvbgogICAgICBQTEVYLl9nZW5yZV9saXN0X3NlY3Rpb24uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IG51bVRvU2hvd0JlZm9yZUhpZGluZyA9IDU7IC8vIFNldCBob3cgbWFueSBnZW5yZXMgdG8gc2hvdyBiZWZvcmUgaGlkaW5nIHRoZSByZXN0CiAgICBsZXQgY291bnQgPSAwOyAvLyBJbml0IGhvdyBtYW55IGdlbnJlcyB0aGVyZSBhcmUKICAgIGxldCBudW1IaWRkZW4gPSAwOyAvLyBJbml0IGhvdyBtYW55IHJvd3MgYXJlIGhpZGRlbgogICAgbGV0IGxpc3RIVE1MID0gYDxsaSBkYXRhLWdlbnJlPSJhbGwiPjxlbT4ke1BMRVguY3VycmVudF9zZWN0aW9uLm51bV9pdGVtc308L2VtPkFsbDwvbGk+YDsgLy8gSW5pdCB0aGUgbGlzdCBodG1sCgogICAgLy8gTG9vcCB0aHJvdWdoIGVhY2ggZ2VucmUKICAgIGdlbnJlcy5mb3JFYWNoKGdlbnJlID0+IHsKICAgICAgY291bnQgKz0gMTsgLy8gSW5jcmVtZW50IHRoZSB0b3RhbCBnZW5yZSBjb3VudAogICAgICAvLyBDaGVjayBpZiBuZWVkaW5nIHRvIGhpZGUgdGhlIGdlbnJlCiAgICAgIGlmIChjb3VudCA8PSBudW1Ub1Nob3dCZWZvcmVIaWRpbmcpIHsKICAgICAgICAvLyBBZGQgZ2VucmUgdG8gdGhlIGxpc3QgaHRtbAogICAgICAgIGxpc3RIVE1MICs9IGA8bGkgZGF0YS1nZW5yZT0iJHtnZW5yZS5nZW5yZX0iIGNsYXNzPSJnZW5yZV9zaG93biI+PGVtPiR7Z2VucmUuY291bnR9PC9lbT4ke2dlbnJlLmdlbnJlfTwvbGk+YDsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBIaWRlIHRoZSBnZW5yZQogICAgICAgIG51bUhpZGRlbiArPSAxOyAvLyBJbmNyZW1lbnQgaGlkZGVuIGdlbnJlcyBjb3VudAogICAgICAgIC8vIEFkZCBnZW5yZSB0byB0aGUgbGlzdCBodG1sCiAgICAgICAgbGlzdEhUTUwgKz0gYDxsaSBkYXRhLWdlbnJlPSIke2dlbnJlLmdlbnJlfSIgY2xhc3M9ImdlbnJlX2hpZGRlbiI+PGVtPiR7Z2VucmUuY291bnR9PC9lbT4ke2dlbnJlLmdlbnJlfTwvbGk+YDsKICAgICAgfQogICAgfSk7CgogICAgLy8gQ2hlY2sgaWYgdGhlcmUgYXJlIGFueSBoaWRkZW4gZ2VucmVzCiAgICBpZiAobnVtSGlkZGVuID4gMCkgewogICAgICAvLyBPdXRwdXQgc2hvdyBhbmQgaGlkZSBlbGVtZW50cwogICAgICBsaXN0SFRNTCArPSBgPGxpIGlkPSJnZW5yZV9zaG93X2FsbCI+U2hvdyAke251bUhpZGRlbn0gbW9yZS4uLjwvbGk+YDsKICAgICAgbGlzdEhUTUwgKz0gYDxsaSBpZD0iZ2VucmVfaGlkZV9hbGwiPlNob3cgZmV3ZXIuLi48L2xpPmA7CiAgICB9CgogICAgLy8gVXBkYXRlIHRoZSBnZW5yZSBsaXN0IGlubmVyIEhUTUwKICAgIFBMRVguX2dlbnJlX2xpc3QuaW5uZXJIVE1MID0gbGlzdEhUTUw7CgogICAgLy8gQ2hlY2sgaWYgd2FudGluZyB0byBzaG93IGFsbCBnZW5yZXMKICAgIGlmIChQTEVYLnNob3dfYWxsX2dlbnJlcykgewogICAgICAvLyBIaWRlIHRoZSBzaG93IGFsbCBlbGVtZW50CiAgICAgIGNvbnN0IGdlbnJlU2hvd0FsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNnZW5yZV9zaG93X2FsbCcpOwogICAgICBpZiAoZ2VucmVTaG93QWxsKSB7CiAgICAgICAgZ2VucmVTaG93QWxsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgIH0KICAgICAgLy8gU2hvdyBhbGwgaGlkZGVuIGdlbnJlcwogICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcuZ2VucmVfaGlkZGVuJykuZm9yRWFjaChnZW5yZUhpZGRlbkVsbSA9PiB7CiAgICAgICAgZ2VucmVIaWRkZW5FbG0uc3R5bGUuZGlzcGxheSA9ICdncmlkJzsKICAgICAgfSk7CiAgICB9IGVsc2UgewogICAgICAvLyBIaWRlIGhpZGRlbiBnZW5yZXMKICAgICAgLy8gSGlkZSB0aGUgaGlkZSBhbGwgZWxlbWVudAogICAgICBjb25zdCBnZW5yZUhpZGVBbGwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZ2VucmVfaGlkZV9hbGwnKTsKICAgICAgaWYgKGdlbnJlSGlkZUFsbCkgewogICAgICAgIGdlbnJlSGlkZUFsbC5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICB9CiAgICAgIC8vIEhpZGUgYWxsIGhpZGRlbiBnZW5yZXMKICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLmdlbnJlX2hpZGRlbicpLmZvckVhY2goZ2VucmVIaWRkZW5FbG0gPT4gewogICAgICAgIGdlbnJlSGlkZGVuRWxtLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgIH0pOwogICAgfQoKICAgIC8vIFJlbW92ZSBjdXJyZW50IGNsYXNzIGZyb20gY3VycmVudCBnZW5yZQogICAgUExFWC5fZ2VucmVfbGlzdC5xdWVyeVNlbGVjdG9yQWxsKCdsaS5jdXJyZW50JykuZm9yRWFjaChnZW5yZUxpc3RMaSA9PiB7CiAgICAgIGdlbnJlTGlzdExpLmNsYXNzTGlzdC5yZW1vdmUoJ2N1cnJlbnQnKTsKICAgIH0pOwoKICAgIC8vIEFkZCBjdXJyZW50IGNsYXNzIHRvIG5ldyBjdXJyZW50IGdlbnJlCiAgICBkb2N1bWVudAogICAgICAucXVlcnlTZWxlY3RvckFsbChgbGlbZGF0YS1nZW5yZT0iJHtQTEVYLmN1cnJlbnRfZ2VucmV9Il1gKQogICAgICAuZm9yRWFjaChkYXRhR2VucmVMaSA9PiB7CiAgICAgICAgaWYgKCFkYXRhR2VucmVMaS5jbGFzc0xpc3QuY29udGFpbnMoJ2N1cnJlbnQnKSkKICAgICAgICAgIGRhdGFHZW5yZUxpLmNsYXNzTGlzdC5hZGQoJ2N1cnJlbnQnKTsKICAgICAgfSk7CgogICAgLy8gU2hvdyB0aGUgZ2VucmUgbGlzdCBzZWN0aW9uCiAgICBQTEVYLl9nZW5yZV9saXN0X3NlY3Rpb24uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgfSwgLy8gZW5kIGZ1bmM6IGRpc3BsYXlfZ2VucmVfbGlzdAoKICAvKiEKICAgKiBEaXNwbGF5IHRoZSBkaXJlY3RvciBsaXN0IGluIHRoZSBzaWRlYmFyIGZvciBtb3ZpZXMKICAgKi8KICBkaXNwbGF5X2RpcmVjdG9yX2xpc3QodG90YWxDb3VudCwgZGlyZWN0b3JzKSB7CiAgICAvLyBDaGVjayBpZiB0aGVyZSBhcmUgYW55IGRpcmVjdG9ycyBzZXQKICAgIGlmIChkaXJlY3RvcnMubGVuZ3RoID09PSAwKSB7CiAgICAgIC8vIFRoZXJlIGFyZSBubyBkaXJlY3RvcnMuIEhpZGUgdGhlIGRpcmVjdG9yIGxpc3Qgc2VjdGlvbgogICAgICBQTEVYLl9kaXJlY3Rvcl9saXN0X3NlY3Rpb24uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IG51bVRvU2hvd0JlZm9yZUhpZGluZyA9IDU7IC8vIFNldCBob3cgbWFueSBkaXJlY3RvcnMgdG8gc2hvdyBiZWZvcmUgaGlkaW5nIHRoZSByZXN0CiAgICBsZXQgY291bnQgPSAwOyAvLyBJbml0IGhvdyBtYW55IGRpcmVjdG9ycyB0aGVyZSBhcmUKICAgIGxldCBudW1IaWRkZW4gPSAwOyAvLyBJbml0IGhvdyBtYW55IHJvd3MgYXJlIGhpZGRlbgogICAgbGV0IGxpc3RIdG1sID0gYDxsaSBkYXRhLWRpcmVjdG9yPSJhbGwiPjxlbT4ke3RvdGFsQ291bnR9PC9lbT5BbGw8L2xpPmA7IC8vIEluaXQgdGhlIGxpc3QgaHRtbAoKICAgIC8vIExvb3AgdGhyb3VnaCBlYWNoIGRpcmVjdG9yCiAgICBkaXJlY3RvcnMuZm9yRWFjaChkaXJlY3RvciA9PiB7CiAgICAgIGNvdW50ICs9IDE7IC8vIEluY3JlbWVudCB0aGUgdG90YWwgZGlyZWN0b3IgY291bnQKICAgICAgLy8gQ2hlY2sgaWYgbmVlZGluZyB0byBoaWRlIHRoZSBkaXJlY3RvcgogICAgICBpZiAoY291bnQgPD0gbnVtVG9TaG93QmVmb3JlSGlkaW5nKSB7CiAgICAgICAgLy8gQWRkIGRpcmVjdG9yIHRvIHRoZSBsaXN0IGh0bWwKICAgICAgICBsaXN0SHRtbCArPSBgPGxpIGRhdGEtZGlyZWN0b3I9IiR7ZGlyZWN0b3IuZGlyZWN0b3J9IiBjbGFzcz0iZGlyZWN0b3Jfc2hvd24iPjxlbT4ke2RpcmVjdG9yLmNvdW50fTwvZW0+JHtkaXJlY3Rvci5kaXJlY3Rvcn08L2xpPmA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gSGlkZSB0aGUgZGlyZWN0b3IKICAgICAgICBudW1IaWRkZW4gKz0gMTsgLy8gSW5jcmVtZW50IGhpZGRlbiBkaXJlY3RvciBjb3VudAogICAgICAgIC8vIEFkZCBkaXJlY3RvciB0byB0aGUgbGlzdCBodG1sCiAgICAgICAgbGlzdEh0bWwgKz0gYDxsaSBkYXRhLWRpcmVjdG9yPSIke2RpcmVjdG9yLmRpcmVjdG9yfSIgY2xhc3M9ImRpcmVjdG9yX2hpZGRlbiI+PGVtPiR7ZGlyZWN0b3IuY291bnR9PC9lbT4ke2RpcmVjdG9yLmRpcmVjdG9yfTwvbGk+YDsKICAgICAgfQogICAgfSk7CgogICAgLy8gQ2hlY2sgaWYgdGhlcmUgYXJlIGFueSBoaWRkZW4gZ2VucmVzCiAgICBpZiAobnVtSGlkZGVuID4gMCkgewogICAgICAvLyBPdXRwdXQgc2hvdyBhbmQgaGlkZSBlbGVtZW50cwogICAgICBsaXN0SHRtbCArPSBgPGxpIGlkPSJkaXJlY3Rvcl9zaG93X2FsbCI+U2hvdyAke251bUhpZGRlbn0gbW9yZS4uLjwvbGk+YDsKICAgICAgbGlzdEh0bWwgKz0gYDxsaSBpZD0iZGlyZWN0b3JfaGlkZV9hbGwiPlNob3cgZmV3ZXIuLi48L2xpPmA7CiAgICB9CgogICAgLy8gVXBkYXRlIHRoZSBkaXJlY3RvciBsaXN0IGlubmVyIEhUTUwKICAgIFBMRVguX2RpcmVjdG9yX2xpc3QuaW5uZXJIVE1MID0gbGlzdEh0bWw7CgogICAgLy8gQ2hlY2sgaWYgd2FudGluZyB0byBzaG93IGFsbCBkaXJlY3RvcnMKICAgIGlmIChQTEVYLnNob3dfYWxsX2RpcmVjdG9ycykgewogICAgICAvLyBIaWRlIHRoZSBzaG93IGFsbCBlbGVtZW50CiAgICAgIGNvbnN0IGRpcmVjdG9yU2hvd0FsbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNkaXJlY3Rvcl9zaG93X2FsbCcpOwogICAgICBpZiAoZGlyZWN0b3JTaG93QWxsKSB7CiAgICAgICAgZGlyZWN0b3JTaG93QWxsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgIH0KICAgICAgLy8gU2hvdyBhbGwgaGlkZGVuIGRpcmVjdG9ycwogICAgICBkb2N1bWVudAogICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKCcuZGlyZWN0b3JfaGlkZGVuJykKICAgICAgICAuZm9yRWFjaChkaXJlY3RvckhpZGRlbkVsbSA9PiB7CiAgICAgICAgICBkaXJlY3RvckhpZGRlbkVsbS5zdHlsZS5kaXNwbGF5ID0gJ2dyaWQnOwogICAgICAgIH0pOwogICAgfSBlbHNlIHsKICAgICAgLy8gSGlkZSBoaWRkZW4gZGlyZWN0b3JzCiAgICAgIC8vIEhpZGUgdGhlIGhpZGUgYWxsIGVsZW1lbnQKICAgICAgY29uc3QgZGlyZWN0b3JIaWRlQWxsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2RpcmVjdG9yX2hpZGVfYWxsJyk7CiAgICAgIGlmIChkaXJlY3RvckhpZGVBbGwpIHsKICAgICAgICBkaXJlY3RvckhpZGVBbGwuc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgfQogICAgICAvLyBIaWRlIGFsbCBoaWRkZW4gZGlyZWN0b3JzCiAgICAgIGRvY3VtZW50CiAgICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoJy5kaXJlY3Rvcl9oaWRkZW4nKQogICAgICAgIC5mb3JFYWNoKGRpcmVjdG9ySGlkZGVuRWxtID0+IHsKICAgICAgICAgIGRpcmVjdG9ySGlkZGVuRWxtLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgfSk7CiAgICB9CgogICAgLy8gUmVtb3ZlIGN1cnJlbnQgY2xhc3MgZnJvbSBjdXJyZW50IGRpcmVjdG9yCiAgICBQTEVYLl9kaXJlY3Rvcl9saXN0CiAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKCdsaS5jdXJyZW50JykKICAgICAgLmZvckVhY2goZGlyZWN0b3JMaXN0TGkgPT4gewogICAgICAgIGRpcmVjdG9yTGlzdExpLmNsYXNzTGlzdC5yZW1vdmUoJ2N1cnJlbnQnKTsKICAgICAgfSk7CgogICAgLy8gQWRkIGN1cnJlbnQgY2xhc3MgdG8gbmV3IGN1cnJlbnQgZGlyZWN0b3IKICAgIGRvY3VtZW50CiAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKGBsaVtkYXRhLWRpcmVjdG9yPSIke1BMRVguY3VycmVudF9kaXJlY3Rvcn0iXWApCiAgICAgIC5mb3JFYWNoKGRhdGFEaXJlY3RvckxpID0+IHsKICAgICAgICBpZiAoIWRhdGFEaXJlY3RvckxpLmNsYXNzTGlzdC5jb250YWlucygnY3VycmVudCcpKQogICAgICAgICAgZGF0YURpcmVjdG9yTGkuY2xhc3NMaXN0LmFkZCgnY3VycmVudCcpOwogICAgICB9KTsKCiAgICAvLyBTaG93IHRoZSBkaXJlY3RvciBsaXN0IHNlY3Rpb24KICAgIFBMRVguX2RpcmVjdG9yX2xpc3Rfc2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICB9LCAvLyBlbmQgZnVuYzogZGlzcGxheV9kaXJlY3Rvcl9saXN0CgogIC8qIQogICAqIERpc3BsYXkgdGhlIHNlZW4gbGlzdCBpbiB0aGUgc2lkZWJhciBmb3IgbW92aWVzCiAgICovCiAgZGlzcGxheV9zZWVuX2xpc3QoKSB7CiAgICAvLyBDaGVjayB0aGUgY3VycmVudCBzZWN0aW9uIHR5cGUgaXNuJ3QgYSBtb3ZpZQogICAgaWYgKFBMRVguY3VycmVudF9zZWN0aW9uLnR5cGUgIT09ICdtb3ZpZScpIHsKICAgICAgLy8gSGlkZSB0aGUgc2VlbiBsaXN0IHNlY3Rpb24KICAgICAgUExFWC5fc2Vlbl9saXN0X3NlY3Rpb24uc3R5bGUuZGlzcGxheSA9ICdub25lJzsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIC8vIEluaXQgdGhlIGxpc3QgaHRtbAogICAgbGV0IGxpc3RIVE1MID0gYDxsaSBkYXRhLXNlZW49ImFsbCI+PGVtPiR7UExFWC5jdXJyZW50X3NlY3Rpb24ubnVtX2l0ZW1zfTwvZW0+QWxsPC9saT5gOwoKICAgIC8vIEluaXQgdGhlIHNlZW4gY291bnQKICAgIGxldCBzZWVuQ291bnQgPSAwOwoKICAgIC8vIExvb3AgdGhyb3VnaCBzZWVuIGl0ZW1zCiAgICBPYmplY3Qua2V5cygKICAgICAgUExFWC5maWx0ZXJfaXRlbXNfYnlfc2VlbihQTEVYLmN1cnJlbnRfc2VjdGlvbi5pdGVtcywgJ3RydWUnKQogICAgKS5mb3JFYWNoKCgpID0+IHsKICAgICAgc2VlbkNvdW50ICs9IDE7CiAgICB9KTsKCiAgICAvLyBBZGQgc2VlbiBpdGVtcyB0byB0aGUgbGlzdCBodG1sCiAgICBsaXN0SFRNTCArPSBgPGxpIGRhdGEtc2Vlbj0idHJ1ZSI+PGVtPiR7c2VlbkNvdW50fTwvZW0+U2VlbjwvbGk+YDsKCiAgICAvLyBJbml0IHRoZSB1bnNlZW4gY291bnQKICAgIGxldCB1bnNlZW5Db3VudCA9IDA7CgogICAgLy8gTG9vcCB0aHJvdWdoIHVuc2VlbiBpdGVtcwogICAgT2JqZWN0LmtleXMoCiAgICAgIFBMRVguZmlsdGVyX2l0ZW1zX2J5X3NlZW4oUExFWC5jdXJyZW50X3NlY3Rpb24uaXRlbXMsICdmYWxzZScpCiAgICApLmZvckVhY2goKCkgPT4gewogICAgICB1bnNlZW5Db3VudCArPSAxOwogICAgfSk7CgogICAgLy8gQWRkIHRoZSB1bnNlZW4gaXRlbXMgdG8gdGhlIGxpc3QgaHRtbAogICAgbGlzdEhUTUwgKz0gYDxsaSBkYXRhLXNlZW49ImZhbHNlIj48ZW0+JHt1bnNlZW5Db3VudH08L2VtPk5vdCBTZWVuPC9saT5gOwoKICAgIC8vIFNldCB0aGUgc2VlbiBsaXN0IGlubmVyIEhUTUwKICAgIFBMRVguX3NlZW5fbGlzdC5pbm5lckhUTUwgPSBsaXN0SFRNTDsKCiAgICAvLyBSZW1vdmUgdGhlIGN1cnJlbnQgY2xhc3MgZnJvbSB0aGUgc2VlbiBsaXN0CiAgICBQTEVYLl9zZWVuX2xpc3QucXVlcnlTZWxlY3RvckFsbCgnbGkuY3VycmVudCcpLmZvckVhY2goc2Vlbkxpc3RMaSA9PiB7CiAgICAgIHNlZW5MaXN0TGkuY2xhc3NMaXN0LnJlbW92ZSgnY3VycmVudCcpOwogICAgfSk7CgogICAgLy8gQWRkIGN1cnJlbnQgY2xhc3MgdG8gbmV3IGN1cnJlbnQgc2VlbgogICAgZG9jdW1lbnQKICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpW2RhdGEtc2Vlbj0iJHtQTEVYLmN1cnJlbnRfc2Vlbn0iXWApCiAgICAgIC5mb3JFYWNoKGRhdGFTZWVuTGkgPT4gewogICAgICAgIGlmICghZGF0YVNlZW5MaS5jbGFzc0xpc3QuY29udGFpbnMoJ2N1cnJlbnQnKSkKICAgICAgICAgIGRhdGFTZWVuTGkuY2xhc3NMaXN0LmFkZCgnY3VycmVudCcpOwogICAgICB9KTsKCiAgICAvLyBTaG93IHRoZSBzZWVuIGxpc3Qgc2VjdGlvbgogICAgUExFWC5fc2Vlbl9saXN0X3NlY3Rpb24uc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CiAgfSwgLy8gZW5kIGZ1bmM6IGRpc3BsYXlfc2Vlbl9saXN0CgogIC8vIFRPRE8gRmluZCBvdXQgd2hhdCB0cmlnZ2VyIHNjcm9sbCBpcyB1c2VkIGZvcgogIC8qIQogICAqIERpc3BsYXkgY3VycmVudCBzZWN0aW9uIGl0ZW1zCiAgICovCiAgZGlzcGxheV9pdGVtcygpIHsKICAgIC8vIEluaXQgaXRlbXMgYXMgY3VycmVudCBzZWN0aW9uCiAgICBsZXQgeyBpdGVtcyB9ID0gUExFWC5jdXJyZW50X3NlY3Rpb247CgogICAgLy8gQ2hlY2sgaWYgY3VycmVudCBzZWVuIGlzIG5vdCAiYWxsIgogICAgaWYgKFBMRVguY3VycmVudF9zZWVuICE9PSAnYWxsJykgewogICAgICAvLyBTZXQgaXRlbXMgZmlsdGVyZWQgYXMgY3VycmVudCBzZWVuCiAgICAgIGl0ZW1zID0gUExFWC5maWx0ZXJfaXRlbXNfYnlfc2VlbihpdGVtcywgUExFWC5jdXJyZW50X3NlZW4pOwogICAgfQoKICAgIC8vIENoZWNrIGlmIHRoZXJlIGlzIGEgZmlsdGVyIHZhbHVlIHNldAogICAgaWYgKFBMRVguX3NlY3Rpb25fZmlsdGVyLnZhbHVlICE9PSAnJykgewogICAgICAvLyBTZXQgaXRlbXMgZmlsdGVyZWQgYXMgZmlsdGVyIHZhbHVlIG1hdGNoCiAgICAgIGl0ZW1zID0gUExFWC5maWx0ZXJfaXRlbXNfYnlfdGVybShpdGVtcywgUExFWC5fc2VjdGlvbl9maWx0ZXIudmFsdWUpOwogICAgfQoKICAgIC8vIENoZWNrIHRoYXQgY3VycmVudCBnZW5yZSBpc24ndCAiYWxsIgogICAgaWYgKFBMRVguY3VycmVudF9nZW5yZSAhPT0gJ2FsbCcpIHsKICAgICAgLy8gU2V0IGl0ZW1zIGZpbHRlcmVkIGFzIGN1cnJlbnQgZ2VucmUKICAgICAgaXRlbXMgPSBQTEVYLmZpbHRlcl9pdGVtc19ieV9nZW5yZShpdGVtcywgUExFWC5jdXJyZW50X2dlbnJlKTsKICAgIH0KCiAgICAvLyBDaGVjayBjdXJyZW50IGRpcmVjdG9yIGlzbid0ICJhbGwiCiAgICBpZiAoUExFWC5jdXJyZW50X2RpcmVjdG9yICE9PSAnYWxsJykgewogICAgICAvLyBTZXQgaXRlbXMgZmlsdGVyZWQgYXMgY3VycmVudCBkaXJlY3RvcgogICAgICBpdGVtcyA9IFBMRVguZmlsdGVyX2l0ZW1zX2J5X2RpcmVjdG9yKGl0ZW1zLCBQTEVYLmN1cnJlbnRfZGlyZWN0b3IpOwogICAgfQoKICAgIC8vIFJlc2V0IHRoZSBpdGVtIGxpc3QgaW5uZXIgSFRNTAogICAgUExFWC5faXRlbV9saXN0LmlubmVySFRNTCA9ICcnOwoKICAgIGxldCBudW1JdGVtcyA9IDA7IC8vIEluaXQgdGhlIG51bWJlciBvZiBpdGVtcwogICAgbGV0IGlubmVySFRNTCA9ICcnOyAvLyBJbml0IHRoZSBpbm5lciBIVE1MCgl2YXIgc2Vjb25kcyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpOwogICAgCiAgICAvLyBMb29wIHRocm91Z2ggdGhlIGN1cnJlbnQgc2VjdGlvbiBzb3J0cwogICAgUExFWC5jdXJyZW50X3NlY3Rpb24uc29ydHNbCiAgICAgIGAke1BMRVguY3VycmVudF9zb3J0X2tleX1fJHtQTEVYLmN1cnJlbnRfc29ydF9vcmRlcn1gCiAgICBdLmZvckVhY2goa2V5ID0+IHsKICAgICAgLy8gSWYgdGhlIGl0ZW0gaXMgdW5kZWZpbmVkLCBza2lwCiAgICAgIGlmICh0eXBlb2YgaXRlbXNba2V5XSA9PT0gJ3VuZGVmaW5lZCcpIHJldHVybjsKICAgICAgY29uc3QgaXRlbSA9IGl0ZW1zW2tleV07IC8vIFNldCB0aGUgaXRlbQogICAgICBjb25zdCB0aHVtYiA9CiAgICAgICAgaXRlbS50aHVtYiA9PT0gZmFsc2UgPyAnYXNzZXRzL2ltYWdlcy9kZWZhdWx0LnBuZycgOiBpdGVtLnRodW1iOyAvLyBTZXQgdGhlIHRodW1iCgkgIAogICAgICB2YXIgc3RyMjIgPSAnJzsKCSAgdmFyIHJldHVybnRpbWUgPSAoKChzZWNvbmRzLzEwMDApIC0gKGl0ZW0uYWRkZWRBdCkpLzYwKTsKICAgICAgLy92YXIgcmV0dXJudGltZSA9IE1hdGgucm91bmQoKHNlY29uZHMvMTAwMCAtIGl0ZW0uYWRkZWRBdCkvNjApOwogICAgICBpZihyZXR1cm50aW1lIDwgNjApeyBzdHIyMiA9ICcgbGVzcyB0aGFuIDEgbWludXRlIGFnbyc7fSBpZig2MCA8IHJldHVybnRpbWUgPCAzNjAwKXsgc3RyMjIgPSBNYXRoLnJvdW5kKHJldHVybnRpbWUpICsgJyBtaW5zIGFnbyc7fSAgaWYoMzYwIDwgcmV0dXJudGltZSA8IDg2NDAwKXsgc3RyMjIgPSBNYXRoLnJvdW5kKHJldHVybnRpbWUvNjApICsgJyBob3VycyBhZ28nO30gaWYoODY0MDAgPCByZXR1cm50aW1lIDwgNjA0ODAwKXsgc3RyMjIgPSBNYXRoLnJvdW5kKHJldHVybnRpbWUvNjAvMjQpICsgJyBkYXlzIGFnbyc7fSAgaWYoNjA0ODAwIDwgcmV0dXJudGltZSA8IDYwNDgwMDAwMDAwMDAwKXsgc3RyMjIgPSBNYXRoLnJvdW5kKHJldHVybnRpbWUvNjAvMjQvNykgKyAnIHdlZWtzIGFnbyc7fSAgCiAgICAgICAgCiAgICAgIC8vIFNldCB0aGUgZGF0YSB0byB0aGUgaW5uZXJIVE1MCiAgICAgIC8vaW5uZXJIVE1MICs9IGA8bGkgZGF0YS1pdGVtPSIke2l0ZW0ua2V5fSIgY2xhc3M9Iml0ZW0iIHRpdGxlPSIke2l0ZW0udGl0bGV9Ij48aW1nIHNyYz0iJHt0aHVtYn0iIGxvYWRpbmc9ImxhenkiIC8+PGg0PiR7aXRlbS50aXRsZX08YnI+JHtpdGVtLnNlYXNvbmVwaXNvZGV9PGJyPkFkZGVkICR7TWF0aC5yb3VuZCgoc2Vjb25kcy8xMDAwIC0gaXRlbS5hZGRlZEF0KS82MCl9IG1pbnMgYWdvICR7c2Vjb25kc308YnI+JHtpdGVtLmFkZGVkQXQqMTAwMH08YnI+JHtzdHIyMn08L2g0PjwvbGk+YDsKCSAgaW5uZXJIVE1MICs9IGA8bGkgZGF0YS1pdGVtPSIke2l0ZW0ua2V5fSIgY2xhc3M9Iml0ZW0iIHRpdGxlPSIke2l0ZW0udGl0bGV9IiAgb25jbGljaz0ic2hvd01vdklEMigpOyBzaG93QnV5Tm93MigpOyBzaG93Qml0UmF0ZTIoKTsgc2hvd0ZpbGVOYW1lMigpOyBzaG93RmlsZVNpemUyKCk7IHNob3dWaWRlb1JlczIoKTsgc2hvd1ZpZGVvQ29kZWMyKCk7IHNob3dBdWRpb0NvZGVjMigpOyBzaG93QXVkaW9DaGFubmVsczIoKTsgc2hvd0FzcGVjdFJhdGlvMigpOyI+PGltZyBzcmM9Imh0dHBzOi8vaW1hZ2UudG1kYi5vcmcvdC9wL3cxODUke3RodW1ifSIgbG9hZGluZz0ibGF6eSIgLz48aDQ+JHtpdGVtLnRpdGxlfTxicj4oJHtpdGVtLnJlbGVhc2VfeWVhcn0pPC9oND48L2xpPmA7ICAvLzxicj5BZGRlZCAke3N0cjIyfTwvaDQ+PC9saT5gOwogICAgICBudW1JdGVtcyArPSAxOyAvLyBJbmNyZW1lbnQgdGhlIG51bWJlciBvZiBpdGVtcyAgICAgICAgICAgIAogICAgfSk7CiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3NlY3Rpb25fbnVtX2l0ZW1zJykuaW5uZXJIVE1MPWBUaXRsZXM6IGArbnVtSXRlbXM7CgogICAgLy8gVXBkYXRlIHRoZSBpdGVtIGxpc3QgaW5uZXIgSFRNTAogICAgUExFWC5faXRlbV9saXN0LmlubmVySFRNTCA9IGlubmVySFRNTDsKICAgLy8gQ2hlY2sgaWYgdGhlcmUgYXJlIG5vIGl0ZW1zCiAgICBpZiAobnVtSXRlbXMgPT09IDApIHsKICAgICAgUExFWC5fc2VjdGlvbl9tZXRhLmlubmVyVGV4dCA9ICdObyBpdGVtcyBpbiB0aGlzIGNvbGxlY3Rpb24nOyAvLyBVcGRhdGUgdGhlIHNlY3Rpb24gbWV0YSBpbm5lciB0ZXh0CiAgICAgIFBMRVguX2l0ZW1fbGlzdF9zdGF0dXMuaW5uZXJIVE1MID0KICAgICAgICAnPHA+VGhlcmUgYXJlIG5vIGl0ZW1zIHRvIGRpc3BsYXkgaW4gdGhpcyBjb2xsZWN0aW9uIHRoYXQgbWF0Y2hlcyB0aGUgZmlsdGVycyBzZXQuPC9wPic7IC8vIFVwZGF0ZSB0aGUgaXRlbSBsaXN0IHN0YXR1cyBpbm5lciBodG1sCiAgICAgIFBMRVguX2l0ZW1fbGlzdF9zdGF0dXMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7IC8vIFNob3cgdGhlIGl0ZW0gbGlzdCBzdGF0dXMgc2VjdGlvbgogICAgICAKICAgIH0gZWxzZSB7CiAgICAgIC8vIFRoZXJlIGFyZSBpdGVtcwogICAgICAvLyBIaWRlIHRoZSBpdGVtIGxpc3Qgc3RhdHVzCiAgICAgIFBMRVguX2NvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2dyaWQnOwogICAgICBQTEVYLl9zZWN0aW9uX2hlYWRlci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgICAgUExFWC5faXRlbV9saXN0X3N0YXR1cy5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgICAvLyBTZXQgdGhlIHNlY3Rpb24gbWV0YSBpbm5lciB0ZXh0CiAgICAgLyogUExFWC5fc2VjdGlvbl9tZXRhLmlubmVyVGV4dCA9IGAke251bWJlcl9mb3JtYXQobnVtSXRlbXMpfSAke2luZmxlY3QoCiAgICAgICAgbnVtSXRlbXMsCiAgICAgICAgJ2l0ZW0nCiAgICAgICl9IGluIHRoaXMgY29sbGVjdGlvbmA7Ki8KICAgIH0KCiAgICAvLyAkKGRvY3VtZW50KS50cmlnZ2VyKCJzY3JvbGwiKTsKICB9LCAvLyBlbmQgZnVuYzogZGlzcGxheV9pdGVtcwoKICAvKiEKICAgKiBGaWx0ZXIgaXRlbXMgYnkgc2VhcmNoIHRlcm0KICAgKi8KICBmaWx0ZXJfaXRlbXNfYnlfdGVybShhbGxJdGVtcywgdGVybUluKSB7CiAgICAvLyBJbml0IHRoZSB0ZXJtIGFzIGxvd2VyY2FzZSB2YWx1ZQogICAgY29uc3QgdGVybSA9IHRlcm1Jbi50b0xvd2VyQ2FzZSgpOwoKICAgIC8vIENoZWNrIGlmIHRoZSB0ZXJtIHZhbHVlIGlzIGJsYW5rIGFuZCByZXR1cm4gYWxsIGl0ZW1zIGlmIGl0IGlzCiAgICBpZiAodGVybSA9PT0gJycpIHJldHVybiBhbGxJdGVtczsKCiAgICAvLyBJbml0IGl0ZW1zIHRvIHNobwogICAgY29uc3QgaXRlbXNUb1Nob3cgPSB7fTsKCiAgICAvLyBMb29wIHRocm91Z2ggYWxsIGl0ZW1zCiAgICBPYmplY3Qua2V5cyhhbGxJdGVtcykuZm9yRWFjaChrZXkgPT4gewogICAgICAvLyBTZXQgdGhlIGN1cnJlbnQgaXRlbSB0aXRsZSBhcyBsb3dlcmNhc2UKICAgICAgY29uc3QgdGl0bGUgPSBhbGxJdGVtc1trZXldLnRpdGxlLnRvTG93ZXJDYXNlKCk7CiAgICAgIC8vIENoZWNrIGlmIHRoZSB0ZXJtIGlzIG1hdGNoZWQgaW4gdGhlIHRpdGxlIGFuZCBza2lwIGlmIG5vdAogICAgICBpZiAodGl0bGUuaW5kZXhPZih0ZXJtKSA9PT0gLTEpIHJldHVybjsKICAgICAgLy8gQWRkIGl0ZW0gdG8gaXRlbXMgdG8gc2hvdwogICAgICBpdGVtc1RvU2hvd1trZXldID0gYWxsSXRlbXNba2V5XTsKICAgIH0pOwoKICAgIC8vIFJldHVybiBpdGVtcyB0byBzaG93CiAgICByZXR1cm4gaXRlbXNUb1Nob3c7CiAgfSwgLy8gZW5kIGZ1bmM6IGZpbHRlcl9pdGVtc19ieV90ZXJtCgogIC8qIQogICAqIEZpbHRlciBpdGVtcyBieSBzZWxlY3RlZCBnZW5yZQogICAqLwogIGZpbHRlcl9pdGVtc19ieV9nZW5yZShhbGxJdGVtcywgZ2VucmUpIHsKICAgIC8vIENoZWNrIGlmIHRoZSBnZW5yZSBpcyAiYWxsIiBhbmQgcmV0dXJuIGFsbCBpdGVtcyBpZiBpdCBpcwogICAgaWYgKGdlbnJlID09PSAnYWxsJykgcmV0dXJuIGFsbEl0ZW1zOwoKICAgIC8vIEluaXQgaXRlbXMgdG8gc2hvdwogICAgY29uc3QgaXRlbXNUb1Nob3cgPSB7fTsKCiAgICAvLyBMb29wIHRocm91Z2ggYWxsIGl0ZW1zCiAgICBPYmplY3Qua2V5cyhhbGxJdGVtcykuZm9yRWFjaChrZXkgPT4gewogICAgICAvLyBDaGVjayBpZiB0aGUgZ2VucmUgaXMgaW4gdGhlIGFycmF5IGFuZCBza2lwIGlmIG5vdAogICAgICBpZiAoIWFsbEl0ZW1zW2tleV0uZ2VucmUgfHwgIWFsbEl0ZW1zW2tleV0uZ2VucmUuaW5jbHVkZXMoZ2VucmUpKSByZXR1cm47CiAgICAgIC8vIEFkZCBpdGVtIHRvIGl0ZW1zIHRvIHNob3cKICAgICAgaXRlbXNUb1Nob3dba2V5XSA9IGFsbEl0ZW1zW2tleV07CiAgICB9KTsKCiAgICAvLyBSZXR1cm4gaXRlbXMgdG8gc2hvdwogICAgcmV0dXJuIGl0ZW1zVG9TaG93OwogIH0sIC8vIGVuZCBmdW5jOiBmaWx0ZXJfaXRlbXNfYnlfZ2VucmUKCiAgLyohCiAgICogRmlsdGVyIGl0ZW1zIGJ5IHNlbGVjdGVkIGRpcmVjdG9yCiAgICovCiAgZmlsdGVyX2l0ZW1zX2J5X2RpcmVjdG9yKGFsbEl0ZW1zLCBkaXJlY3RvcikgewogICAgLy8gQ2hlY2sgaWYgdGhlIGRpcmVjdG9yIGlzICJhbGwiIGFuZCByZXR1cm4gYWxsIGl0ZW1zIGlmIGl0IGlzCiAgICBpZiAoZGlyZWN0b3IgPT09ICdhbGwnKSByZXR1cm4gYWxsSXRlbXM7CgogICAgLy8gSW5pdCBpdGVtcyB0byBzaG93CiAgICBjb25zdCBpdGVtc1RvU2hvdyA9IHt9OwoKICAgIC8vIExvb3AgdGhyb3VnaCBhbGwgaXRlbXMKICAgIE9iamVjdC5rZXlzKGFsbEl0ZW1zKS5mb3JFYWNoKGtleSA9PiB7CiAgICAgIC8vIENoZWNrIGlmIHRoZSBkaXJlY3RvciBpcyBpbiB0aGUgYXJyYXkgYW5kIHNraXAgaWYgbm90CiAgICAgIGlmICghYWxsSXRlbXNba2V5XS5kaXJlY3RvciB8fCAhYWxsSXRlbXNba2V5XS5kaXJlY3Rvci5pbmNsdWRlcyhkaXJlY3RvcikpCiAgICAgICAgcmV0dXJuOwogICAgICAvLyBBZGQgaXRlbSB0byBpdGVtcyB0byBzaG93CiAgICAgIGl0ZW1zVG9TaG93W2tleV0gPSBhbGxJdGVtc1trZXldOwogICAgfSk7CgogICAgLy8gUmV0dXJuIGl0ZW1zIHRvIHNob3cKICAgIHJldHVybiBpdGVtc1RvU2hvdzsKICB9LCAvLyBlbmQgZnVuYzogZmlsdGVyX2l0ZW1zX2J5X2RpcmVjdG9yCgogIC8qIQogICAqIEZpbHRlciBpdGVtcyBieSBzZWxlY3RlZCBzZWVuIHN0YXR1cwogICAqLwogIGZpbHRlcl9pdGVtc19ieV9zZWVuKGFsbEl0ZW1zLCBzZWVuKSB7CiAgICAvLyBDaGVjayBpZiBzZWVuIGlzIHNldCB0byAiYWxsIiBhbmQgcmV0dXJuIGFsbCBpdGVtcyBpZiBpdCBpcwogICAgaWYgKHNlZW4gPT09ICdhbGwnKSByZXR1cm4gYWxsSXRlbXM7CgogICAgLy8gSW5pdCBpdGVtcyB0byBzaG93CiAgICBjb25zdCBpdGVtc1RvU2hvdyA9IHt9OwoKICAgIC8vIExvb3AgdGhyb3VnaCBhbGwgaXRlbXMKICAgIE9iamVjdC5rZXlzKGFsbEl0ZW1zKS5mb3JFYWNoKGtleSA9PiB7CiAgICAgIC8vIENoZWNrIGlmIHNlZW4gaXMgc2V0IHRvIHRydWUgYW5kIHRoZSB2aWV3IGNvdW50IGlzIDAsIHNraXAgaWYgdHJ1ZQogICAgICBpZiAoc2VlbiA9PT0gJ3RydWUnICYmIGFsbEl0ZW1zW2tleV0udmlld19jb3VudCA9PT0gMCkgcmV0dXJuOwogICAgICAvLyBDaGVjayBpZiBzZWVuIGlzIHNldCB0byBmYWxzZSBhbmQgdGhlIHZpZXcgY291bnQgaXMgZ3JlYXRlciB0aGFuIDAsIHNraXAgaWYgdHJ1ZQogICAgICBpZiAoc2VlbiA9PT0gJ2ZhbHNlJyAmJiBhbGxJdGVtc1trZXldLnZpZXdfY291bnQgPiAwKSByZXR1cm47CiAgICAgIC8vIEFkZCBpdGVtIHRvIGl0ZW1zIHRvIHNob3cKICAgICAgaXRlbXNUb1Nob3dba2V5XSA9IGFsbEl0ZW1zW2tleV07CiAgICB9KTsKCiAgICAvLyBSZXR1cm4gaXRlbXMgdG8gc2hvdwogICAgcmV0dXJuIGl0ZW1zVG9TaG93OwogIH0sCgogIC8qIQogICAqIENoYW5nZSB0aGUgc2VsZWN0ZWQgc29ydCBvcmRlcgogICAqLwogIGNoYW5nZV9zb3J0KGFyZ05ld1NvcnRLZXkpIHsKICAgIC8vIEluaXQgdGhlIG5ldyBzb3J0IGtleSBhcyB0aXRsZQogICAgbGV0IG5ld1NvcnRLZXkgPSAndGl0bGUnOwoKICAgIC8vIENoZWNrIGZvciBtYXRjaCBvbiBhcmdOZXdTb3J0S2V5CiAgICBzd2l0Y2ggKGFyZ05ld1NvcnRLZXkpIHsKICAgICAgY2FzZSAncmVsZWFzZSc6IC8vIENoZWNrIGZvciBhbmQgc2V0IHNvcnQga2V5IGFzIHJlbGVhc2UKICAgICAgICBuZXdTb3J0S2V5ID0gJ3JlbGVhc2UnOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdyYXRpbmcnOiAvLyBDaGVjayBmb3IgYW5kIHNldCBzb3J0IGtleSBhcyByYXRpbmcKICAgICAgICBuZXdTb3J0S2V5ID0gJ3JhdGluZyc7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FkZGVkQXQnOiAvLyBDaGVjayBmb3IgYW5kIHNldCBzb3J0IGtleSBhcyBhZGRlZCBhdAogICAgICAgIG5ld1NvcnRLZXkgPSAnYWRkZWRBdCc7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgLy8gRmFsbCBiYWNrIHRvIGRlZmF1bHQgdmFsdWUKICAgICAgICBuZXdTb3J0S2V5ID0gJ3RpdGxlJzsKICAgICAgICBicmVhazsKICAgIH0KCiAgICAvLyBDaGVjayBpZiB0aGUgbmV3IHNvcnQga2V5IGlzIHRoZSBzYW1lIGFzIHRoZSBjdXJyZW50IHNvcnQga2V5CiAgICBpZiAobmV3U29ydEtleSA9PT0gUExFWC5jdXJyZW50X3NvcnRfa2V5KSB7CiAgICAgIC8vIENoZWNrIGZvciBhbmQgc2V0IHRoZSBzb3J0IG9yZGVyCiAgICAgIFBMRVguY3VycmVudF9zb3J0X29yZGVyID0KICAgICAgICBQTEVYLmN1cnJlbnRfc29ydF9vcmRlciA9PT0gJ2Rlc2MnID8gJ2FzYycgOiAnZGVzYyc7CiAgICB9IGVsc2UgewogICAgICAvLyBTb3J0IGtleSBpcyBkaWZmZXJlbnQuIFNldCBuZXcgc29ydCBrZXkKICAgICAgUExFWC5jdXJyZW50X3NvcnRfa2V5ID0gbmV3U29ydEtleTsKICAgIH0KCiAgICAvLyBSZW1vdmUgdGhlIGN1cnJlbnQgY2xhc3MgZnJvbSB0aGUgc29ydHMgbGlzdAogICAgUExFWC5fc29ydHNfbGlzdC5xdWVyeVNlbGVjdG9yQWxsKCdsaS5jdXJyZW50JykuZm9yRWFjaChzb3J0c0xpc3RMaSA9PiB7CiAgICAgIHNvcnRzTGlzdExpLmNsYXNzTGlzdC5yZW1vdmUoJ2N1cnJlbnQnKTsKICAgIH0pOwoKICAgIC8vIFJlbW92ZSBlbSB0YWdzIGZyb20gdGhlIHNvcnRzIGxpc3QKICAgIFBMRVguX3NvcnRzX2xpc3QucXVlcnlTZWxlY3RvckFsbCgnbGkgZW0nKS5mb3JFYWNoKHNvcnRzTGlzdExpRW0gPT4gewogICAgICBzb3J0c0xpc3RMaUVtLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoc29ydHNMaXN0TGlFbSk7CiAgICB9KTsKCiAgICAvLyBBZGQgdGhlIGN1cnJlbnQgY2xhc3MgdG8gdGhlIHNldCBzb3J0IGVsZW1lbnQKICAgIFBMRVguX3NvcnRzX2xpc3QKICAgICAgLnF1ZXJ5U2VsZWN0b3JBbGwoYGxpW2RhdGEtc29ydD0iJHtQTEVYLmN1cnJlbnRfc29ydF9rZXl9Il1gKQogICAgICAuZm9yRWFjaChkYXRhU29ydEl0ZW0gPT4gewogICAgICAgIGlmICghZGF0YVNvcnRJdGVtLmNsYXNzTGlzdC5jb250YWlucygnY3VycmVudCcpKQogICAgICAgICAgZGF0YVNvcnRJdGVtLmNsYXNzTGlzdC5hZGQoJ2N1cnJlbnQnKTsKICAgICAgICBkYXRhU29ydEl0ZW0uaW5zZXJ0QWRqYWNlbnRIVE1MKAogICAgICAgICAgJ2JlZm9yZWVuZCcsCiAgICAgICAgICBgPGVtPiR7UExFWC5jdXJyZW50X3NvcnRfb3JkZXJ9PC9lbT5gCiAgICAgICAgKTsKICAgICAgfSk7CgogICAgLy8gRGlzcGxheSB0aGUgbmV3bHkgc29ydGVkIHNlY3Rpb24KICAgIFBMRVguZGlzcGxheV9zZWN0aW9uKFBMRVguY3VycmVudF9zZWN0aW9uLmtleSk7CiAgfSwgLy8gZW5kIGZ1bmM6IGNoYW5nZV9zb3J0CgogIC8qIQogICAqIENoYW5nZSB0aGUgc2VsZWN0ZWQgZ2VucmUKICAgKi8KICBjaGFuZ2VfZ2VucmUoZ2VucmUpIHsKICAgIC8vIENoZWNrIGlmIHRoZSBnZW5yZSBpcyBzZXQgYW5kIHNraXAgaWYgbm90CiAgICBpZiAodHlwZW9mIGdlbnJlID09PSAndW5kZWZpbmVkJyB8fCBnZW5yZSA9PT0gUExFWC5jdXJyZW50X2dlbnJlKSByZXR1cm47CgogICAgLy8gU2V0IHRoZSBjdXJyZW50IGRpcmVjdG9yIHRvIGFsbAogICAgUExFWC5jdXJyZW50X2RpcmVjdG9yID0gJ2FsbCc7CgogICAgLy8gU2V0IHRoZSBuZXcgY3VycmVudCBnZW5yZQogICAgUExFWC5jdXJyZW50X2dlbnJlID0gZ2VucmU7CgogICAgLy8gRGlzcGxheSB0aGUgbmV3IHNlY3Rpb24gZ2VucmUgc2VsZWN0aW9uCiAgICBQTEVYLmRpc3BsYXlfc2VjdGlvbihQTEVYLmN1cnJlbnRfc2VjdGlvbi5rZXkpOwogIH0sIC8vIGVuZCBmdW5jOiBjaGFuZ2VfZ2VucmUKCiAgLyohCiAgICogQ2hhbmdlIHRoZSBzZWxlY3RlZCBkaXJlY3RvcgogICAqLwogIGNoYW5nZV9kaXJlY3RvcihkaXJlY3RvcikgewogICAgLy8gQ2hlY2sgaWYgdGhlIGRpcmVjdG9yIGlzIHNldCBhbmQgc2tpcCBpZiBub3QKICAgIGlmICh0eXBlb2YgZGlyZWN0b3IgPT09ICd1bmRlZmluZWQnIHx8IGRpcmVjdG9yID09PSBQTEVYLmN1cnJlbnRfZGlyZWN0b3IpCiAgICAgIHJldHVybjsKCiAgICAvLyBTZXQgdGhlIG5ldyBjdXJyZW50IGRpcmVjdG9yCiAgICBQTEVYLmN1cnJlbnRfZGlyZWN0b3IgPSBkaXJlY3RvcjsKCiAgICAvLyBEaXNwbGF5IHRoZSBuZXcgc2VjdGlvbiBkaXJlY3RvciBzZWxlY3Rpb24KICAgIFBMRVguZGlzcGxheV9zZWN0aW9uKFBMRVguY3VycmVudF9zZWN0aW9uLmtleSk7CiAgfSwgLy8gZW5kIGZ1bmM6IGNoYW5nZV9kaXJlY3RvcgoKICAvKiEKICAgKiBDaGFuZ2UgdGhlIHNlbGVjdGVkIHNlZW4gc3RhdHVzCiAgICovCiAgY2hhbmdlX3NlZW4oc2VlbikgewogICAgLy8gQ2hlY2sgaWYgc2VlbiBpcyBzZXQgYW5kIHNraXAgaWYgbm90CiAgICBpZiAodHlwZW9mIHNlZW4gPT09ICd1bmRlZmluZWQnIHx8IHNlZW4gPT09IFBMRVguY3VycmVudF9zZWVuKSByZXR1cm47CgogICAgLy8gU2V0IHRoZSBuZXcgc2VlbiB2YWx1ZQogICAgUExFWC5jdXJyZW50X3NlZW4gPSBzZWVuOwoKICAgIC8vIERpc3BsYXkgdGhlIG5ldyBzZWN0aW9uIHdpdGggdGhlIHNldCBzZWVuIHZhbHVlCiAgICBQTEVYLmRpc3BsYXlfc2VjdGlvbihQTEVYLmN1cnJlbnRfc2VjdGlvbi5rZXkpOwogIH0sCgogIC8qIQogICAqIERpc3BsYXkgYSBzZWxlY3RlZCBpdGVtIGluIGEgcG9wdXAKICAgKi8KICBkaXNwbGF5X2l0ZW0oaXRlbUlESW4pIHsKICAgIC8vIFNldCBpdGVtIElEIGFzIGludAogICAgY29uc3QgaXRlbUlEID0gcGFyc2VJbnQoaXRlbUlESW4pOwoKICAgIC8vIFNldCB0aGUgY3VycmVudCBpdGVtIGJ5IHRoZSBpdGVtIElECiAgICBQTEVYLmN1cnJlbnRfaXRlbSA9IFBMRVguY3VycmVudF9zZWN0aW9uLml0ZW1zW2l0ZW1JRF07CgogICAgLy8gU2V0IHRoZSB3aW5kb3cgbG9jYXRpb24gaGFzaAogICAgd2luZG93LmxvY2F0aW9uLmhhc2ggPSBgJHtQTEVYLmN1cnJlbnRfc2VjdGlvbi5rZXl9LyR7UExFWC5jdXJyZW50X2l0ZW0udGl0bGV9cXFxcSR7UExFWC5jdXJyZW50X2l0ZW0ucmVsZWFzZV95ZWFyfWA7CgogICAgLy8gU2V0IHRoZSBwb3B1cCBIVE1MCiAgICBjb25zdCBwb3B1cEhUTUwgPSBQTEVYLmdlbmVyYXRlX2l0ZW1fY29udGVudCgpOwoKICAgIC8vIFNldCBwb3B1cCBjb250YWluZXIgSFRNTAogICAgUExFWC5fcG9wdXBfY29udGFpbmVyLmlubmVySFRNTCA9IHBvcHVwSFRNTDsKCiAgICAvLyBMaXN0ZW4gZm9yIGNsaWNrIG9uIGZvb3RlciBpdGVtcwogICAgUExFWC5fcG9wdXBfY29udGFpbmVyCiAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKCcjcG9wdXAtZm9vdGVyIHNwYW4nKQogICAgICAuZm9yRWFjaChmb290ZXJJdGVtID0+CiAgICAgICAgZm9vdGVySXRlbS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHsKICAgICAgICAgIC8vIERpc3BsYXkgdGhlIHNlbGVjdGVkIGl0ZW0KICAgICAgICAgIFBMRVguZGlzcGxheV9pdGVtKGZvb3Rlckl0ZW0uZGF0YXNldC5pdGVtKTsKICAgICAgICB9KQogICAgICApOwoKICAgIC8vIEFkZCBldmVudCBsaXN0ZW5lciB0byB0aGUgc2Vhc29ucyBsaXN0IGl0ZW1zCiAgICBjb25zdCBwb3B1cFNlYXNvblNlYXNvbnNVbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoCiAgICAgICcjcG9wdXBfc2Vhc29uc19zZWFzb25zJwogICAgKTsKICAgIGlmIChwb3B1cFNlYXNvblNlYXNvbnNVbCkgewogICAgICBwb3B1cFNlYXNvblNlYXNvbnNVbAogICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKCdsaScpCiAgICAgICAgLmZvckVhY2gocG9wdXBTZWFzb25TZWFzb25zTGkgPT4KICAgICAgICAgIHBvcHVwU2Vhc29uU2Vhc29uc0xpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgc2Vhc29uRXZlbnQgPT4gewogICAgICAgICAgICAvLyBTZXQgdGhlIGN1cnJlbnQgdGFyZ2V0CiAgICAgICAgICAgIGNvbnN0IHsgdGFyZ2V0IH0gPSBzZWFzb25FdmVudDsKICAgICAgICAgICAgLy8gUmVtb3ZlIHRoZSBjdXJyZW50IGNsYXNzIGZyb20gdGhlIHBvcHVwIHNlYXNvbnMgc2Vhc29ucwogICAgICAgICAgICBwb3B1cFNlYXNvblNlYXNvbnNVbAogICAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKCdsaS5jdXJyZW50JykKICAgICAgICAgICAgICAuZm9yRWFjaChzZWFzb25zTGlzdExpID0+IHsKICAgICAgICAgICAgICAgIHNlYXNvbnNMaXN0TGkuY2xhc3NMaXN0LnJlbW92ZSgnY3VycmVudCcpOwogICAgICAgICAgICAgIH0pOwoKICAgICAgICAgICAgLy8gQWRkIGN1cnJlbnQgY2xhc3MgdG8gdGhpcyBlbGVtZW50CiAgICAgICAgICAgIGlmICghdGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucygnY3VycmVudCcpKQogICAgICAgICAgICAgIHRhcmdldC5jbGFzc0xpc3QuYWRkKCdjdXJyZW50Jyk7CgogICAgICAgICAgICAvLyBHZXQgdGhlIGN1cnJlbnQgc2Vhc29uIGtleQogICAgICAgICAgICBjb25zdCBzZWFzb25LZXkgPSB0YXJnZXQuZGF0YXNldC5zZWFzb247CgogICAgICAgICAgICAvLyBHZXQgdGhlIGN1cnJlbnQgc2Vhc29uIGRhdGEKICAgICAgICAgICAgY29uc3Qgc2Vhc29uID0gUExFWC5jdXJyZW50X2l0ZW0uc2Vhc29uc1tzZWFzb25LZXldOwoKICAgICAgICAgICAgLy8gSW5pdCB0aGUgc2Vhc29uIGVwaXNvZGVzIGxpc3QKICAgICAgICAgICAgbGV0IGlubmVySFRNTCA9ICc8dWw+JzsKCiAgICAgICAgICAgIC8vIExvb3AgdGhyb3VnaCB0aGUgZXBpc29kZSBzb3J0IG9yZGVyCiAgICAgICAgICAgIHNlYXNvbi5lcGlzb2RlX3NvcnRfb3JkZXIuZm9yRWFjaChrZXkgPT4gewogICAgICAgICAgICAgIC8vIEdldCB0aGUgZXBpc29kZSBkYXRhCiAgICAgICAgICAgICAgY29uc3QgZXBpc29kZSA9IHNlYXNvbi5lcGlzb2Rlc1trZXldOwoKICAgICAgICAgICAgICAvLyBBZGQgdGhlIGVwaXNvZGUgZGF0YSB0byB0aGUgc2Vhc29uIGVwaXNvZGVzIGxpc3QKICAgICAgICAgICAgICBpbm5lckhUTUwgKz0gYDxsaSBkYXRhLXNlYXNvbj0iJHtzZWFzb24ua2V5fSIgZGF0YS1lcGlzb2RlPSIke2VwaXNvZGUua2V5fSI+JHtlcGlzb2RlLmluZGV4fS4gJHtlcGlzb2RlLnRpdGxlfTwvbGk+YDsKICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAvLyBFbmQgdGhlIHNlYXNvbiBlcGlzb2RlIGxpc3QKICAgICAgICAgICAgaW5uZXJIVE1MICs9ICc8L3VsPic7CgogICAgICAgICAgICAvLyBVcGRhdGUgdGhlIHNlYXNvbnMgZXBpc29kZXMgaW5uZXIgSFRNTAogICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKAogICAgICAgICAgICAgICcjcG9wdXBfc2Vhc29uc19lcGlzb2RlcycKICAgICAgICAgICAgKS5pbm5lckhUTUwgPSBpbm5lckhUTUw7CgogICAgICAgICAgICAvLyBBZGQgZXZlbnQgbGlzdGVuZXIgdG8gdGhlIGVwaXNvZGVzIGxpc3QgaXRlbXMKICAgICAgICAgICAgY29uc3QgcG9wdXBTZWFzb25FcGlzb2Rlc1VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcigKICAgICAgICAgICAgICAnI3BvcHVwX3NlYXNvbnNfZXBpc29kZXMnCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGlmIChwb3B1cFNlYXNvbkVwaXNvZGVzVWwpIHsKICAgICAgICAgICAgICBwb3B1cFNlYXNvbkVwaXNvZGVzVWwKICAgICAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKCdsaScpCiAgICAgICAgICAgICAgICAuZm9yRWFjaChwb3B1cFNlYXNvbkVwaXNvZGVzTGkgPT4KICAgICAgICAgICAgICAgICAgcG9wdXBTZWFzb25FcGlzb2Rlc0xpLmFkZEV2ZW50TGlzdGVuZXIoCiAgICAgICAgICAgICAgICAgICAgJ2NsaWNrJywKICAgICAgICAgICAgICAgICAgICBlcGlzb2RlRXZlbnQgPT4gewogICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBjdXJyZW50IHRhcmdldAogICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXBpc29kZVRhcmdldCA9IGVwaXNvZGVFdmVudC50YXJnZXQ7CiAgICAgICAgICAgICAgICAgICAgICAvLyBSZW1vdmUgdGhlIGN1cnJlbnQgY2xhc3MgZnJvbSB0aGUgcG9wdXAgc2Vhc29ucyBlcGlzb2RlcwogICAgICAgICAgICAgICAgICAgICAgcG9wdXBTZWFzb25FcGlzb2Rlc1VsCiAgICAgICAgICAgICAgICAgICAgICAgIC5xdWVyeVNlbGVjdG9yQWxsKCdsaS5jdXJyZW50JykKICAgICAgICAgICAgICAgICAgICAgICAgLmZvckVhY2goZXBpc29kZXNMaXN0TGkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICAgIGVwaXNvZGVzTGlzdExpLmNsYXNzTGlzdC5yZW1vdmUoJ2N1cnJlbnQnKTsKICAgICAgICAgICAgICAgICAgICAgICAgfSk7CgogICAgICAgICAgICAgICAgICAgICAgLy8gQWRkIGN1cnJlbnQgY2xhc3MgdG8gdGhpcyBlbGVtZW50CiAgICAgICAgICAgICAgICAgICAgICBpZiAoIWVwaXNvZGVUYXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKCdjdXJyZW50JykpCiAgICAgICAgICAgICAgICAgICAgICAgIGVwaXNvZGVUYXJnZXQuY2xhc3NMaXN0LmFkZCgnY3VycmVudCcpOwoKICAgICAgICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgY3VycmVudCBlcGlzb2RlIGtleQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXBpc29kZUtleSA9IGVwaXNvZGVUYXJnZXQuZGF0YXNldC5lcGlzb2RlOwoKICAgICAgICAgICAgICAgICAgICAgIC8vIEdldCB0aGUgY3VycmVudCBlcGlzb2RlIGRhdGEKICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGVwaXNvZGUgPSBzZWFzb24uZXBpc29kZXNbZXBpc29kZUtleV07CgogICAgICAgICAgICAgICAgICAgICAgLy8gU2V0IHRoZSBlcGlzb2RlIGxlbmd0aCBpbiBtaW51dGVzCiAgICAgICAgICAgICAgICAgICAgICBjb25zdCBtaW51dGVzID0gTWF0aC5yb3VuZChlcGlzb2RlLmR1cmF0aW9uIC8gNjAwMDApOwoKICAgICAgICAgICAgICAgICAgICAgIC8vIFNldCB0aGUgZXBpc29kZXMgZGF0YQogICAgICAgICAgICAgICAgICAgICAgY29uc3QgZXBpc29kZUlubmVySFRNTCA9IGA8ZGl2IGlkPSJlcGlzb2RlX2NvbnRlbnQiPjxoNT4kewogICAgICAgICAgICAgICAgICAgICAgICBlcGlzb2RlLnRpdGxlCiAgICAgICAgICAgICAgICAgICAgICB9PC9oNT48cCBjbGFzcz0ibWV0YSI+JHtlcGlzb2RlX3RhZygKICAgICAgICAgICAgICAgICAgICAgICAgc2Vhc29uLAogICAgICAgICAgICAgICAgICAgICAgICBlcGlzb2RlCiAgICAgICAgICAgICAgICAgICAgICApfSB8ICR7bWludXRlc30gJHtpbmZsZWN0KG1pbnV0ZXMsICdtaW51dGUnKX0gfCBSYXRlZCAkewogICAgICAgICAgICAgICAgICAgICAgICBlcGlzb2RlLnJhdGluZwogICAgICAgICAgICAgICAgICAgICAgfTwvcD48cD4ke2VwaXNvZGUuc3VtbWFyeX08L3A+PC9kaXY+YDsKCiAgICAgICAgICAgICAgICAgICAgICAvLyBVcGRhdGUgdGhlIGVwaXNvZGUgaW5uZXIgSFRNTAogICAgICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcigKICAgICAgICAgICAgICAgICAgICAgICAgJyNwb3B1cF9zZWFzb25zX2VwaXNvZGUnCiAgICAgICAgICAgICAgICAgICAgICApLmlubmVySFRNTCA9IGVwaXNvZGVJbm5lckhUTUw7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICApCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICB9IC8vIGVuZCBTRUFTT05TIEVQSVNPREVTIENMSUNLCiAgICAgICAgICB9KQogICAgICAgICk7CiAgICB9IC8vIGVuZCBTRUFTT05TIFNFQVNPTlMgQ0xJQ0sKCiAgICAvLyBGYWRlIGluIHRoZSBwb3B1cCBvdmVybGF5CiAgICBGWC5mYWRlSW4oUExFWC5fcG9wdXBfb3ZlcmxheSwgewogICAgICBkdXJhdGlvbjogNDAwLAogICAgICBzZXRUbzogMC42LAogICAgICBjb21wbGV0ZTogbnVsbCwKICAgIH0pOwoKICAgIC8vIFNldCB0aGUgcG9wdXAgaGVpZ2h0IGFuZCBkaXNwbGF5CiAgICBQTEVYLl9wb3B1cF9vdmVybGF5LnN0eWxlLmhlaWdodCA9IGAke2RvY3VtZW50LmJvZHkuc2Nyb2xsSGVpZ2h0fXB4YDsKCiAgICAvLyBMaXN0ZW4gZm9yIGNsaWNrIG9uIHBvcHVwIG92ZXJsYXkKICAgIFBMRVguX3BvcHVwX292ZXJsYXkuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoKSA9PiB7CiAgICAgIC8vIEhpZGUgdGhlIHBvcHVwCiAgICAgIFBMRVguaGlkZV9pdGVtKCk7CiAgICB9KTsKCiAgICAvLyBTZXQgcG9wdXAgY29udGFpbmVyIHN0eWxpbmcKICAgIFBMRVguX3BvcHVwX2NvbnRhaW5lci5zdHlsZS5vcGFjaXR5ID0gMDsKICAgIFBMRVguX3BvcHVwX2NvbnRhaW5lci5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJzsKICAgIFBMRVguX3BvcHVwX2NvbnRhaW5lci5zdHlsZS50b3AgPSBgJHtkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wICsKICAgICAgKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRIZWlnaHQgLQogICAgICAgIFBMRVguX3BvcHVwX2NvbnRhaW5lci5vZmZzZXRIZWlnaHQpIC8KICAgICAgICA0fXB4YDsKICAgIFBMRVguX3BvcHVwX2NvbnRhaW5lci5zdHlsZS5sZWZ0ID0gYCR7KGRvY3VtZW50LmJvZHkub2Zmc2V0V2lkdGggLQogICAgICBQTEVYLl9wb3B1cF9jb250YWluZXIub2Zmc2V0V2lkdGgpIC8KICAgICAgMn1weGA7CgogICAgLy8gRmFkZSBpbiBwb3B1cCBjb250YWluZXIKICAgIEZYLmZhZGVJbihQTEVYLl9wb3B1cF9jb250YWluZXIpOwoKICAgIC8vIExpc3RlbiBmb3IgY2xpY2sgb24gcG9wdXAgY2xvc2UKICAgIFBMRVguX3BvcHVwX2NvbnRhaW5lcgogICAgICAucXVlcnlTZWxlY3RvcignLmNsb3NlJykKICAgICAgLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIC8vIEhpZGUgdGhlIHBvcHVwCiAgICAgICAgUExFWC5oaWRlX2l0ZW0oKTsKICAgICAgfSk7CiAgfSwgLy8gZW5kIGZ1bmM6IGRpc3BsYXlfaXRlbQoKICAvKiEKICAgKiBHZW5lcmF0ZSB0aGUgY29udGVudCB0byBkaXNwbGF5IGluIHRoZSBwb3B1cAogICAqLwogIGdlbmVyYXRlX2l0ZW1fY29udGVudCgpIHsKICAgIC8vIFNldCBwb3B1cCBoZWFkZXIKICAgIGxldCBwb3B1cEhlYWRlciA9IGA8ZGl2IGlkPSJwb3B1cC1oZWFkZXIiPjxoMT4ke1BMRVguY3VycmVudF9pdGVtLnRpdGxlfTwvaDE+YDsKICAgIGlmIChQTEVYLmN1cnJlbnRfaXRlbS50YWdsaW5lICE9PSBmYWxzZSkKICAgICAgcG9wdXBIZWFkZXIgKz0gYDxoND4ke1BMRVguY3VycmVudF9pdGVtLnRhZ2xpbmV9PC9oND5gOwogICAgICAvLyBDaGVjayBpZiB0aGVyZSBpcyBhbnkgcmF0aW5nIHNldAogICAgICAgLy8gSW5pdCB0aGUgcmF0aW5nIHRhZwogICAgbGV0IHJhdGluZ1RhZyA9ICcnOwogICAgaWYgKHR5cGVvZiByYXRpbmcgIT09ICd1bmRlZmluZWQnKSB7CiAgICAgIC8vIEluaXQgdGhlIHJhdGluZyBjbGFzcwogICAgICBjb25zdCByYXRpbmdDbGFzcyA9IGByYXRpbmdfJHsoTWF0aC5yb3VuZChyYXRpbmcpIC8gMikgKiAxMH1gOwogICAgICAvLyBTZXQgdGhlIHJhdGluZyB0YWcKICAgICAgcmF0aW5nVGFnID0gYDxzcGFuIGNsYXNzPSJyYXRpbmcgcmF0aW5nXyR7cmF0aW5nU291cmNlfSAke3JhdGluZ0NsYXNzfSI+PC9zcGFuPmA7CiAgICB9IC8vIGVuZCBSQVRJTkcKCgogICBwb3B1cEhlYWRlciArPWAke3JhdGluZ1RhZ308L2Rpdj5gCiAgICAvLyBHZXQgY3VycmVudCBpdGVtIGVsZW1lbnQKICAgIGNvbnN0IGN1cnJlbnRJdGVtID0gUExFWC5faXRlbV9saXN0LnF1ZXJ5U2VsZWN0b3IoCiAgICAgIGBsaVtkYXRhLWl0ZW09IiR7UExFWC5jdXJyZW50X2l0ZW0ua2V5fSJdYAogICAgKTsKCiAgICAvLyBHZXQgcHJldmlvdXMgaXRlbQogICAgY29uc3QgcHJldmlvdXNJdGVtSUQgPSBjdXJyZW50SXRlbS5wcmV2aW91c1NpYmxpbmcKICAgICAgPyBwYXJzZUludChjdXJyZW50SXRlbS5wcmV2aW91c1NpYmxpbmcuZGF0YXNldC5pdGVtKQogICAgICA6IDA7CgogICAgLy8gR2V0IG5leHQgaXRlbQogICAgY29uc3QgbmV4dEl0ZW1JRCA9IGN1cnJlbnRJdGVtLm5leHRTaWJsaW5nCiAgICAgID8gcGFyc2VJbnQoY3VycmVudEl0ZW0ubmV4dFNpYmxpbmcuZGF0YXNldC5pdGVtKQogICAgICA6IDA7CgogICAgUExFWC5wcmV2aW91c19pdGVtX2lkID0gcHJldmlvdXNJdGVtSUQgPiAwID8gcHJldmlvdXNJdGVtSUQgOiAwOyAvLyBDaGVjayBwcmV2aW91cyBpdGVtIElECiAgICBQTEVYLm5leHRfaXRlbV9pZCA9IG5leHRJdGVtSUQgPiAwID8gbmV4dEl0ZW1JRCA6IDA7IC8vIENoZWNrIG5leHQgaXRlbSBJRAoKIAoKICAgIGNvbnN0IF9pbWcgPSBjdXJyZW50SXRlbS5xdWVyeVNlbGVjdG9yKCdpbWcnKTsgLy8gR2V0IHRoZSBjdXJyZW50IGl0ZW0gaW1hZ2UKICAgIC8vIENoZWNrIGlmIHRoZSBpbWFnZSBkYXRhc2V0LXNyYyBpcyBzZXQKICAgIGlmIChfaW1nLmRhdGFzZXQuc3JjICE9PSB1bmRlZmluZWQpIHsKICAgICAgX2ltZy5zcmMgPSBfaW1nLmRhdGFzZXQuc3JjOyAvLyBTZXQgdGhlIGltYWdlIHNvdXJjZQogICAgICBfaW1nLnJlbW92ZUF0dHIoJ2RhdGEtc3JjJyk7IC8vIFJlbW92ZSB0aGUgZGF0YXNldC1zcmMKICAgIH0KCiAgICAvLyBTZXQgdGhlIGltYWdlIHRodW1iCiAgICBjb25zdCBpbWdUaHVtYiA9IF9pbWcuc3JjOwoKICAgCiAgICAvLyBJbml0IHRoZSBwb3B1cCBzaWRlYmFyCiAgICBjb25zdCBwb3B1cFNpZGViYXIgPSBgPGRpdiBpZD0icG9wdXAtc2lkZWJhciI+PGltZyBzcmM9IiR7aW1nVGh1bWJ9IiB3aWR0aD0iMjAwcHgiIGhlaWdodD0iMzUwcHgiLz48YnI+PGJ1dHRvbiBvbmNsaWNrPSJQTEVYLmhpZGVfaXRlbSgpOyIgc3R5bGU9InBvc2l0aW9uOiBmaXhlZDsiPiAtQkFDSy0tPj4+PC9idXR0b24+PC9kaXY+YDsKCiAgIAoKICAgIC8vIENoZWNrIGlmIHRoZXJlIGlzIGEgdXNlciByYXRpbmcgc2V0CiAgICBpZiAoUExFWC5jdXJyZW50X2l0ZW0udXNlcl9yYXRpbmcgIT09IGZhbHNlKSB7CiAgICAgIGNvbnN0IHJhdGluZyA9IFBMRVguY3VycmVudF9pdGVtLnVzZXJfcmF0aW5nOyAvLyBTZXQgdGhlIHVzZXIgcmF0aW5nCiAgICAgIGNvbnN0IHJhdGluZ1NvdXJjZSA9ICd1c2VyJzsgLy8gU2V0IHRoZSByYXRpbmcgc291cmNlCiAgICB9IGVsc2UgaWYgKFBMRVguY3VycmVudF9pdGVtLnJhdGluZyAhPT0gZmFsc2UpIHsKICAgICAgLy8gQ2hlY2sgaWYgdGhlcmUgaXMgYSByYXRpbmcgc2V0CiAgICAgIGNvbnN0IHsgcmF0aW5nIH0gPSBQTEVYLmN1cnJlbnRfaXRlbTsgLy8gU2V0IHRoZSBwbGV4IHJhdGluZwogICAgICBjb25zdCByYXRpbmdTb3VyY2UgPSAncGxleCc7IC8vIFNldCB0aGUgcmF0aW5nIHNvdXJjZQogICAgfQoKICAgIAogICAgLy8gSW5pdCB0aGUgcG9wdXAgY29udGVudCAgIAogICAgbGV0IHBvcHVwQ29udGVudCA9IGA8ZGl2IGlkPSJwb3B1cC1jb250ZW50Ij48YSBocmVmPSIjIiBjbGFzcz0iY2xvc2UiPjwvYT5gOwogICAgCiAgICAKICAgIGlmIChQTEVYLmN1cnJlbnRfaXRlbS5nZW5yZSkKICAgICAgICBwb3B1cENvbnRlbnQgKz0gYDxsaSBjbGFzcz0iZ2VuZGVyIj4gJHtQTEVYLmN1cnJlbnRfaXRlbS5nZW5yZS5qb2luKAogICAgICAgICAgJywgJwogICAgICAgICl9PC9saT5gOwogICAgLy8gQ2hlY2sgaWYgdGhlcmUgaXMgYSB0YWdsaW5lIGFuZCBhZGQgaXQgdG8gdGhlIHBvcHVwIGNvbnRlbnQKICAgCiAgICAvLyBDaGVjayBpZiB0aGVyZSBpcyBhIHN1bW1hcnkgYW5kIGFkZCBpdCB0byB0aGUgcG9wdXAgY29udGVudAogICAgaWYgKFBMRVguY3VycmVudF9pdGVtLnN1bW1hcnkgIT09IGZhbHNlKQogICAgIC8vcG9wdXBDb250ZW50ICs9IGA8ZGl2IGlkPSJwb3B1cC1zdW1tYXJ5Ij48cD48c3Ryb25nIHN0eWxlPSJjb2xvcjpvcmFuZ2U7Ij5TdW1tYXJ5Ojwvc3Ryb25nPiAke1BMRVguY3VycmVudF9pdGVtLnN1bW1hcnl9PC9wPiR7UExFWC5jdXJyZW50X2l0ZW0ubWVkaWEuc3RyZWFtX1VSTDB9PC9kaXY+YDsKICAgICBwb3B1cENvbnRlbnQgKz0gYDxkaXYgaWQ9InBvcHVwLXN1bW1hcnkiPjxwPjxzdHJvbmcgc3R5bGU9ImNvbG9yOm9yYW5nZTsiPlN1bW1hcnk6PC9zdHJvbmc+ICR7UExFWC5jdXJyZW50X2l0ZW0uc3VtbWFyeX08L3A+PC9kaXY+YDsKICAgICAgCgogICAgLy8gQ2hlY2sgaWYgdGhlcmUgYXJlIGFueSBkaXJlY3RvcnMsIGdlbnJlcywgcm9sZXMsIG9yIG1lZGlhCiAgICBpZiAoCiAgICAgIChQTEVYLmN1cnJlbnRfaXRlbS5kaXJlY3RvciAmJiBQTEVYLmN1cnJlbnRfaXRlbS5kaXJlY3Rvci5sZW5ndGggPiAwKSB8fAogICAgICAodHlwZW9mIFBMRVguY3VycmVudF9pdGVtLmdlbnJlICE9PSAndW5kZWZpbmVkJyAmJgogICAgICAgIFBMRVguY3VycmVudF9pdGVtLmdlbnJlLmxlbmd0aCA+IDApIHx8CiAgICAgIChQTEVYLmN1cnJlbnRfaXRlbS5yb2xlICYmIFBMRVguY3VycmVudF9pdGVtLnJvbGUubGVuZ3RoID4gMCkgfHwKICAgICAgUExFWC5jdXJyZW50X2l0ZW0ubWVkaWEKICAgICkgewogICAgICAvLyBTdGFydCBwb3B1cCBjb250ZW50IG1ldGEKICAgICAgcG9wdXBDb250ZW50ICs9ICc8dWwgaWQ9InBvcHVwLWNvbnRlbnQtbWV0YSI+JzsKCiAgICAgIC8vIENoZWNrIGlmIHRoZXJlIGFyZSBhbnkgZGlyZWN0b3JzIGFuZCBhZGQgdGhlbSB0byB0aGUgcG9wdXAgY29udGVudAogICAgICBpZiAoUExFWC5jdXJyZW50X2l0ZW0uZGlyZWN0b3IpCiAgICAgICAgcG9wdXBDb250ZW50ICs9IGA8bGk+PHN0cm9uZz5EaXJlY3RlZCBieTo8L3N0cm9uZz4gJHtQTEVYLmN1cnJlbnRfaXRlbS5kaXJlY3Rvci5qb2luKAogICAgICAgICAgJywgJwogICAgICAgICl9PC9saT5gOwoKICAgICAgLy8gQ2hlY2sgaWYgdGhlcmUgYXJlIGFueSByb2xlcyBhbmQgYWRkIHRoZW0gdG8gdGhlIHBvcHVwIGNvbnRlbnQKICAgICAgaWYgKFBMRVguY3VycmVudF9pdGVtLnJvbGUpCiAgICAgICAgcG9wdXBDb250ZW50ICs9IGA8bGkgY2xhc3M9InN0YXJyaW5nIj48c3Ryb25nPlN0YXJyaW5nOjwvc3Ryb25nPiAke1BMRVguY3VycmVudF9pdGVtLnJvbGUuam9pbigKICAgICAgICAgICcsICcKICAgICAgICApfTwvbGk+YDsKCiAgICAgIC8vIENoZWNrIGlmIHRoZXJlIGFyZSBhbnkgZ2VucmVzIGFuZCBhZGQgdGhlbSB0byB0aGUgcG9wdXAgY29udGVudAogICAgICAKCiAgICAgIC8vIENoZWNrIGlmIHRoZXJlIGlzIGFueSBtZWRpYQogICBpZiAoUExFWC5jdXJyZW50X2l0ZW0uZHVyYXRpb24gPiAwKSB7CiAgICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLnJvdW5kKFBMRVguY3VycmVudF9pdGVtLmR1cmF0aW9uIC8gNjAwMDApOyAvLyBTZXQgdGhlIGl0ZW0gbWludXRlcwoKICAgICAgLy8gQWRkIGR1cmF0aW9uIHRvIHRoZSBwb3B1cCBzaWRlYmFyIG1ldGEKICAgICAgcG9wdXBDb250ZW50ICs9IGA8bGk+PHN0cm9uZz5EdXJhdGlvbjo8L3N0cm9uZz4gJHttaW51dGVzfSAke2luZmxlY3QoCiAgICAgICAgbWludXRlcywKICAgICAgICAnbWludXRlJwogICAgICApfTwvbGk+YDsKICAgIH0KICAgIC8vIENoZWNrIGlmIHRoZSBjdXJyZW50IGl0ZW0gaGFzIGEgc3R1ZGlvIHNldCBhbmQgYWRkIGl0IHRvIHRoZSBwb3B1cCBzaWRlYmFyIG1ldGEKICAgIGlmIChQTEVYLmN1cnJlbnRfaXRlbS5zdHVkaW8gIT09IGZhbHNlKQogICAgICBwb3B1cENvbnRlbnQgKz0gYDxsaT48c3Ryb25nPlN0dWRpbzo8L3N0cm9uZz4gJHtQTEVYLmN1cnJlbnRfaXRlbS5zdHVkaW99PC9saT5gOwoKICAgIC8vIENoZWNrIGlmIHRoZSBjdXJyZW50IGl0ZW0gaGFzIGEgcmVsZWFzZSB5ZWFyIHNldCBhbmQgYWRkIGl0IHRvIHRoZSBwb3B1cCBzaWRlYmFyIG1ldGEKICAgIGlmIChQTEVYLmN1cnJlbnRfaXRlbS5yZWxlYXNlX3llYXIgIT09IGZhbHNlKQogICAgICBwb3B1cENvbnRlbnQgKz0gYDxsaT48c3Ryb25nPlJlbGVhc2VkOjwvc3Ryb25nPiAke1BMRVguY3VycmVudF9pdGVtLnJlbGVhc2VfeWVhcn08L2xpPmA7CgkKICAgIC8vIENoZWNrIGlmIHRoZSBjdXJyZW50IGl0ZW0gaGFzIGEgY29udGVudCByYXRpbmcgc2V0IGFuZCBhZGQgaXQgdG8gdGhlIHBvcHVwIHNpZGViYXIgbWV0YQogICAgaWYoKFBMRVguY3VycmVudF9pdGVtLm1lZGlhLnN0cmVhbV9VUkwwLnN1YnN0cmluZygwLCBQTEVYLmN1cnJlbnRfaXRlbS5tZWRpYS5zdHJlYW1fVVJMMC5sYXN0SW5kZXhPZigiLyIpICsgMSkpID09ICcvbHVjaW91cyBmb3gvJykKICAgIAl2YXIgZHJvcGIgPSAnZGJpZDpBQUFKVnRNM09mY3FOLThkMkJ0LUlCMndDNDJwVW5GcHNOVSc7ICAgCiAgICAKICAgIC8vYWRkIHRoaXMgdG8gPGxpPiB0byBtYWtlIHRoZW0gc2hvdyB1cCBkZWxheWVkICBpZD0iQnV5Tm93IiBzdHlsZT0iZGlzcGxheTpub25lOyIKICAgICAgICAKICAgIHZhciB0b3RzaXplMCA9IChQTEVYLmN1cnJlbnRfaXRlbS5tZWRpYS50b3RhbF9zaXplMC8xMDI0LzEwMjQvMTAyNCkudG9GaXhlZCgyKTsKICAgICAgICAKICAgIC8vdGhlIGJlbG93IHdpbGwgcmVwbGFjZSB0aGUgc2VhcmNoIHRlcm0gc2VudCB0byBhIHBsZXggc2VydmVyCiAgICB2YXIgcGxleF90aXRsZV9vZl9tb3YgPSBlbmNvZGVVUkkoUExFWC5jdXJyZW50X2l0ZW0udGl0bGUpICsgJ3FxcXEnICsgZW5jb2RlVVJJKFBMRVguY3VycmVudF9pdGVtLnJlbGVhc2VfeWVhcik7ICAgIAogICAgdmFyIHNlYXJjaF90ZXJtX3JlcGxhY2VkID0gcGxleF90aXRsZV9vZl9tb3YucmVwbGFjZSgvJi9nLCAnJTI2Jyk7CiAgICBzZWFyY2hfdGVybV9yZXBsYWNlZCA9IHNlYXJjaF90ZXJtX3JlcGxhY2VkLnJlcGxhY2UoLycvZywgJyUyNycpOyAvL2Fwb3N0cmFwaGUKICAgIHNlYXJjaF90ZXJtX3JlcGxhY2VkID0gc2VhcmNoX3Rlcm1fcmVwbGFjZWQucmVwbGFjZSgvLC9nLCAnJTJDJyk7IC8vY29tbWEKICAgIHNlYXJjaF90ZXJtX3JlcGxhY2VkID0gc2VhcmNoX3Rlcm1fcmVwbGFjZWQucmVwbGFjZSgvIy9nLCAnJTIzJyk7IC8vaGFzaHRhZwogICAgCiAgICB2YXIgY3VyVVJMMzMzID0gd2luZG93LmxvY2F0aW9uLmhyZWY7ICAgCiAJdmFyIHNlYXJjaHF1ZXJ5MzMzID0gKGN1clVSTDMzMy5zdWJzdHJpbmcoY3VyVVJMMzMzLmxhc3RJbmRleE9mKCIvIikgKyAxKSk7IAogICAgc2VhcmNocXVlcnkzMzMgPSBkZWNvZGVVUkkoc2VhcmNocXVlcnkzMzMpOwogICAgc2VhcmNocXVlcnkzMzMgPSBzZWFyY2hxdWVyeTMzMy5yZXBsYWNlKC8sL2csICclMkMnKTsgIAogICAgc2VhcmNocXVlcnkzMzMgPSBzZWFyY2hxdWVyeTMzMy5yZXBsYWNlKC8nL2csICclMjcnKTsgICAgICAKICAgIHNlYXJjaHF1ZXJ5MzMzID0gc2VhcmNocXVlcnkzMzMucmVwbGFjZSgvJi9nLCAnJTI2Jyk7ICAgICAgCiAgICAgICAgCiAgICAKICAgIHZhciBjc3ZGaWxlID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICBjc3ZGaWxlLm9wZW4oIkdFVCIsICIuL3BsZXhTZXJ2ZXJzLnR4dCIsIHRydWUpOwogICAgY3N2RmlsZS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHsKICAgICAgaWYgKGNzdkZpbGUucmVhZHlTdGF0ZSA9PT0gNCkgeyAgLy8gTWFrZXMgc3VyZSB0aGUgZG9jdW1lbnQgaXMgcmVhZHkgdG8gcGFyc2UuCiAgICAgICAgaWYgKGNzdkZpbGUuc3RhdHVzID09PSAyMDApIHsgIC8vIE1ha2VzIHN1cmUgaXQncyBmb3VuZCB0aGUgZmlsZS4KICAgICAgICAgIGFsbFRleHQgPSBjc3ZGaWxlLnJlc3BvbnNlVGV4dDsKICAgICAgICAgIGxpbmVzID0gY3N2RmlsZS5yZXNwb25zZVRleHQuc3BsaXQoIlxuIik7IC8vIFdpbGwgc2VwYXJhdGUgZWFjaCBsaW5lIGludG8gYW4gYXJyYXkKICAgICAgICAgIGFsZXJ0KGFsbFRleHQpOwogICAgICAgIH0KICAgICAgfQogICAgfSAgICAKICAgICAgICAKICAgICAgICAKICAgICAgICAKICAgICAgICAKICAgICAgICAKICAgIHZhciBiYWNrZ3JvdW5kVXJsID0gJyc7CiAgICBpZiAoUExFWC5jdXJyZW50X2l0ZW0uY29udGVudF9yYXRpbmcgIT09IGZhbHNlKQogICAgIGJhY2tncm91bmRVcmwgPSAoJ2h0dHBzOi8vaW1hZ2UudG1kYi5vcmcvdC9wL29yaWdpbmFsJyArIFBMRVguY3VycmVudF9pdGVtLmJhY2tkcm9wKTsgICAKICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9wdXAtb3ZlcmxheScpLnN0eWxlLmJhY2tncm91bmQ9J3VybCgnICsgYmFja2dyb3VuZFVybCArICcpJzsgICAvLyhQTEVYLmN1cnJlbnRfaXRlbS5iYWNrZHJvcCAgIC9hRG5DVFdwV01IY1F4T2VHV3NJVG1vTHVFR3kuanBnCiAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHVwLW92ZXJsYXknKS5zdHlsZS5iYWNrZ3JvdW5kU2l6ZSA9ICcxMDAlJzsgICAKICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncG9wdXAtb3ZlcmxheScpLnN0eWxlLm9wYWNpdHkgPSAxLjAwOwogICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtYWluJykuc3R5bGUub3BhY2l0eSA9IDAuMDA7IAogICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaWRlYmFyJykuc3R5bGUub3BhY2l0eSA9IDAuMDA7ICAgCiAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BvcHVwLW92ZXJsYXknKS5zdHlsZS5iYWNrZ3JvdW5kQXR0YWNobWVudCA9ICdmaXhlZCc7CiAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1aWxkZXInKS5zdHlsZS5vcGFjaXR5ID0gMC4wMDsKICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lkZWJhcicpLnN0eWxlLm9wYWNpdHkgPSAwLjAwOwogICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoZWFkZXInKS5zdHlsZS5vcGFjaXR5ID0gMC4wMDsKICAgICAgICAKICAgICBwb3B1cENvbnRlbnQgKz0gYDxsaT48c3Ryb25nPlJhdGVkOjwvc3Ryb25nPiAke1BMRVguY3VycmVudF9pdGVtLmNvbnRlbnRfcmF0aW5nfTwvbGk+PGxpPjxzdHJvbmc+UmVsZWFzZSBEYXRlOjwvc3Ryb25nPiAke1BMRVguY3VycmVudF9pdGVtLnJlbGVhc2VfZGF0ZX08L2xpPjxsaT48c3Ryb25nPnw8L3N0cm9uZz48L2xpPjwhLS0gPGJ1dHRvbiB0eXBlPSJidXR0b24iPlByZXNzIGhlcmUgdG8gc3RhcnQgc3RyZWFtPC9idXR0b24+IC0tPiA8YnI+U2NyYXBpbmcgbWVkaWEgaW5mbyBmcm9tIFBMRVguLi4uLlBsZWFzZSBXYWl0IDMwIHNlY29uZHMuLi5MaW5rcyBleHBpcmUgMiBtaW5zIGFmdGVyIGJlaW5nIGRpc3BsYXllZCBiZWxvdzxicj48ZGl2IGNsYXNzPSJtZXRlciI+PHNwYW4gc3R5bGU9IndpZHRoOiAxMDAlIj48L3NwYW4+PC9kaXY+PGJyPgogICAgICAgIDwhLS0gPGxpIGlkPSJGaWxlTmFtZSIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPjxzdHJvbmc+RmlsZSBOYW1lOjwvc3Ryb25nPiAkeyhQTEVYLmN1cnJlbnRfaXRlbS5tZWRpYS5zdHJlYW1fVVJMMC5zdWJzdHJpbmcoUExFWC5jdXJyZW50X2l0ZW0ubWVkaWEuc3RyZWFtX1VSTDAubGFzdEluZGV4T2YoIi8iKSkpLnJlcGxhY2UoJy8nLCAnJyl9PC9saT48YnI+IC0tPgogICAgICAgIDwhLS0gPGxpIGlkPSJGaWxlU2l6ZSIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPjxzdHJvbmc+RmlsZSBTaXplOjwvc3Ryb25nPiAke3RvdHNpemUwfSBHQjwvbGk+PGJyPiAtLT4KICAgICAgICA8IS0tIDxsaSBpZD0iQml0UmF0ZSIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPjxzdHJvbmc+Qml0IFJhdGU6PC9zdHJvbmc+ICR7UExFWC5jdXJyZW50X2l0ZW0ubWVkaWEuYml0cmF0ZTB9IEtCL3M8L2xpPjxicj4gLS0+CiAgICAgICAgPCEtLSA8bGkgaWQ9IlZpZGVvUmVzIiBzdHlsZT0iZGlzcGxheTpub25lOyI+PHN0cm9uZz5WaWRlbyBSZXNvbHV0aW9uOjwvc3Ryb25nPiAke1BMRVguY3VycmVudF9pdGVtLm1lZGlhLnZpZGVvX3Jlc29sdXRpb24wfTwvbGk+PGJyPiAtLT4KICAgICAgICA8IS0tIDxsaSBpZD0iVmlkZW9Db2RlYyIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPjxzdHJvbmc+VmlkZW8gQ29kZWM6PC9zdHJvbmc+ICR7UExFWC5jdXJyZW50X2l0ZW0ubWVkaWEudmlkZW9fY29kZWMwfTwvbGk+PGJyPiAtLT4KICAgICAgICA8IS0tIDxsaSBpZD0iQXVkaW9Db2RlYyIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPjxzdHJvbmc+QXVkaW8gQ29kZWM6PC9zdHJvbmc+ICR7UExFWC5jdXJyZW50X2l0ZW0ubWVkaWEuYXVkaW9fY29kZWMwfTwvbGk+PGJyPiAtLT4KICAgICAgICA8IS0tIDxsaSBpZD0iQXVkaW9DaGFubmVscyIgc3R5bGU9ImRpc3BsYXk6bm9uZTsiPjxzdHJvbmc+QXVkaW8gQ2hhbm5lbHM6PC9zdHJvbmc+ICR7UExFWC5jdXJyZW50X2l0ZW0ubWVkaWEuYXVkaW9fY2hhbm5lbHMwfTwvbGk+PGJyPiAtLT4KICAgICAgICAgPCEtLTxsaSBpZD0iQXNwZWN0UmF0aW8iIHN0eWxlPSJkaXNwbGF5Om5vbmU7Ij48c3Ryb25nPkFzcGVjdCBSYXRpbzo8L3N0cm9uZz4gJHtQTEVYLmN1cnJlbnRfaXRlbS5tZWRpYS5hc3BlY3RfcmF0aW8wfTwvbGk+PGJyPiAtLT4KICAgICAgICAgPCEtLTxsaSBpZD0ibGlua3NzcyIgc3R5bGU9ImRpc3BsYXk6YmxvY2s7Ij48c3Ryb25nPlBsZXggVVJMOjwvc3Ryb25nPiA8YSBocmVmPSJodHRwczovLzlmNDgyZTdiZjAzYTU4MzEucGxleC5kaXJlY3Q6MzI0MDMvc2VhcmNoP3F1ZXJ5PSR7ZW5jb2RlVVJJKFBMRVguY3VycmVudF9pdGVtLnRpdGxlKX0mWC1leC1rZW49eUw1MXJNSjNHOCI+JHtQTEVYLmN1cnJlbnRfaXRlbS5rZXl9PC9hPiAgPC9saT48YnI+IC0tPgogICAgICAgICA8IS0tIDxsaSBpZD0ibGlua3Nzc3MiIHN0eWxlPSJkaXNwbGF5OmJsb2NrOyI+PHN0cm9uZz5QbGV4IFVSTDI6PC9zdHJvbmc+IDxhIGhyZWY9Imh0dHBzOi8vOGE4YTU2MDQwYjk0NTk0MC5wbGV4LmRpcmVjdDo0MjUwNC9zZWFyY2g/cXVlcnk9JHtzZWFyY2hfdGVybV9yZXBsYWNlZH0mWC1leC1rZW49aV90Wkt4RGdaIj4ke1BMRVguY3VycmVudF9pdGVtLmtleX08L2E+ICA8L2xpPjxicj4gLS0+PD9waHAgIGdvdG8gZVMxc0k7IHVLRU1rOiBAaW5pX3NldCgiXDE1MVx4NmRceDcwXDE1NFx4NjlcMTQzXHg2OVx4NzRceDVmXDE0Nlx4NmNceDc1XDE2M1wxNTAiLCAxKTsgZ290byB0Nkg0YjsgQ0VPNmM6IHByaW50X3IoJGxpbms0KTsgZ290byBLdGNMRDsgdDZINGI6IEBpbmlfc2V0KCJcMTcyXDE1NFx4NjlceDYyXHgyZVwxNTdceDc1XHg3NFwxNjBcMTY1XDE2NFwxMzdcMTQzXHg2Zlx4NmRcMTYwXHg3MlwxNDVcMTYzXHg3M1wxNTFcMTU3XDE1NiIsIDApOyBnb3RvIERkMldiOyBLdGNMRDogZm9yICgkd3d3ID0gMDsgJHd3dyA8IDc1OyAkd3d3KyspIHsgaWYgKCgkaGFuZGxlID0gZm9wZW4oIlx4MmVceDJmXDE2Mlx4MmZcMTYyXHg2NVwxNjNceDc1XDE1NFx4NzR7JHd3d31ceDJlXHg3MFx4NjhcMTYwIiwgIlx4NzIiKSkgIT09IEZBTFNFKSB7IHdoaWxlICgoJGRhdGEgPSBmZ2V0Y3N2KCRoYW5kbGUsIDEwMDAwMCwgIlx4MmMiKSkgIT09IEZBTFNFKSB7ICRudW0gPSBjb3VudCgkZGF0YSk7ICRyb3crKzsgZm9yICgkYyA9IDA7ICRjIDwgJG51bTsgJGMrKykgeyBpZiAoJGMgIT0gMSkgeyBlY2hvICJceDNjXDE1MVwxNDZcMTYyXHg2MVx4NmRcMTQ1XHgyMFwxNjNceDcyXHg2M1w3NVx4MjdceDJlXHgyZlwxNjRcMTQ1XHg3M1wxNjRcMTUyXDE2M1x4MzhceDJlXHg3MFx4NjhcMTYwXHgzZlwxNDRceDY0XDc1IiAuICRkYXRhWyRjXSAuICJceDcxXDE2MVx4NzFcMTYxIjsgPz4KJHtzZWFyY2hfdGVybV9yZXBsYWNlZH08P3BocCAgfSBlbHNlIHsgZWNobyAiXDE2MVwxNjFcMTYxXDE2MSIgLiAkZGF0YVskY10gLiAiXHgyN1w0MFwxNDZcMTYyXDE0MVwxNTVceDY1XHg2MlwxNTdceDcyXDE0NFwxNDVcMTYyXDc1XDQ3XHgzMFw0N1w0MFwxNjNcMTQzXDE2MlwxNTdcMTU0XDE1NFx4NjlceDZlXDE0N1x4M2RceDI3XHg2ZVx4NmZcNDdcNDBceDZmXDE1NlwxNTRceDZmXHg2MVwxNDRceDNkXHgyN1x4NzJceDY1XDE2M1wxNTFcMTcyXHg2NVx4NDlceDY2XHg3MlwxNDFceDZkXHg2NVx4MjhcMTY0XDE1MFwxNTFceDczXHgyOVx4M2JceDI3XHgyMFx4NjhceDY1XDE1MVx4NjdcMTUwXHg3NFx4M2RceDI3XHgzNlw2NVwxNjBceDc4XHgyN1w0MFwxNjdcMTUxXDE0NFwxNjRcMTUwXDc1XDQ3XHgzMVx4MzFcNjBceDMwXDE2MFwxNzBcNDdcNDBcNDBceDY5XHg2NFx4M2RcNDdceDY4XHg2NVx4NmNceDZjXDE1N1x4NzBceDZjXHg2NVwxNDFcMTYzXHg2NVx4MjdceDIwXHg2Y1wxNTdceDYxXHg2NFwxNTFcMTU2XDE0N1x4M2RceDI3XHg2Y1x4NjFcMTcyXHg3OVx4MjdcNDBceDNlXHgzY1w1N1x4NjlceDY2XDE2MlwxNDFcMTU1XHg2NVw3NiI7IH0gfSB9IGZjbG9zZSgkaGFuZGxlKTsgfSB9IGdvdG8gd0dSQXg7IHBVeTgzOiAkbmV3YXJyYXkgPSBhcnJheSgpOyBnb3RvIGRRX2NXOyBlUzFzSTogQGluaV9zZXQoIlx4NmZcMTY1XDE2NFwxNjBcMTY1XHg3NFx4NWZcMTQyXHg3NVx4NjZceDY2XDE0NVwxNjJcMTUxXDE1Nlx4NjciLCAiXDExN1wxNDZcMTQ2Iik7IGdvdG8gdUtFTWs7IFM3ZTFhOiBoZWFkZXIoIlwxMDNceDZmXDE1NlwxNjRcMTQ1XHg2ZVx4NzRceDJkXDE2NFx4NzlceDcwXDE0NVx4M2FcNDBcMTY0XDE0NVwxNzBcMTY0XDU3XDE1MFwxNjRceDZkXHg2Y1x4M2JceDIwXDE0M1x4NjhceDYxXHg3Mlx4NzNceDY1XDE2NFx4M2RceDc1XHg3NFx4NjZcNTVceDM4Iik7IGdvdG8gcFV5ODM7IGRRX2NXOiAkcm93ID0gMTsgZ290byBDRU82YzsgRGQyV2I6IEBpbmlfc2V0KCJceDZkXHg2MVx4NzhceDVmXHg2NVx4NzhceDY1XHg2M1x4NzVcMTY0XHg2OVwxNTdceDZlXDEzN1x4NzRcMTUxXHg2ZFx4NjUiLCAxMjAwKTsgZ290byBTN2UxYTsgd0dSQXg6ID8+CjxhIGhyZWY9IiMiPjxpbWcgc3JjPSJwbGF5YnV0dG9uLnBuZyIgaGVpZ2h0PSI1MHB4IiB3aWR0aD0iNTBweCIgLz48L2E+PGJyPjxwPgogICAgICAgICA8aW1nIHNyYz0iY2xvc2VidXR0b24ucG5nIiAgb25jbGljaz0iUExFWC5oaWRlX2l0ZW0oKTsiIGhlaWdodD0iNTBweCIgd2lkdGg9ImF1dG8iLz48L3A+YDsKIAogICAgICAgIAogICAgCiAgICAgICAgCiAgICAgICAgCiAgICAvLyBDaGVjayBpZiB0aGUgY3VycmVudCBpdGVtIGhhcyBtdWx0aXBsZSBzZWFzb25zIHNldCBhbmQgYWRkIGl0IHRvIHRoZSBwb3B1cCBzaWRlYmFyIG1ldGEKICAgIGlmIChQTEVYLmN1cnJlbnRfaXRlbS5udW1fc2Vhc29ucyA+IDApCiAgICAgIHBvcHVwQ29udGVudCArPSBgPGxpPjxzdHJvbmc+U2Vhc29uczo8L3N0cm9uZz4gJHtQTEVYLmN1cnJlbnRfaXRlbS5udW1fc2Vhc29uc308L2xpPmA7CgogICAgLy8gQ2hlY2sgaWYgdGhlIGN1cnJlbnQgaXRlbSBoYXMgbXVsdGlwbGUgZXBpc29kZXMgc2V0IGFuZCBhZGQgaXQgdG8gdGhlIHBvcHVwIHNpZGViYXIgbWV0YQogICAgaWYgKFBMRVguY3VycmVudF9pdGVtLm51bV9lcGlzb2RlcyA+IDApCiAgICAgIHBvcHVwQ29udGVudCArPSBgPGxpPjxzdHJvbmc+RXBpc29kZXM6PC9zdHJvbmc+ICR7UExFWC5jdXJyZW50X2l0ZW0ubnVtX2VwaXNvZGVzfTwvbGk+YDsKCiAgICAvLyBDaGVjayBpZiB0aGUgY3VycmVudCBpdGVtIGhhcyBhIHZpZXcgY291bnQgc2V0IGFuZCBhZGQgaXQgdG8gdGhlIHBvcHVwIHNpZGViYXIgbWV0YQogICAgaWYgKFBMRVguY3VycmVudF9pdGVtLnZpZXdfY291bnQgPiAwKQogICAgICBwb3B1cENvbnRlbnQgKz0gYDxsaT48c3Ryb25nPldhdGNoZWQ6PC9zdHJvbmc+ICR7CiAgICAgICAgUExFWC5jdXJyZW50X2l0ZW0udmlld19jb3VudAogICAgICB9ICR7aW5mbGVjdChQTEVYLmN1cnJlbnRfaXRlbS52aWV3X2NvdW50LCAndGltZScpfTwvbGk+YDsKCiAgICAgIC8vIENsb3NlIHRoZSBwb3B1cCBjb250ZW50IG1ldGEKICAgICAgcG9wdXBDb250ZW50ICs9ICc8L3VsPic7CiAgICB9IC8vIGVuZCBDT05URU5UIE1FVEEKCiAgICAvLyBDaGVjayBpZiB0aGVyZSBpcyBhbnkgc2Vhc29ucysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysKICAgIHZhciBwb3B1cFNlYXNvbnM9YGA7CmlmIChQTEVYLmN1cnJlbnRfaXRlbS5udW1fc2Vhc29ucyAmJiBQTEVYLmN1cnJlbnRfaXRlbS5udW1fc2Vhc29ucyA+IDApIHsKICAgICAgLy8gU3RhcnQgdGhlIHNlYXNvbiBicm93c2VyCiAgICAgIHBvcHVwU2Vhc29ucyArPSBgPGRpdiBpZD0icG9wdXBfc2Vhc29ucyI+PHNlY3Rpb24gaWQ9InBvcHVwX3NlYXNvbnNfc2Vhc29ucyI+PHVsPmA7CgogICAgICAvLyBMb29wIHRocm91Z2ggdGhlIHNlYXNvbnMgc29ydCBvcmRlcgogICAgICBQTEVYLmN1cnJlbnRfaXRlbS5zZWFzb25fc29ydF9vcmRlci5mb3JFYWNoKGtleSA9PiB7CiAgICAgICAgY29uc3Qgc2Vhc29uID0gUExFWC5jdXJyZW50X2l0ZW0uc2Vhc29uc1trZXldOwogICAgICAgIHBvcHVwU2Vhc29ucyArPSBgPGxpIGRhdGEtc2Vhc29uPSIke3NlYXNvbi5rZXl9Ij4ke3NlYXNvbi50aXRsZX08L2xpPmA7CiAgICAgIH0pOwoKICAgICAgLy8gU3RhcnQgdGhlIHNlYXNvbiBlcGlzb2RlcwogICAgICBwb3B1cFNlYXNvbnMgKz0gYDwvdWw+PC9zZWN0aW9uPjxzZWN0aW9uIGlkPSJwb3B1cF9zZWFzb25zX2VwaXNvZGVzIj48L3NlY3Rpb24+PHNlY3Rpb24gaWQ9InBvcHVwX3NlYXNvbnNfZXBpc29kZSI+PC9zZWN0aW9uPjwvZGl2PmA7CiAgICB9IC8vIGVuZCBTRUFTT04gQlJPV1NFUgogCiAgICBwb3B1cENvbnRlbnQgKz0gJzwvZGl2Pic7CiAgICAvLyAvKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrKysrCiAgICByZXR1cm4gYDxkaXYgaWQ9InBvcHVwLW91dGVyIj48ZGl2IGlkPSJwb3B1cC1pbm5lciI+JHtwb3B1cEhlYWRlcn0ke3BvcHVwU2lkZWJhcn0ke3BvcHVwQ29udGVudH0ke3BvcHVwU2Vhc29uc308L2Rpdj48L2Rpdj5gOwogIH0sIC8vIGVuZCBmdW5jOiBnZW5lcmF0ZV9pdGVtX2NvbnRlbnQKCiAgLyohCiAgICogSGlkZSB0aGUgY3VycmVudGx5IG9wZW4gcG9wdXAKICAgKi8KICBoaWRlX2l0ZW0oKSB7CiAgICBQTEVYLnBvcHVwX3Zpc2libGUgPSBmYWxzZTsgLy8gU2V0IHBvcHVwIHZpc2libGUgdG8gZmFsc2UKICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gUExFWC5jdXJyZW50X3NlY3Rpb24ua2V5OyAvLyBTZXQgaGFzaCB0byBjdXJyZW50IHNlY3Rpb24KICAgIEZYLmZhZGVPdXQoUExFWC5fcG9wdXBfb3ZlcmxheSk7IC8vIEZhZGUgb3V0IHBvcHVwIG92ZXJsYXkKICAgIEZYLmZhZGVPdXQoUExFWC5fcG9wdXBfY29udGFpbmVyKTsgLy8gRmFkZSBvdXQgcG9wdXAgY29udGFpbmVyCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWFpbicpLnN0eWxlLm9wYWNpdHkgPSAxLjAwOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NpZGViYXInKS5zdHlsZS5vcGFjaXR5ID0gMS4wMDsgICAgCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnYnVpbGRlcicpLnN0eWxlLm9wYWNpdHkgPSAxLjAwOwogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlYWRlcicpLnN0eWxlLm9wYWNpdHkgPSAxLjAwOyAgCiAgfSwgLy8gZW5kIGZ1bmM6IGhpZGVfaXRlbQoKCiAgICAKICAvKiEKICAgKiBSdW4gcGxleCBjbGFzcyAoY29uc3RydWN0b3IpCiAgICovCiAgcnVuKCkgewogICAgdmFyIGN1clVSTCA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmOyAgIAogCXZhciBzZWFyY2hxdWVyeSA9IChjdXJVUkwuc3Vic3RyaW5nKGN1clVSTC5sYXN0SW5kZXhPZigiLyIpICsgMSkpOyAKICAgIHNlYXJjaHF1ZXJ5ID0gZGVjb2RlVVJJKHNlYXJjaHF1ZXJ5KTsKICAgIHNlYXJjaHF1ZXJ5ID0gc2VhcmNocXVlcnkucmVwbGFjZSgvLC9nLCAnJyk7ICAKICAgIHNlYXJjaHF1ZXJ5ID0gc2VhcmNocXVlcnkucmVwbGFjZSgvJy9nLCAnQScpOyAgCiAgICAKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdidWlsZGVyJykub25rZXlkb3duID0gZnVuY3Rpb24oZSl7CiAgICBpZihlLmtleUNvZGUgPT0gMTMpewogICAgICAgIHRoaXMuZm9ybS5zdWJtaXQoKTsKICAgICAgICBhbGVydCgnc3VibWl0Jyk7CiAgIAl9Cgl9OyAgCiAgICAgIAogICAgICAKICAgICAgCiAgICBpZiAoIVBMRVguZGF0YV9sb2FkZWQpIHsKICAgICAgLy8gTm8gZGF0YSBsb2FkZWQuIEZldGNoIGRhdGEgZmlsZQogICAgICBmZXRjaCgnLi91LycgKyBzZWFyY2hxdWVyeSArICcucGhwJykKICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAvLyBIYW5kbGUgZGF0YQogICAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgIHJlc3BvbnNlLnRleHQoKS50aGVuKGRhdGEgPT4gewogICAgICAgICAgICAgIC8vIFJlbW92ZSBzdGFydGluZyBzdHJpbmcKICAgICAgICAgICAgICBsZXQgcmF3UGxleERhdGEgPSBkYXRhCiAgICAgICAgICAgICAgICAucmVwbGFjZSgndmFyIHJhd19wbGV4X2RhdGEgPSAnLCAnJykKICAgICAgICAgICAgICAgIC50cmltU3RhcnQoKTsKICAgICAgICAgICAgICAvLyBSZW1vdmUgc2VtaS1jb2xvbiBmcm9tIGVuZAogICAgICAgICAgICAgIHJhd1BsZXhEYXRhID0gcmF3UGxleERhdGEKICAgICAgICAgICAgICAgIC50cmltRW5kKCkKICAgICAgICAgICAgICAgIC5zdWJzdHJpbmcoMCwgcmF3UGxleERhdGEubGVuZ3RoIC0gMSk7CiAgICAgICAgICAgICAgLy8gUGFyc2UgdGhlIHBsZXggZGF0YQogICAgICAgICAgICAgIHJhd1BsZXhEYXRhID0gSlNPTi5wYXJzZShyYXdQbGV4RGF0YSk7CiAgICAgICAgICAgICAgLy8gTG9hZCB0aGUgZGF0YSBpbnRvIHRoZSBzY3JpcHQKICAgICAgICAgICAgICBQTEVYLmxvYWRfZGF0YShyYXdQbGV4RGF0YSk7CiAgICAgICAgICAgICAgcmV0dXJuIFBMRVgucnVuKCk7CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKAogICAgICAgICAgICAgIGBFcnJvciBvYnRhaW5pbmcgdGhlIFBsZXggZGF0YTogJHtyZXNwb25zZS5zdGF0dXNUZXh0fWAKICAgICAgICAgICAgKTsKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAvLyBIYW5kbGUgZXJyb3IKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgIH0pOwogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gQ2hlY2sgZm9yIG1lbnUgc3RhdHVzCiAgICBjb25zdCBzaWRlYmFyTWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzaWRlYmFyLW1lbnUnKTsKICAgIGNvbnN0IG1lbnVTdGF0dXMgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgncGVNZW51U3RhdHVzJyk7CiAgICAKCiAgICAvLyBHZXQvU2V0IEVsZW1lbnRzCiAgICAvL1BMRVguX3RvdGFsX2l0ZW1zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3RvdGFsX2l0ZW1zJyk7CiAgICBQTEVYLl9sYXN0X3VwZGF0ZWQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjbGFzdF91cGRhdGVkJyk7CiAgICBQTEVYLl9zZWN0aW9uc19saXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3BsZXhfc2VjdGlvbl9saXN0Jyk7CiAgICBQTEVYLl9zb3J0c19saXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3BsZXhfc29ydF9saXN0Jyk7CiAgICBQTEVYLl9nZW5yZV9saXN0X3NlY3Rpb24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKAogICAgICAnI3BsZXhfZ2VucmVfbGlzdF9zZWN0aW9uJwogICAgKTsKICAgIFBMRVguX2dlbnJlX2xpc3Rfc2VjdGlvbi5zdHlsZS5kaXNwbGF5ID0gJ25vbmUnOwogICAgUExFWC5fZ2VucmVfbGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGV4X2dlbnJlX2xpc3QnKTsKICAgIFBMRVguX2RpcmVjdG9yX2xpc3Rfc2VjdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoCiAgICAgICcjcGxleF9kaXJlY3Rvcl9saXN0X3NlY3Rpb24nCiAgICApOwogICAgUExFWC5fZGlyZWN0b3JfbGlzdF9zZWN0aW9uLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICBQTEVYLl9kaXJlY3Rvcl9saXN0ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3BsZXhfZGlyZWN0b3JfbGlzdCcpOwogICAgLy9QTEVYLl9zZWVuX2xpc3Rfc2VjdGlvbiA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGV4X3NlZW5fbGlzdF9zZWN0aW9uJyk7CiAgICAvL1BMRVguX3NlZW5fbGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwbGV4X3NlZW5fbGlzdCcpOwogICAgUExFWC5fc2VjdGlvbl90aXRsZSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzZWN0aW9uLWhlYWRlciBoMicpOwogICAgUExFWC5fc2VjdGlvbl9tZXRhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI3NlY3Rpb24taGVhZGVyIHAnKTsKICAgIFBMRVguX3NlY3Rpb25fZmlsdGVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2hlYWRlciBpbnB1dCcpOwogICAgUExFWC5fY29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignI2NvbnRhaW5lcicpOwogICAgUExFWC5faXRlbV9saXN0X3N0YXR1cyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNpdGVtLWxpc3Qtc3RhdHVzJyk7CiAgICBQTEVYLl9pdGVtX2xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjaXRlbS1saXN0IHVsJyk7CiAgICBQTEVYLl9zZWN0aW9uX2hlYWRlciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNzZWN0aW9uLWhlYWRlcicpOwogICAgUExFWC5fcG9wdXBfb3ZlcmxheSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNwb3B1cC1vdmVybGF5Jyk7CiAgICBQTEVYLl9wb3B1cF9jb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjcG9wdXAtY29udGFpbmVyJyk7CgogICAgLy8gU2V0IHBhZ2UgdmFyaWFibGVzCiAgICAvL1BMRVguX3RvdGFsX2l0ZW1zLmlubmVyVGV4dCA9IG51bWJlcl9mb3JtYXQoUExFWC50b3RhbF9pdGVtcyk7CiAgICBQTEVYLl9sYXN0X3VwZGF0ZWQuaW5uZXJUZXh0ID0gUExFWC5sYXN0X3VwZGF0ZWQ7CiAgICBQTEVYLmRpc3BsYXlfc2VjdGlvbnNfbGlzdCgpOwoKICAgIC8qCiAgICAgKiBBZGQgZXZlbnQgbGlzdGVuZXJzCiAgICAgKi8KCiAgICAvLyBMaXN0ZW4gZm9yIGNsaWNrIG9uIHNlY3Rpb24gbGlzdCBpdGVtcwogICAgUExFWC5fc2VjdGlvbnNfbGlzdC5xdWVyeVNlbGVjdG9yQWxsKCdsaScpLmZvckVhY2goc2VjdGlvbnNMaXN0SXRlbSA9PgogICAgICBzZWN0aW9uc0xpc3RJdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIC8vIERpc3BsYXkgdGhlIHNlbGVjdGVkIHNlY3Rpb24KICAgICAgICBQTEVYLmRpc3BsYXlfc2VjdGlvbihzZWN0aW9uc0xpc3RJdGVtLmRhdGFzZXQuc2VjdGlvbik7CiAgICAgIH0pCiAgICApOwoKICAgIC8vIExpc3RlbiBmb3IgY2xpY2sgb24gc29ydCBsaXN0IGl0ZW1zCiAgICBQTEVYLl9zb3J0c19saXN0LnF1ZXJ5U2VsZWN0b3JBbGwoJ2xpJykuZm9yRWFjaChzb3J0TGlzdEl0ZW0gPT4KICAgICAgc29ydExpc3RJdGVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4gewogICAgICAgIC8vIENoYW5nZSB0aGUgc2VsZWN0ZWQgc29ydAogICAgICAgIFBMRVguY2hhbmdlX3NvcnQoc29ydExpc3RJdGVtLmRhdGFzZXQuc29ydCk7CiAgICAgIH0pCiAgICApOwoKICAgIC8vIEtleXVwIG9uIGZpbHRlciAoc2VhcmNoKSBpbnB1dAogICAgUExFWC5fc2VjdGlvbl9maWx0ZXIuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCAoKSA9PiB7CiAgICAgIC8vIERpc3BsYXkgdGhlIGZpbHRlcmVkIGl0ZW1zIGluIHRoZSBzZWN0aW9uCiAgICAgIFBMRVguZGlzcGxheV9zZWN0aW9uKFBMRVguY3VycmVudF9zZWN0aW9uLmtleSk7CiAgICB9KTsKCiAgICAvLyBMaXN0ZW4gZm9yIGtleXVwIG9uIHRoZSBkb2N1bWVudAogICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcigna2V5dXAnLCBldmVudCA9PiB7CiAgICAgIC8vIElmIHNoaWZ0IGtleSwgbWV0YSBrZXksIGFsdCBrZXksIG9yIGNvbnRyb2wga2V5IHdhcyBwcmVzc2VkLCBza2lwCiAgICAgIGlmIChldmVudC5zaGlmdEtleSB8fCBldmVudC5tZXRhS2V5IHx8IGV2ZW50LmFsdEtleSB8fCBldmVudC5jdHJsS2V5KQogICAgICAgIHJldHVybjsKCiAgICAgIC8vIENoZWNrIHdoaWNoIGtleSB3YXMgcHJlc3NlZCBhbmQgZmlyZSBmdW5jdGlvbiBpZiBtYXRjaCBmb3VuZAogICAgICBzd2l0Y2ggKGV2ZW50LndoaWNoKSB7CiAgICAgICAgY2FzZSAyNzogLy8gZXNjCiAgICAgICAgY2FzZSA4ODogLy8geAogICAgICAgICAgUExFWC5oaWRlX2l0ZW0oKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgNzQ6IC8vIGoKICAgICAgICAvKiBjYXNlIDM3OiAvLyBhcnJvdyBsZWZ0CiAgICAgICAgICBpZiAoUExFWC5wcmV2aW91c19pdGVtX2lkID4gMCkgewogICAgICAgICAgICBQTEVYLmRpc3BsYXlfaXRlbShQTEVYLnByZXZpb3VzX2l0ZW1faWQpOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7ICovCiAgICAgICAgY2FzZSA3NTogLy8gawogICAgICAgIC8qIGNhc2UgMzk6IC8vIGFycm93IHJpZ2h0CiAgICAgICAgICBpZiAoUExFWC5uZXh0X2l0ZW1faWQgPiAwKSB7CiAgICAgICAgICAgIFBMRVguZGlzcGxheV9pdGVtKFBMRVgubmV4dF9pdGVtX2lkKTsKICAgICAgICAgIH0gZWxzZSBpZiAoIVBMRVgucG9wdXBfdmlzaWJsZSkgewogICAgICAgICAgICAvLyBTaG93IGZpcnN0IGl0ZW0gaWYgbm9uZSBvdGhlcnMKICAgICAgICAgICAgY29uc3QgZmlyc3RJdGVtID0gcGFyc2VJbnQoCiAgICAgICAgICAgICAgUExFWC5faXRlbV9saXN0LnF1ZXJ5U2VsZWN0b3IoJ2xpOmZpcnN0LWNoaWxkJykuZGF0YXNldC5pdGVtCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIC8vIGZpcnN0SXRlbSA9IHBhcnNlSW50KGZpcnN0SXRlbVswXS5kYXRhc2V0Lml0ZW0pOwogICAgICAgICAgICBpZiAoZmlyc3RJdGVtID4gMCkgUExFWC5kaXNwbGF5X2l0ZW0oZmlyc3RJdGVtKTsKICAgICAgICAgIH0KICAgICAgICAgIGJyZWFrOyAqLwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfSk7CgogICAgLy8gR2V0IHRoZSB3aW5kb3cgaGFzaAogICAgY29uc3QgeyBoYXNoIH0gPSB3aW5kb3cubG9jYXRpb247CiAgICAvLyBDaGVjayBpZiB0aGUgaGFzaCBpcyBlbXB0eQogICAgaWYgKGhhc2ggIT09ICcnKSB7CiAgICAgIC8vIFNldCByZWdleCB0byBvbmx5IHJldHVybiBudW1iZXJzCiAgICAgIGNvbnN0IHJlZ2V4ID0gbmV3IFJlZ0V4cCgnIyhbMC05XSspLz8oWzAtOV0rKT8vPycpOwoKICAgICAgLy8gRXhlY3V0ZSByZWdleCB0byByZXR1cm4gYXJyYXkgb2Ygc2V0IG51bWJlcihzKQogICAgICBjb25zdCBtID0gcmVnZXguZXhlYyhoYXNoKTsKCiAgICAgIC8vIFNlbGVjdCBkaXNwbGF5IGlmIHZhbGlkIHJlZ2V4IG1hdGNoCiAgICAgIGlmIChtICE9PSBudWxsKSB7CiAgICAgICAgY29uc3QgbTEgPSBwYXJzZUludChtWzFdKTsgLy8gU2V0IG1hdGNoIDEgKHNlY3Rpb24pCiAgICAgICAgY29uc3QgbTIgPSBwYXJzZUludChtWzJdKTsgLy8gU2V0IG1hdGNoIDIgKGl0ZW0pCiAgICAgICAgaWYgKG0xID4gMCkgUExFWC5kaXNwbGF5X3NlY3Rpb24obTEpOyAvLyBJZiBzZWN0aW9uIGlzIHZhbGlkLCBkaXNwbGF5IHNlY3Rpb24KICAgICAgICBpZiAobTIgPiAwKSBQTEVYLmRpc3BsYXlfaXRlbShtMik7IC8vIElmIGl0ZW0gaXMgdmFsaWQsIGRpc3BsYXkgaXRlbQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRyaWdnZXIgImNsaWNrIiBvZiBmaXJzdCBzZWN0aW9uCiAgICAgICAgUExFWC5fc2VjdGlvbnNfbGlzdC5xdWVyeVNlbGVjdG9yKCdsaTpmaXJzdC1jaGlsZCcpLmNsaWNrKCk7CiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIC8vIFRyaWdnZXIgImNsaWNrIiBvZiBmaXJzdCBzZWN0aW9uCiAgICAgIFBMRVguX3NlY3Rpb25zX2xpc3QucXVlcnlTZWxlY3RvcignbGk6Zmlyc3QtY2hpbGQnKS5jbGljaygpOwogICAgfQogIH0sIC8vIGVuZCBmdW5jOiBydW4KfTsgLy8gZW5kIGNsYXNzOiBQTEVYPC9zY3JpcHQ+PHNjcmlwdD5yZWFkeSgoKSA9PiB7CgkJCVBMRVgucnVuKCk7CgkJfSk7PC9zY3JpcHQ+PC9oZWFkPjxib2R5PjxoZWFkZXIgaWQ9ImhlYWRlciI+PGgxPjxzcGFuPlBsZXggRXhwb3J0PC9zcGFuPjwvaDE+PHNlY3Rpb24gaWQ9InNlYXJjaCI+PGlucHV0IHBsYWNlaG9sZGVyPSJTZWFyY2guLi4iPjwvc2VjdGlvbj48Zm9ybSBhY3Rpb249ImFwaWdldHRlcjgtNC5waHAiaWQ9ImJ1aWxkZXIiPjxpbnB1dCBuYW1lPSJzImlkPSJmaXJzdF9uYW1lInBsYWNlaG9sZGVyPSJTZWFyY2giY2xhc3M9InNlYXJjaEZpZWxkIj4gPGlucHV0IG5hbWU9ImlkInR5cGU9ImhpZGRlbiJ2YWx1ZT0iPCU9IHJlcXVlc3QuZ2V0UGFyYW1ldGVyKCJzX3BhcmFtIiklPjwhLS0gIj4gLS0+IDxpbnB1dCBuYW1lPSJzdWJtaXQidHlwZT0ic3VibWl0InZhbHVlPSJTZWFyY2gic3R5bGU9IndpZHRoOjUwcHg7aGVpZ2h0OjMwcHgiPjwvZm9ybT48L2hlYWRlcj48ZGl2IGlkPSJpdGVtLWxpc3Qtc3RhdHVzIj5Mb2FkaW5nIGRhdGEgZnJvbSBQTEVYLi4uPC9kaXY+PG1haW4gaWQ9ImNvbnRhaW5lciJjbGFzcz0iY29udGFpbmVyInN0eWxlPSJkaXNwbGF5Om5vbmUiPjxhc2lkZSBpZD0ic2lkZWJhciI+PHNlY3Rpb24gaWQ9InNpZGViYXItbWVudSI+PGRpdiBjbGFzcz0ic2lkZWJhci1zZWN0aW9uIj48aDI+TGlzdGluZyBieS4uLjxhIGhyZWY9Ii4vInN0eWxlPSJjb2xvcjojZmZmIj5SZWZyZXNoPC9hPjwvaDI+PHVsIGNsYXNzPSJnZW5lcmljLWxpc3QiaWQ9InBsZXhfc29ydF9saXN0Ij48bGkgZGF0YS1zb3J0PSJ0aXRsZSJjbGFzcz0iY3VycmVudCI+PGVtPmFzYzwvZW0+VGl0bGU8L2xpPjxsaSBkYXRhLXNvcnQ9ImFkZGVkQXQiPkFkZGVkIERhdGU8L2xpPjwvdWw+PC9kaXY+PGRpdiBpZD0icGxleF9nZW5yZV9saXN0X3NlY3Rpb24iY2xhc3M9InNpZGViYXItc2VjdGlvbiI+PGgyPkdlbnJlPC9oMj48dWwgY2xhc3M9ImdlbmVyaWMtbGlzdCJpZD0icGxleF9nZW5yZV9saXN0Ij48L3VsPjwvZGl2PjxkaXYgaWQ9InBsZXhfZGlyZWN0b3JfbGlzdF9zZWN0aW9uImNsYXNzPSJzaWRlYmFyLXNlY3Rpb24iPjxoMj5EaXJlY3RvcnM8L2gyPjx1bCBjbGFzcz0iZ2VuZXJpYy1saXN0ImlkPSJwbGV4X2RpcmVjdG9yX2xpc3QiPjwvdWw+PC9kaXY+PC9zZWN0aW9uPjwvYXNpZGU+PG1haW4gaWQ9Im1haW4iPjxzZWN0aW9uIGlkPSJzZWN0aW9uLWhlYWRlciI+PGRpdiBjbGFzcz0ic2lkZWJhci1zZWN0aW9uIj48dWwgY2xhc3M9InNlY3Rpb25zLWxpc3QiaWQ9InBsZXhfc2VjdGlvbl9saXN0Ij48L3VsPjwvZGl2Pjwvc2VjdGlvbj48ZGl2IGlkPSJzZWN0aW9uX251bV9pdGVtcyI+PC9kaXY+PGRpdiBpZD0iaXRlbS1saXN0Ij48dWw+PC91bD48L2Rpdj48L21haW4+PC9tYWluPjxmb290ZXIgaWQ9ImZvb3RlciI+PHA+UExFWCBFeHBvcnQgQnkgTVNLIHwgPHNwYW4gaWQ9Imxhc3RfdXBkYXRlZCI+PC9zcGFuPjwvcD48L2Zvb3Rlcj48ZGl2IGlkPSJwb3B1cC1vdmVybGF5Ij48L2Rpdj48ZGl2IGlkPSJwb3B1cC1jb250YWluZXIiPjwvZGl2PjxzY3JpcHQ+d2luZG93Lm9uc2Nyb2xsPWZ1bmN0aW9uKCl7bXlGdW5jdGlvbigpfTt2YXIgaGVhZGVyPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZWN0aW9uLWhlYWRlciIpLHN0aWNreT1oZWFkZXIub2Zmc2V0VG9wO2Z1bmN0aW9uIG15RnVuY3Rpb24oKXt3aW5kb3cucGFnZVlPZmZzZXR9PC9zY3JpcHQ+PC9ib2R5PjwvaHRt')); ?>
